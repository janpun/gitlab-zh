(this.webpackJsonp=this.webpackJsonp||[]).push([[214],{1255:function(e,t,a){a(31),e.exports=a(850)},81:function(e,t,a){"use strict";var n=a(0),s=a.n(n),r=a(3),i=a.n(r),o=a(5),l=a(1),d=a(47),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function c(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.users=this.users.bind(this),this.user=this.user.bind(this),this.usersPath="/autocomplete/users.json",this.userPath="/autocomplete/users/:id.json",null!=e&&("object"===(void 0===e?"undefined":u(e))?this.currentUser=e:this.currentUser=JSON.parse(e));var r,c=n.handleClick;a=s()(t),t||(a=s()(".js-user-search")),a.each((r=this,function(e,t){var a,n,u,f,p,m,v,h,g,b,k,w,y,j,S,_,C,U,I,x={};u=s()(t),x.projectId=u.data("projectId"),x.groupId=u.data("groupId"),x.showCurrentUser=u.data("currentUser"),x.todoFilter=u.data("todoFilter"),x.todoStateFilter=u.data("todoStateFilter"),U=u.data("nullUser"),w=u.data("nullUserDefault"),I=u.data("showMenuAbove"),C=u.data("anyUser"),y=u.data("firstUser"),x.authorId=u.data("authorId"),k=u.data("defaultLabel"),j=u.data("issueUpdate"),p=u.closest(".selectbox"),a=p.closest(".block"),v=u.data("abilityName"),m=a.find(".value"),n=a.find(".sidebar-collapsed-user"),f=a.find(".block-loading").fadeOut(),_=w&&U?0:null,void 0===(S=u.data("selected"))&&(S=_);var L=function(){var e=u.closest(".selectbox").find("input[name='"+u.data("fieldName")+"'][value=0]");e&&e.remove();var t=document.createElement("input");t.type="hidden",t.name=u.data("fieldName");var a=u.data("currentUserInfo");a?(t.value=a.id,t.dataset.meta=i.a.escape(a.name)):r.currentUser&&(t.value=r.currentUser.id),p?u.parent().before(t):u.after(t)};a[0]&&a[0].addEventListener("assignYourself",L);var D=function(){return p.find('input[name="'+u.data("fieldName")+'"]')},A=function(){return D().map(function(e,t){return parseInt(t.value,10)}).get()},E=function(){var e=u.data("maxSelect");if(e){var t=A();if(t.length>e){var a=t[0];u.closest(".selectbox").find("input[name='"+u.data("fieldName")+"'][value="+a+"]").remove(),emitSidebarEvent("sidebar.removeAssignee",{id:a})}}},N=function(e,t){var a=A().filter(function(e){return 0!==e}),n=D().map(function(e,t){return{name:t.dataset.meta,value:parseInt(t.value,10)}}).filter(function(e){return 0!==e.id}).get(0);if(0===a.length)return"Unassigned";if(1===a.length)return n.name;if(t){var s=a.filter(function(t){return t!==e.id});return e.name+" + "+s.length+" more"}return n.name+" + "+(a.length-1)+" more"};return s()(".assign-to-me-link").on("click",function(e){if(e.preventDefault(),s()(e.currentTarget).hide(),u.data("multiSelect")){L(),E();var t=u.data("currentUserInfo");u.find(".dropdown-toggle-text").text(N(t)).removeClass("is-default")}else{var a=s()('input[name="'+u.data("fieldName")+'"]');a.val(gon.current_user_id),S=a.val(),u.find(".dropdown-toggle-text").text(gon.current_user_fullname).removeClass("is-default")}}),a.on("click",".js-assign-yourself",function(e){return e.preventDefault(),h(r.currentUser.id)}),h=function(e){var t;return(t={})[v]={},t[v].assignee_id=null!=e?e:null,f.removeClass("hidden").fadeIn(),u.trigger("loading.gl.dropdown"),o.a.put(j,t).then(function(e){var t,a,s=e.data;return u.trigger("loaded.gl.dropdown"),f.fadeOut(),s.assignee?(t={name:s.assignee.name,username:s.assignee.username,avatar:s.assignee.avatar_url},a=i.a.escape(t.name)):(t={name:"Unassigned",username:"",avatar:""},a=Object(l.a)("Assignee")),m.html(g(t)),n.attr("title",a).tooltip("_fixTitle"),n.html(b(t))})},b=i.a.template('<% if( avatar ) { %> <a class="author-link" href="/<%- username %>"> <img width="24" class="avatar avatar-inline s24" alt="" src="<%- avatar %>"> </a> <% } else { %> <i class="fa fa-user"></i> <% } %>'),g=i.a.template('<% if (username) { %> <a class="author-link bold" href="/<%- username %>"> <% if( avatar ) { %> <img width="32" class="avatar avatar-inline s32" alt="" src="<%- avatar %>"> <% } %> <span class="author"><%- name %></span> <span class="username"> @<%- username %> </span> </a> <% } else { %> <span class="no-value assign-yourself"> No assignee - <a href="#" class="js-assign-yourself"> assign yourself </a> </span> <% } %>'),u.glDropdown({showMenuAbove:I,data:function(e,t){return r.users(e,x,function(a){(this.instance||this.options.instance).options.processData(e,a,t)}.bind(this))},processData:function(e,t,a){var n=t;if(u.hasClass("js-multiselect")&&0===e.length){var s=D(),r=i.a.uniq(s,!1,function(e){return e.value}).filter(function(e){var t=parseInt(e.value,10);return!n.find(function(e){return e.id===t})&&0!==t}).map(function(e){var t=parseInt(e.value,10),a=e.dataset,n=a.avatarUrl,s=a.avatar_url,r=a.name,i=a.username;return{avatar_url:n||s,id:t,name:r,username:i}});n=t.concat(r)}var o=void 0,l=void 0,d=void 0,c=void 0,f=void 0,p=void 0;if(0===e.length){if(p=0,y)for(l=0,d=n.length;l<d;l+=1)if((f=n[l]).username===y){n.splice(l,1),n.unshift(f);break}if(U&&(p+=1,n.unshift({beforeDivider:!0,name:"Unassigned",id:0})),C&&(p+=1,!0===(c=C)&&(c="Any User"),o={beforeDivider:!0,name:c,id:null},n.unshift(o)),p&&n.splice(p,0,"divider"),u.hasClass("js-multiselect")){var m=A().filter(function(e){return 0!==e});if(m.length>0){u.data("dropdownHeader")&&(p+=1,n.splice(p,0,{header:u.data("dropdownHeader")}));var v=n.filter(function(e){return-1!==m.indexOf(e.id)}).sort(function(e,t){return e.name>t.name});n=n.filter(function(e){return-1===m.indexOf(e.id)}),v.forEach(function(e){p+=1,n.splice(p,0,e)}),n.splice(p+1,0,"divider")}}}a(n),I&&u.data("glDropdown").positionMenuAbove()},filterable:!0,filterRemote:!0,search:{fields:["name","username"]},selectable:!0,fieldName:u.data("fieldName"),toggleLabel:function(e,t,a){var n=a.filterInput.val();if(this.multiSelect&&""===n){var r=a.filteredFullData(),i=a.parseData.bind(a);this.processData(n,r,i)}return this.multiSelect?N(e,s()(t).hasClass("is-active")):e&&"id"in e&&s()(t).hasClass("is-active")?(u.find(".dropdown-toggle-text").removeClass("is-default"),e.text?e.text:e.name):(u.find(".dropdown-toggle-text").addClass("is-default"),k)},defaultLabel:k,hidden:function(e){u.hasClass("js-multiselect")&&emitSidebarEvent("sidebar.saveAssignees"),u.data("alwaysShowSelectbox")||(p.hide(),a=p.closest(".block"),(m=a.find(".value")).css("display",""))},multiSelect:u.hasClass("js-multiselect"),inputMeta:u.data("inputMeta"),clicked:function(e){var t,a,n,r,i=e.$el,o=e.e,l=e.isMarking,f=e.selectedObj;if(u.hasClass("js-multiselect")){var p=i.hasClass("is-active"),m=u.closest(".selectbox").find("input[name='"+u.data("fieldName")+"'][value!=0]");if(E(),f.beforeDivider&&"unassigned"===f.name.toLowerCase())m.each(function(e,t){parseInt(t.value,10),t.remove()}),emitSidebarEvent("sidebar.removeAllAssignees");else if(p){emitSidebarEvent("sidebar.addAssignee",f);var v=u.closest(".selectbox").find("input[name='"+u.data("fieldName")+"'][value=0]");v&&v.remove()}else 0===m.length&&this.addInput(u.data("fieldName"),0,{}),emitSidebarEvent("sidebar.removeAssignee",f);A().find(function(e){return e===gon.current_user_id})?s()(".assign-to-me-link").hide():s()(".assign-to-me-link").show()}if(t="projects:issues:index"===(n=s()("body").attr("data-page")),a=n==n&&"projects:merge_requests:index"===n,u.hasClass("js-filter-bulk-update")||u.hasClass("js-issuable-form-dropdown")){o.preventDefault();var g=f.id!==S;(S=g?f.id:_)===gon.current_user_id?s()(".assign-to-me-link").hide():s()(".assign-to-me-link").show()}else{if(i.closest(".add-issues-modal").length)d.a.store.filter[u.data("fieldName")]=f.id;else if(c)o.preventDefault(),c(f,l);else{if(u.hasClass("js-filter-submit")&&(t||a))return Issuable.filterResults(u.closest("form"));if(u.hasClass("js-filter-submit"))return u.closest("form").submit();if(!u.hasClass("js-multiselect"))return r=u.closest(".selectbox").find("input[name='"+u.data("fieldName")+"']").val(),h(r)}u.data("maxSelect")&&A().length===u.data("maxSelect")&&u.dropdown("toggle")}},id:function(e){return e.id},opened:function(e){var t=s()(e.currentTarget),a=A();function n(e){t.find('li[data-user-id="'+e+'"] .dropdown-menu-user-link').addClass("is-active")}u.hasClass("js-issue-board-sidebar")&&0===a.length&&this.addInput(u.data("fieldName"),0,{}),t.find(".is-active").removeClass("is-active"),a.length>0?A().forEach(function(e){return n(e)}):u.hasClass("js-issue-board-sidebar")?n(0):n(S)},updateLabel:u.data("dropdownTitle"),renderRow:function(e){var t,a,n;n=e.username?"@"+e.username:"",t=e.avatar_url?e.avatar_url:gon.default_avatar_url;var s=!1;if(this.multiSelect){s=A().find(function(t){return e.id===t});var r=this.fieldName;u.closest(".selectbox").find("input[name='"+r+"'][value='"+e.id+"']").length&&(s=!0)}else s=e.id===S;return a="",null!=e.beforeDivider?i.a.escape(e.name):a="<img src='"+t+"' class='avatar avatar-inline' width='32' />","\n            <li data-user-id="+e.id+">\n              <a href='#' class='dropdown-menu-user-link "+(!0===s?"is-active":"")+"'>\n                "+a+"\n                <strong class='dropdown-menu-user-full-name'>\n                  "+i.a.escape(e.name)+"\n                </strong>\n                "+(n?"<span class='dropdown-menu-user-username'>"+n+"</span>":"")+"\n              </a>\n            </li>\n          "}})})),s()(".ajax-users-select").each(function(e){return function(t,a){var n,r,i,o,l={};return l.skipLdap=s()(a).hasClass("skip_ldap"),l.projectId=s()(a).data("projectId"),l.groupId=s()(a).data("groupId"),l.showCurrentUser=s()(a).data("currentUser"),l.authorId=s()(a).data("authorId"),l.skipUsers=s()(a).data("skipUsers"),o=s()(a).data("nullUser"),r=s()(a).data("anyUser"),i=s()(a).data("emailUser"),n=s()(a).data("firstUser"),s()(a).select2({placeholder:"Search for a user",multiple:s()(a).hasClass("multiselect"),minimumInputLength:0,query:function(t){return e.users(t.term,l,function(e){var a,s,l,d,u,c,f,p,m;if(s={results:e},0===t.term.length){if(n)for(d=0,u=(m=s.results).length;d<u;d+=1)if((p=m[d]).username===n){s.results.splice(d,1),s.results.unshift(p);break}o&&(f={name:"Unassigned",id:0},s.results.unshift(f)),r&&(!0===(c=r)&&(c="Any User"),a={name:c,id:null},s.results.unshift(a))}if(i&&0===s.results.length&&t.term.match(/^[^@]+@[^@]+$/)){var v=t.term.trim();l={name:'Invite "'+t.term+'" by email',username:v,id:v,invite:!0},s.results.unshift(l)}return t.callback(s)})},initSelection:function(){var t;return t=1<=arguments.length?[].slice.call(arguments,0):[],e.initSelection.apply(e,t)},formatResult:function(){var t;return t=1<=arguments.length?[].slice.call(arguments,0):[],e.formatResult.apply(e,t)},formatSelection:function(){var t;return t=1<=arguments.length?[].slice.call(arguments,0):[],e.formatSelection.apply(e,t)},dropdownCssClass:"ajax-users-dropdown",escapeMarkup:function(e){return e}})}}(this))}window.emitSidebarEvent=window.emitSidebarEvent||s.a.noop,c.prototype.initSelection=function(e,t){var a;return"0"===(a=s()(e).val())?t({name:"Unassigned"}):""!==a?this.user(a,t):void 0},c.prototype.formatResult=function(e){var t;return t=e.avatar_url?e.avatar_url:gon.default_avatar_url,"<div class='user-result "+(e.username?void 0:"no-username")+"'> <div class='user-image'><img class='avatar avatar-inline s32' src='"+t+"'></div> <div class='user-name dropdown-menu-user-full-name'>"+i.a.escape(e.name)+"</div> <div class='user-username dropdown-menu-user-username'>"+(e.invite?"":"@"+i.a.escape(e.username))+"</div> </div>"},c.prototype.formatSelection=function(e){return i.a.escape(e.name)},c.prototype.user=function(e,t){return!!/^\d+$/.test(e)&&(a=(a=this.buildUrl(this.userPath)).replace(":id",e),o.a.get(a).then(function(e){var a=e.data;t(a)}));var a},c.prototype.users=function(e,t,a){var n=this.buildUrl(this.usersPath),s={search:e,active:!0,project_id:t.projectId||null,group_id:t.groupId||null,skip_ldap:t.skipLdap||null,todo_filter:t.todoFilter||null,todo_state_filter:t.todoStateFilter||null,current_user:t.showCurrentUser||null,author_id:t.authorId||null,skip_users:t.skipUsers||null};return o.a.get(n,{params:s}).then(function(e){var t=e.data;a(t)})},c.prototype.buildUrl=function(e){return null!=gon.relative_url_root&&(e=gon.relative_url_root.replace(/\/$/,"")+e),e},t.a=c},850:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(21),i=a(81),o=a(11),l=a(1),d=a(7),u=a(5),c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initFilters(),this.bindEvents(),this.todo_ids=[],this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper)}return c(e,[{key:"cleanup",value:function(){this.unbindEvents(),document.removeEventListener("beforeunload",this.cleanupWrapper)}},{key:"unbindEvents",value:function(){s()(".js-done-todo, .js-undo-todo, .js-add-todo").off("click",this.updateRowStateClickedWrapper),s()(".js-todos-mark-all",".js-todos-undo-all").off("click",this.updateallStateClickedWrapper),s()(".todo").off("click",this.goToTodoUrl)}},{key:"bindEvents",value:function(){this.updateRowStateClickedWrapper=this.updateRowStateClicked.bind(this),this.updateAllStateClickedWrapper=this.updateAllStateClicked.bind(this),s()(".js-done-todo, .js-undo-todo, .js-add-todo").on("click",this.updateRowStateClickedWrapper),s()(".js-todos-mark-all, .js-todos-undo-all").on("click",this.updateAllStateClickedWrapper),s()(".todo").on("click",this.goToTodoUrl)}},{key:"initFilters",value:function(){return this.initFilterDropdown(s()(".js-group-search"),"group_id",["text"]),this.initFilterDropdown(s()(".js-project-search"),"project_id",["text"]),this.initFilterDropdown(s()(".js-type-search"),"type"),this.initFilterDropdown(s()(".js-action-search"),"action_id"),new i.a}},{key:"initFilterDropdown",value:function(e,t,a){e.glDropdown({fieldName:t,selectable:!0,filterable:!!a,search:{fields:a},data:e.data("data"),clicked:function(){var a=e.closest("form.filter-form");a.find('input[name="'+{group_id:"project_id",project_id:"group_id"}[t]+'"]').remove(),a.submit()}})}},{key:"updateRowStateClicked",value:function(e){var t=this;e.stopPropagation(),e.preventDefault();var a=e.target;a.setAttribute("disabled",!0),a.classList.add("disabled"),u.a[a.dataset.method](a.dataset.href).then(function(e){var n=e.data;t.updateRowState(a),t.updateBadges(n)}).catch(function(){return Object(d.a)(Object(l.a)("Error updating todo status."))})}},{key:"updateRowState",value:function(e){var t=e.closest("li"),a=t.querySelector(".js-undo-todo"),n=t.querySelector(".js-done-todo");e.classList.add("hidden"),e.removeAttribute("disabled"),e.classList.remove("disabled"),e===n?(t.classList.add("done-reversible"),a.classList.remove("hidden")):e===a?(t.classList.remove("done-reversible"),n.classList.remove("hidden")):t.parentNode.removeChild(t)}},{key:"updateAllStateClicked",value:function(e){var t=this;e.stopPropagation(),e.preventDefault();var a=e.currentTarget;a.setAttribute("disabled",!0),a.classList.add("disabled"),u.a[a.dataset.method](a.dataset.href,{ids:this.todo_ids}).then(function(e){var n=e.data;t.updateAllState(a,n),t.updateBadges(n)}).catch(function(){return Object(d.a)(Object(l.a)("Error updating status for all todos."))})}},{key:"updateAllState",value:function(e,t){var a=document.querySelector(".js-todos-mark-all"),n=document.querySelector(".js-todos-undo-all"),s=document.querySelector(".js-todos-list-container"),r=document.querySelector(".js-nothing-here-container");e.removeAttribute("disabled"),e.classList.remove("disabled"),this.todo_ids=e===a?t.updated_ids:[],n.classList.toggle("hidden"),a.classList.toggle("hidden"),s.classList.toggle("hidden"),r.classList.toggle("hidden")}},{key:"updateBadges",value:function(e){s()(document).trigger("todo:toggle",e.count),document.querySelector(".todos-pending .badge").innerHTML=e.count,document.querySelector(".todos-done .badge").innerHTML=e.done_count}},{key:"goToTodoUrl",value:function(e){var t=this.dataset.url;if(t&&"A"!==e.target.tagName&&"IMG"!==e.target.tagName)if(e.stopPropagation(),e.preventDefault(),Object(o.w)(e)){window.open(t,"_blank")}else Object(r.g)(t)}}]),e}();document.addEventListener("DOMContentLoaded",function(){return new f})}},[[1255,0,1]]]);
//# sourceMappingURL=pages.dashboard.todos.index.dd18b14a.chunk.js.map