{"version":3,"sources":["webpack:///./labels_select.js","webpack:///./create_label.js","webpack:///./issuable_bulk_update_actions.js","webpack:///./users_select.js"],"names":["LabelsSelect","els","_this","$els","options","arguments","length","undefined","_classCallCheck","this","jquery__WEBPACK_IMPORTED_MODULE_0___default","each","i","dropdown","$block","$dropdown","$form","$loading","$selectbox","$sidebarCollapsedValue","$value","abilityName","defaultLabel","issueUpdateURL","labelUrl","namespacePath","projectPath","saveLabelData","selectedLabel","showAny","showNo","$sidebarLabelTooltip","initialSelected","fieldName","showMenuAbove","$dropdownContainer","closest","find","data","hasClass","split","fadeOut","is","map","value","get","handleClick","tooltip","_create_label__WEBPACK_IMPORTED_MODULE_6__","selected","underscore__WEBPACK_IMPORTED_MODULE_1___default","a","isEqual","label_ids","removeClass","fadeIn","trigger","_lib_utils_axios_utils__WEBPACK_IMPORTED_MODULE_3__","put","then","_ref","labelCount","template","labelTooltipTitle","labelTitles","hide","labels","getLabelTemplate","removeAttr","html","text","label","title","slice","push","join","Object","_locale__WEBPACK_IMPORTED_MODULE_2__","attr","container","catch","_flash__WEBPACK_IMPORTED_MODULE_7__","glDropdown","term","callback","res","chain","groupBy","color","dup","id","duplicate","extraData","unshift","isAny","concat","positionMenuAbove","renderRow","instance","$a","$li","colorEl","indeterminate","removesAll","selectedClass","marked","dropdownName","dropdownValue","indexOf","splice","toString","replace","_filtered_search_dropdown_utils__WEBPACK_IMPORTED_MODULE_5__","duplicateLabelColor","_slicedToArray","addClass","escape","prop","search","fields","selectable","filterable","toggleLabel","el","$dropdownParent","parent","$dropdownInputField","isSelected","selectedLabels","val","index","hidden","isIssueIndex","isMRIndex","page","Issuable","filterResults","submit","multiSelect","vue","clicked","clickEvent","boardsModel","$el","e","isMarking","selectedObj","fadeOutLoader","enableBulkLabelDropdown","setDropdownData","_boards_stores_modal_store__WEBPACK_IMPORTED_MODULE_8__","store","filter","preventDefault","gl","issueBoards","BoardsStore","detail","issue","ListLabel","textColor","update","opened","previousSelection","updateLabel","preserveContext","setOriginalDropdownData","bindEvents","on","onSelectCheckboxIssue","_issuable_bulk_update_actions__WEBPACK_IMPORTED_MODULE_4__","willUpdateLabels","markedIds","unmarkedIds","indeterminateIds","getOriginalIndeterminateIds","getOriginalCommonIds","$container","tplData","tpl","CreateLabelDropdown","$dropdownBack","$cancelButton","$newLabelField","$newColorField","$colorPreview","$newLabelError","$newLabelCreateButton","$colorSuggestions","disable","cleanBinding","addBinding","off","self","$this","addColorValue","enableLabelCreateButton","bind","resetForm","stopPropagation","saveLabel","css","enable","_api__WEBPACK_IMPORTED_MODULE_1__","newLabel","message","errors","keys","key","_lib_utils_text_utility__WEBPACK_IMPORTED_MODULE_2__","show","document","_flash__WEBPACK_IMPORTED_MODULE_3__","__webpack_require__","init","form","issues","prefixId","getElement","$labelDropdown","onFormSubmit","_lib_utils_axios_utils__WEBPACK_IMPORTED_MODULE_2__","getFormDataAsObject","window","location","reload","onFormSubmitFailure","getSelectedIssues","has","getLabelsFromSelection","labelsData","labelId","getUnmarkedIndeterminedLabels","result","labelsToKeep","forEach","formData","state_event","assignee_id","assignee_ids","milestone_id","issuable_ids","subscription_event","add_label_ids","remove_label_ids","$labelSelect","getOriginalMarkedIds","_this2","labelIds","dataset","intersection","apply","_this3","_this4","uniqueIds","issuableLabels","difference","selector","scopeEl","UsersSelect","currentUser","users","user","usersPath","userPath","_typeof","JSON","parse","$collapsedSidebar","assignTo","assigneeTemplate","collapsedAssigneeTemplate","defaultNullUser","firstUser","issueURL","selectedId","selectedIdDefault","showAnyUser","showNullUser","projectId","groupId","showCurrentUser","todoFilter","todoStateFilter","authorId","assignYourself","unassignedSelected","remove","input","createElement","type","name","currentUserInfo","meta","before","after","addEventListener","getSelectedUserInputs","getSelected","parseInt","checkMaxSelect","maxSelect","firstSelectedId","emitSidebarEvent","getMultiSelectDropdownTitle","selectedUser","selectedUsers","u","otherSelected","s","currentTarget","$input","$","gon","current_user_id","current_user_fullname","tooltipTitle","assignee","username","avatar","avatar_url","_locale__WEBPACK_IMPORTED_MODULE_3__","processData","selectedInputs","uniq","userId","_input$dataset","avatarUrl","anyUser","len","obj","showDivider","beforeDivider","header","sort","b","filterRemote","inputValue","filterInput","filteredFullData","parseData","inputMeta","isActive","previouslySelected","toLowerCase","element","addInput","isSelecting","_boards_stores_modal_store__WEBPACK_IMPORTED_MODULE_4__","highlightSelected","img","default_avatar_url","select","showEmailUser","skipLdap","skipUsers","select2","placeholder","multiple","minimumInputLength","query","emailUser","nullUser","ref","results","match","trimmed","trim","invite","initSelection","args","call","formatResult","formatSelection","dropdownCssClass","escapeMarkup","m","noop","prototype","user_id","test","url","buildUrl","_ref2","params","active","project_id","group_id","skip_ldap","todo_filter","todo_state_filter","current_user","author_id","skip_users","_ref3","relative_url_root","__webpack_exports__"],"mappings":"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","file":"commons~pages.dashboard.issues~pages.dashboard.merge_requests~pages.groups.boards~pages.projects.iss~2716c7a5.7e5a63d9.chunk.js","sourcesContent":["/* eslint-disable no-useless-return, func-names, no-var, no-underscore-dangle, prefer-arrow-callback, max-len, one-var, no-unused-vars, one-var-declaration-per-line, prefer-template, no-new, consistent-return, object-shorthand, comma-dangle, no-shadow, no-param-reassign, brace-style, vars-on-top, quotes, no-lonely-if, no-else-return, dot-notation, no-empty */\n/* global Issuable */\n/* global ListLabel */\n\nimport $ from 'jquery';\nimport _ from 'underscore';\nimport { __ } from './locale';\nimport axios from './lib/utils/axios_utils';\nimport IssuableBulkUpdateActions from './issuable_bulk_update_actions';\nimport DropdownUtils from './filtered_search/dropdown_utils';\nimport CreateLabelDropdown from './create_label';\nimport flash from './flash';\nimport ModalStore from './boards/stores/modal_store';\n\nexport default class LabelsSelect {\n  constructor(els, options = {}) {\n    var _this, $els;\n    _this = this;\n\n    $els = $(els);\n\n    if (!els) {\n      $els = $('.js-label-select');\n    }\n\n    $els.each(function(i, dropdown) {\n      var $block, $colorPreview, $dropdown, $form, $loading, $selectbox, $sidebarCollapsedValue, $value, abilityName, defaultLabel, enableLabelCreateButton, issueURLSplit, issueUpdateURL, labelUrl, namespacePath, projectPath, saveLabelData, selectedLabel, showAny, showNo, $sidebarLabelTooltip, initialSelected, $toggleText, fieldName, useId, propertyName, showMenuAbove, $container, $dropdownContainer;\n      $dropdown = $(dropdown);\n      $dropdownContainer = $dropdown.closest('.labels-filter');\n      $toggleText = $dropdown.find('.dropdown-toggle-text');\n      namespacePath = $dropdown.data('namespacePath');\n      projectPath = $dropdown.data('projectPath');\n      labelUrl = $dropdown.data('labels');\n      issueUpdateURL = $dropdown.data('issueUpdate');\n      selectedLabel = $dropdown.data('selected');\n      if ((selectedLabel != null) && !$dropdown.hasClass('js-multiselect')) {\n        selectedLabel = selectedLabel.split(',');\n      }\n      showNo = $dropdown.data('showNo');\n      showAny = $dropdown.data('showAny');\n      showMenuAbove = $dropdown.data('showMenuAbove');\n      defaultLabel = $dropdown.data('defaultLabel') || 'Label';\n      abilityName = $dropdown.data('abilityName');\n      $selectbox = $dropdown.closest('.selectbox');\n      $block = $selectbox.closest('.block');\n      $form = $dropdown.closest('form, .js-issuable-update');\n      $sidebarCollapsedValue = $block.find('.sidebar-collapsed-icon span');\n      $sidebarLabelTooltip = $block.find('.js-sidebar-labels-tooltip');\n      $value = $block.find('.value');\n      $loading = $block.find('.block-loading').fadeOut();\n      fieldName = $dropdown.data('fieldName');\n      useId = $dropdown.is('.js-issuable-form-dropdown, .js-filter-bulk-update, .js-label-sidebar-dropdown');\n      propertyName = useId ? 'id' : 'title';\n      initialSelected = $selectbox\n        .find('input[name=\"' + $dropdown.data('fieldName') + '\"]')\n        .map(function () {\n          return this.value;\n        }).get();\n      const { handleClick } = options;\n\n      $sidebarLabelTooltip.tooltip();\n\n      if ($dropdown.closest('.dropdown').find('.dropdown-new-label').length) {\n        new CreateLabelDropdown($dropdown.closest('.dropdown').find('.dropdown-new-label'), namespacePath, projectPath);\n      }\n\n      saveLabelData = function() {\n        var data, selected;\n        selected = $dropdown.closest('.selectbox').find(\"input[name='\" + fieldName + \"']\").map(function() {\n          return this.value;\n        }).get();\n\n        if (_.isEqual(initialSelected, selected)) return;\n        initialSelected = selected;\n\n        data = {};\n        data[abilityName] = {};\n        data[abilityName].label_ids = selected;\n        if (!selected.length) {\n          data[abilityName].label_ids = [''];\n        }\n        $loading.removeClass('hidden').fadeIn();\n        $dropdown.trigger('loading.gl.dropdown');\n        axios.put(issueUpdateURL, data)\n          .then(({ data }) => {\n            var labelCount, template, labelTooltipTitle, labelTitles, formattedLabels;\n            $loading.fadeOut();\n            $dropdown.trigger('loaded.gl.dropdown');\n            $selectbox.hide();\n            data.issueUpdateURL = issueUpdateURL;\n            labelCount = 0;\n            if (data.labels.length && issueUpdateURL) {\n              template = LabelsSelect.getLabelTemplate({\n                labels: data.labels,\n                issueUpdateURL,\n              });\n              labelCount = data.labels.length;\n            }\n            else {\n              template = '<span class=\"no-value\">None</span>';\n            }\n            $value.removeAttr('style').html(template);\n            $sidebarCollapsedValue.text(labelCount);\n\n            if (data.labels.length) {\n              labelTitles = data.labels.map(function(label) {\n                return label.title;\n              });\n\n              if (labelTitles.length > 5) {\n                labelTitles = labelTitles.slice(0, 5);\n                labelTitles.push('and ' + (data.labels.length - 5) + ' more');\n              }\n\n              labelTooltipTitle = labelTitles.join(', ');\n            }\n            else {\n              labelTooltipTitle = __('Labels');\n            }\n\n            $sidebarLabelTooltip\n              .attr('title', labelTooltipTitle)\n              .tooltip('_fixTitle');\n\n            $('.has-tooltip', $value).tooltip({\n              container: 'body'\n            });\n          })\n          .catch(() => flash(__('Error saving label update.')));\n      };\n      $dropdown.glDropdown({\n        showMenuAbove: showMenuAbove,\n        data: function(term, callback) {\n          axios.get(labelUrl)\n            .then((res) => {\n              let data = _.chain(res.data).groupBy(function(label) {\n                return label.title;\n              }).map(function(label) {\n                var color;\n                color = _.map(label, function(dup) {\n                  return dup.color;\n                });\n                return {\n                  id: label[0].id,\n                  title: label[0].title,\n                  color: color,\n                  duplicate: color.length > 1\n                };\n              }).value();\n              if ($dropdown.hasClass('js-extra-options')) {\n                var extraData = [];\n                if (showNo) {\n                  extraData.unshift({\n                    id: 0,\n                    title: 'No Label'\n                  });\n                }\n                if (showAny) {\n                  extraData.unshift({\n                    isAny: true,\n                    title: 'Any Label'\n                  });\n                }\n                if (extraData.length) {\n                  extraData.push('divider');\n                  data = extraData.concat(data);\n                }\n              }\n\n              callback(data);\n              if (showMenuAbove) {\n                $dropdown.data('glDropdown').positionMenuAbove();\n              }\n            })\n            .catch(() => flash(__('Error fetching labels.')));\n        },\n        renderRow: function(label, instance) {\n          var $a, $li, color, colorEl, indeterminate, removesAll, selectedClass, spacing, i, marked, dropdownName, dropdownValue;\n          $li = $('<li>');\n          $a = $('<a href=\"#\">');\n          selectedClass = [];\n          removesAll = label.id <= 0 || (label.id == null);\n          if ($dropdown.hasClass('js-filter-bulk-update')) {\n            indeterminate = $dropdown.data('indeterminate') || [];\n            marked = $dropdown.data('marked') || [];\n\n            if (indeterminate.indexOf(label.id) !== -1) {\n              selectedClass.push('is-indeterminate');\n            }\n\n            if (marked.indexOf(label.id) !== -1) {\n              // Remove is-indeterminate class if the item will be marked as active\n              i = selectedClass.indexOf('is-indeterminate');\n              if (i !== -1) {\n                selectedClass.splice(i, 1);\n              }\n              selectedClass.push('is-active');\n            }\n          } else {\n            if (this.id(label)) {\n              dropdownName = $dropdown.data('fieldName');\n              dropdownValue = this.id(label).toString().replace(/'/g, '\\\\\\'');\n\n              if ($form.find(\"input[type='hidden'][name='\" + dropdownName + \"'][value='\" + dropdownValue + \"']\").length) {\n                selectedClass.push('is-active');\n              }\n            }\n\n            if ($dropdown.hasClass('js-multiselect') && removesAll) {\n              selectedClass.push('dropdown-clear-active');\n            }\n          }\n          if (label.duplicate) {\n            color = DropdownUtils.duplicateLabelColor(label.color);\n          }\n          else {\n            if (label.color != null) {\n              [color] = label.color;\n            }\n          }\n          if (color) {\n            colorEl = \"<span class='dropdown-label-box' style='background: \" + color + \"'></span>\";\n          }\n          else {\n            colorEl = '';\n          }\n          // We need to identify which items are actually labels\n          if (label.id) {\n            selectedClass.push('label-item');\n            $a.attr('data-label-id', label.id);\n          }\n          $a.addClass(selectedClass.join(' ')).html(`${colorEl} ${_.escape(label.title)}`);\n          // Return generated html\n          return $li.html($a).prop('outerHTML');\n        },\n        search: {\n          fields: ['title']\n        },\n        selectable: true,\n        filterable: true,\n        selected: $dropdown.data('selected') || [],\n        toggleLabel: function(selected, el) {\n          var $dropdownParent = $dropdown.parent();\n          var $dropdownInputField = $dropdownParent.find('.dropdown-input-field');\n          var isSelected = el !== null ? el.hasClass('is-active') : false;\n\n          var title = selected ? selected.title : null;\n          var selectedLabels = this.selected;\n\n          if ($dropdownInputField.length && $dropdownInputField.val().length) {\n            $dropdownParent.find('.dropdown-input-clear').trigger('click');\n          }\n\n          if (selected && selected.id === 0) {\n            this.selected = [];\n            return 'No Label';\n          }\n          else if (isSelected) {\n            this.selected.push(title);\n          }\n          else if (!isSelected && title) {\n            var index = this.selected.indexOf(title);\n            this.selected.splice(index, 1);\n          }\n\n          if (selectedLabels.length === 1) {\n            return selectedLabels;\n          }\n          else if (selectedLabels.length) {\n            return selectedLabels[0] + \" +\" + (selectedLabels.length - 1) + \" more\";\n          }\n          else {\n            return defaultLabel;\n          }\n        },\n        fieldName: $dropdown.data('fieldName'),\n        id: function(label) {\n          if (label.id <= 0) return label.title;\n\n          if ($dropdown.hasClass('js-issuable-form-dropdown')) {\n            return label.id;\n          }\n\n          if ($dropdown.hasClass(\"js-filter-submit\") && (label.isAny == null)) {\n            return label.title;\n          }\n          else {\n            return label.id;\n          }\n        },\n        hidden: function() {\n          var isIssueIndex, isMRIndex, page, selectedLabels;\n          page = $('body').attr('data-page');\n          isIssueIndex = page === 'projects:issues:index';\n          isMRIndex = page === 'projects:merge_requests:index';\n          $selectbox.hide();\n          // display:block overrides the hide-collapse rule\n          $value.removeAttr('style');\n\n          if ($dropdown.hasClass('js-issuable-form-dropdown')) {\n            return;\n          }\n\n          if ($('html').hasClass('issue-boards-page')) {\n            return;\n          }\n          if ($dropdown.hasClass('js-multiselect')) {\n            if ($dropdown.hasClass('js-filter-submit') && (isIssueIndex || isMRIndex)) {\n              selectedLabels = $dropdown.closest('form').find(\"input:hidden[name='\" + ($dropdown.data('fieldName')) + \"']\");\n              Issuable.filterResults($dropdown.closest('form'));\n            }\n            else if ($dropdown.hasClass('js-filter-submit')) {\n              $dropdown.closest('form').submit();\n            }\n            else {\n              if (!$dropdown.hasClass('js-filter-bulk-update')) {\n                saveLabelData();\n              }\n            }\n          }\n        },\n        multiSelect: $dropdown.hasClass('js-multiselect'),\n        vue: $dropdown.hasClass('js-issue-board-sidebar'),\n        clicked: function (clickEvent) {\n          const { $el, e, isMarking } = clickEvent;\n          const label = clickEvent.selectedObj;\n\n          var isIssueIndex, isMRIndex, page, boardsModel;\n          var fadeOutLoader = () => {\n            $loading.fadeOut();\n          };\n\n          page = $('body').attr('data-page');\n          isIssueIndex = page === 'projects:issues:index';\n          isMRIndex = page === 'projects:merge_requests:index';\n\n          if ($dropdown.parent().find('.is-active:not(.dropdown-clear-active)').length) {\n            $dropdown.parent()\n              .find('.dropdown-clear-active')\n              .removeClass('is-active');\n          }\n\n          if ($dropdown.hasClass('js-issuable-form-dropdown')) {\n            return;\n          }\n\n          if ($dropdown.hasClass('js-filter-bulk-update')) {\n            _this.enableBulkLabelDropdown();\n            _this.setDropdownData($dropdown, isMarking, label.id);\n            return;\n          }\n\n          if ($dropdown.closest('.add-issues-modal').length) {\n            boardsModel = ModalStore.store.filter;\n          }\n\n          if (boardsModel) {\n            if (label.isAny) {\n              boardsModel['label_name'] = [];\n            } else if ($el.hasClass('is-active')) {\n              boardsModel['label_name'].push(label.title);\n            }\n\n            e.preventDefault();\n            return;\n          }\n          else if ($dropdown.hasClass('js-filter-submit') && (isIssueIndex || isMRIndex)) {\n            if (!$dropdown.hasClass('js-multiselect')) {\n              selectedLabel = label.title;\n              return Issuable.filterResults($dropdown.closest('form'));\n            }\n          }\n          else if ($dropdown.hasClass('js-filter-submit')) {\n            return $dropdown.closest('form').submit();\n          }\n          else if ($dropdown.hasClass('js-issue-board-sidebar')) {\n            if ($el.hasClass('is-active')) {\n              gl.issueBoards.BoardsStore.detail.issue.labels.push(new ListLabel({\n                id: label.id,\n                title: label.title,\n                color: label.color[0],\n                textColor: '#fff'\n              }));\n            }\n            else {\n              var { labels } = gl.issueBoards.BoardsStore.detail.issue;\n              labels = labels.filter(function (selectedLabel) {\n                return selectedLabel.id !== label.id;\n              });\n              gl.issueBoards.BoardsStore.detail.issue.labels = labels;\n            }\n\n            $loading.fadeIn();\n\n            gl.issueBoards.BoardsStore.detail.issue.update($dropdown.attr('data-issue-update'))\n              .then(fadeOutLoader)\n              .catch(fadeOutLoader);\n          }\n          else if (handleClick) {\n            e.preventDefault();\n            handleClick(label);\n          }\n          else {\n            if ($dropdown.hasClass('js-multiselect')) {\n\n            }\n            else {\n              return saveLabelData();\n            }\n          }\n        },\n        opened: function(e) {\n          if ($dropdown.hasClass('js-issue-board-sidebar')) {\n            const previousSelection = $dropdown.attr('data-selected');\n            this.selected = previousSelection ? previousSelection.split(',') : [];\n            $dropdown.data('glDropdown').updateLabel();\n          }\n        },\n        preserveContext: true,\n      });\n\n      // Set dropdown data\n      _this.setOriginalDropdownData($dropdownContainer, $dropdown);\n    });\n    this.bindEvents();\n  }\n\n  static getLabelTemplate(tplData) {\n    // We could use ES6 template string here\n    // and properly indent markup for readability\n    // but that also introduces unintended white-space\n    // so best approach is to use traditional way of\n    // concatenation\n    // see: http://2ality.com/2016/05/template-literal-whitespace.html#joining-arrays\n    const tpl = _.template([\n      '<% _.each(labels, function(label){ %>',\n      '<a href=\"<%- issueUpdateURL.slice(0, issueUpdateURL.lastIndexOf(\"/\")) %>?label_name[]=<%- encodeURIComponent(label.title) %>\">',\n      '<span class=\"badge label has-tooltip color-label\" title=\"<%- label.description %>\" style=\"background-color: <%- label.color %>; color: <%- label.text_color %>;\">',\n      '<%- label.title %>',\n      '</span>',\n      '</a>',\n      '<% }); %>',\n    ].join(''));\n\n    return tpl(tplData);\n  }\n\n  bindEvents() {\n    return $('body').on('change', '.selected_issue', this.onSelectCheckboxIssue);\n  }\n  // eslint-disable-next-line class-methods-use-this\n  onSelectCheckboxIssue() {\n    if ($('.selected_issue:checked').length) {\n      return;\n    }\n    return $('.issues-bulk-update .labels-filter .dropdown-toggle-text').text('Label');\n  }\n  // eslint-disable-next-line class-methods-use-this\n  enableBulkLabelDropdown() {\n    IssuableBulkUpdateActions.willUpdateLabels = true;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  setDropdownData($dropdown, isMarking, value) {\n    var i, markedIds, unmarkedIds, indeterminateIds;\n\n    markedIds = $dropdown.data('marked') || [];\n    unmarkedIds = $dropdown.data('unmarked') || [];\n    indeterminateIds = $dropdown.data('indeterminate') || [];\n\n    if (isMarking) {\n      markedIds.push(value);\n\n      i = indeterminateIds.indexOf(value);\n      if (i > -1) {\n        indeterminateIds.splice(i, 1);\n      }\n\n      i = unmarkedIds.indexOf(value);\n      if (i > -1) {\n        unmarkedIds.splice(i, 1);\n      }\n    } else {\n      // If marked item (not common) is unmarked\n      i = markedIds.indexOf(value);\n      if (i > -1) {\n        markedIds.splice(i, 1);\n      }\n\n      // If an indeterminate item is being unmarked\n      if (IssuableBulkUpdateActions.getOriginalIndeterminateIds().indexOf(value) > -1) {\n        unmarkedIds.push(value);\n      }\n\n      // If a marked item is being unmarked\n      // (a marked item could also be a label that is present in all selection)\n      if (IssuableBulkUpdateActions.getOriginalCommonIds().indexOf(value) > -1) {\n        unmarkedIds.push(value);\n      }\n    }\n\n    $dropdown.data('marked', markedIds);\n    $dropdown.data('unmarked', unmarkedIds);\n    $dropdown.data('indeterminate', indeterminateIds);\n  }\n  // eslint-disable-next-line class-methods-use-this\n  setOriginalDropdownData($container, $dropdown) {\n    const labels = [];\n    $container.find('[name=\"label_name[]\"]').map(function() {\n      return labels.push(this.value);\n    });\n    $dropdown.data('marked', labels);\n  }\n}\n","/* eslint-disable func-names, prefer-arrow-callback */\n\nimport $ from 'jquery';\nimport Api from './api';\nimport { humanize } from './lib/utils/text_utility';\n\nexport default class CreateLabelDropdown {\n  constructor($el, namespacePath, projectPath) {\n    this.$el = $el;\n    this.namespacePath = namespacePath;\n    this.projectPath = projectPath;\n    this.$dropdownBack = $('.dropdown-menu-back', this.$el.closest('.dropdown'));\n    this.$cancelButton = $('.js-cancel-label-btn', this.$el);\n    this.$newLabelField = $('#new_label_name', this.$el);\n    this.$newColorField = $('#new_label_color', this.$el);\n    this.$colorPreview = $('.js-dropdown-label-color-preview', this.$el);\n    this.$newLabelError = $('.js-label-error', this.$el);\n    this.$newLabelCreateButton = $('.js-new-label-btn', this.$el);\n    this.$colorSuggestions = $('.suggest-colors-dropdown a', this.$el);\n\n    this.$newLabelError.hide();\n    this.$newLabelCreateButton.disable();\n\n    this.cleanBinding();\n    this.addBinding();\n  }\n\n  cleanBinding() {\n    this.$colorSuggestions.off('click');\n    this.$newLabelField.off('keyup change');\n    this.$newColorField.off('keyup change');\n    this.$dropdownBack.off('click');\n    this.$cancelButton.off('click');\n    this.$newLabelCreateButton.off('click');\n  }\n\n  addBinding() {\n    const self = this;\n\n    this.$colorSuggestions.on('click', function (e) {\n      const $this = $(this);\n      self.addColorValue(e, $this);\n    });\n\n    this.$newLabelField.on('keyup change', this.enableLabelCreateButton.bind(this));\n    this.$newColorField.on('keyup change', this.enableLabelCreateButton.bind(this));\n\n    this.$dropdownBack.on('click', this.resetForm.bind(this));\n\n    this.$cancelButton.on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      self.resetForm();\n      self.$dropdownBack.trigger('click');\n    });\n\n    this.$newLabelCreateButton.on('click', this.saveLabel.bind(this));\n  }\n\n  addColorValue(e, $this) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.$newColorField.val($this.data('color')).trigger('change');\n    this.$colorPreview\n      .css('background-color', $this.data('color'))\n      .parent()\n      .addClass('is-active');\n  }\n\n  enableLabelCreateButton() {\n    if (this.$newLabelField.val() !== '' && this.$newColorField.val() !== '') {\n      this.$newLabelError.hide();\n      this.$newLabelCreateButton.enable();\n    } else {\n      this.$newLabelCreateButton.disable();\n    }\n  }\n\n  resetForm() {\n    this.$newLabelField\n      .val('')\n      .trigger('change');\n\n    this.$newColorField\n      .val('')\n      .trigger('change');\n\n    this.$colorPreview\n      .css('background-color', '')\n      .parent()\n      .removeClass('is-active');\n  }\n\n  saveLabel(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    Api.newLabel(this.namespacePath, this.projectPath, {\n      title: this.$newLabelField.val(),\n      color: this.$newColorField.val(),\n    }, (label) => {\n      this.$newLabelCreateButton.enable();\n\n      if (label.message) {\n        let errors;\n\n        if (typeof label.message === 'string') {\n          errors = label.message;\n        } else {\n          errors = Object.keys(label.message).map(key =>\n            `${humanize(key)} ${label.message[key].join(', ')}`,\n          ).join('<br/>');\n        }\n\n        this.$newLabelError\n          .html(errors)\n          .show();\n      } else {\n        this.$dropdownBack.trigger('click');\n\n        $(document).trigger('created.label', label);\n      }\n    });\n  }\n}\n","/* eslint-disable comma-dangle, quotes, consistent-return, func-names, array-callback-return, prefer-arrow-callback, max-len, no-unused-vars */\n\nimport $ from 'jquery';\nimport _ from 'underscore';\nimport axios from './lib/utils/axios_utils';\nimport Flash from './flash';\n\nexport default {\n  init({ container, form, issues, prefixId } = {}) {\n    this.prefixId = prefixId || 'issue_';\n    this.form = form || this.getElement('.bulk-update');\n    this.$labelDropdown = this.form.find('.js-label-select');\n    this.issues = issues || this.getElement('.issues-list .issue');\n    this.willUpdateLabels = false;\n    this.bindEvents();\n  },\n\n  bindEvents() {\n    return this.form.off('submit').on('submit', this.onFormSubmit.bind(this));\n  },\n\n  onFormSubmit(e) {\n    e.preventDefault();\n    return this.submit();\n  },\n\n  submit() {\n    axios[this.form.attr('method')](this.form.attr('action'), this.getFormDataAsObject())\n      .then(() => window.location.reload())\n      .catch(() => this.onFormSubmitFailure());\n  },\n\n  onFormSubmitFailure() {\n    this.form.find('[type=\"submit\"]').enable();\n    return new Flash(\"Issue update failed\");\n  },\n\n  getSelectedIssues() {\n    return this.issues.has('.selected_issue:checked');\n  },\n\n  getLabelsFromSelection() {\n    const labels = [];\n    this.getSelectedIssues().map(function() {\n      const labelsData = $(this).data('labels');\n      if (labelsData) {\n        return labelsData.map(function(labelId) {\n          if (labels.indexOf(labelId) === -1) {\n            return labels.push(labelId);\n          }\n        });\n      }\n    });\n    return labels;\n  },\n\n  /**\n   * Will return only labels that were marked previously and the user has unmarked\n   * @return {Array} Label IDs\n   */\n\n  getUnmarkedIndeterminedLabels() {\n    const result = [];\n    const labelsToKeep = this.$labelDropdown.data('indeterminate');\n\n    this.getLabelsFromSelection().forEach((id) => {\n      if (labelsToKeep.indexOf(id) === -1) {\n        result.push(id);\n      }\n    });\n\n    return result;\n  },\n\n  /**\n   * Simple form serialization, it will return just what we need\n   * Returns key/value pairs from form data\n   */\n\n  getFormDataAsObject() {\n    const formData = {\n      update: {\n        state_event: this.form.find('input[name=\"update[state_event]\"]').val(),\n        // For Merge Requests\n        assignee_id: this.form.find('input[name=\"update[assignee_id]\"]').val(),\n        // For Issues\n        assignee_ids: [this.form.find('input[name=\"update[assignee_ids][]\"]').val()],\n        milestone_id: this.form.find('input[name=\"update[milestone_id]\"]').val(),\n        issuable_ids: this.form.find('input[name=\"update[issuable_ids]\"]').val(),\n        subscription_event: this.form.find('input[name=\"update[subscription_event]\"]').val(),\n        add_label_ids: [],\n        remove_label_ids: []\n      }\n    };\n    if (this.willUpdateLabels) {\n      formData.update.add_label_ids = this.$labelDropdown.data('marked');\n      formData.update.remove_label_ids = this.$labelDropdown.data('unmarked');\n    }\n    return formData;\n  },\n\n  setOriginalDropdownData() {\n    const $labelSelect = $('.bulk-update .js-label-select');\n    $labelSelect.data('common', this.getOriginalCommonIds());\n    $labelSelect.data('marked', this.getOriginalMarkedIds());\n    $labelSelect.data('indeterminate', this.getOriginalIndeterminateIds());\n  },\n\n  // From issuable's initial bulk selection\n  getOriginalCommonIds() {\n    const labelIds = [];\n\n    this.getElement('.selected_issue:checked').each((i, el) => {\n      labelIds.push(this.getElement(`#${this.prefixId}${el.dataset.id}`).data('labels'));\n    });\n    return _.intersection.apply(this, labelIds);\n  },\n\n  // From issuable's initial bulk selection\n  getOriginalMarkedIds() {\n    const labelIds = [];\n    this.getElement('.selected_issue:checked').each((i, el) => {\n      labelIds.push(this.getElement(`#${this.prefixId}${el.dataset.id}`).data('labels'));\n    });\n    return _.intersection.apply(this, labelIds);\n  },\n\n  // From issuable's initial bulk selection\n  getOriginalIndeterminateIds() {\n    const uniqueIds = [];\n    const labelIds = [];\n    let issuableLabels = [];\n\n    // Collect unique label IDs for all checked issues\n    this.getElement('.selected_issue:checked').each((i, el) => {\n      issuableLabels = this.getElement(`#${this.prefixId}${el.dataset.id}`).data('labels');\n      issuableLabels.forEach((labelId) => {\n        // Store unique IDs\n        if (uniqueIds.indexOf(labelId) === -1) {\n          uniqueIds.push(labelId);\n        }\n      });\n      // Store array of IDs per issuable\n      labelIds.push(issuableLabels);\n    });\n    // Add uniqueIds to add it as argument for _.intersection\n    labelIds.unshift(uniqueIds);\n    // Return IDs that are present but not in all selected issueables\n    return _.difference(uniqueIds, _.intersection.apply(this, labelIds));\n  },\n\n  getElement(selector) {\n    this.scopeEl = this.scopeEl || $('.content');\n    return this.scopeEl.find(selector);\n  },\n};\n","/* eslint-disable func-names, one-var, no-var, prefer-rest-params, quotes, max-len, one-var-declaration-per-line, vars-on-top, prefer-arrow-callback, consistent-return, comma-dangle, object-shorthand, no-shadow, no-unused-vars, no-else-return, no-self-compare, prefer-template, no-unused-expressions, yoda, prefer-spread, no-void, camelcase, no-param-reassign */\n/* global Issuable */\n/* global emitSidebarEvent */\n\nimport $ from 'jquery';\nimport _ from 'underscore';\nimport axios from './lib/utils/axios_utils';\nimport { __ } from './locale';\nimport ModalStore from './boards/stores/modal_store';\n\n// TODO: remove eventHub hack after code splitting refactor\nwindow.emitSidebarEvent = window.emitSidebarEvent || $.noop;\n\nfunction UsersSelect(currentUser, els, options = {}) {\n  var $els;\n  this.users = this.users.bind(this);\n  this.user = this.user.bind(this);\n  this.usersPath = \"/autocomplete/users.json\";\n  this.userPath = \"/autocomplete/users/:id.json\";\n  if (currentUser != null) {\n    if (typeof currentUser === 'object') {\n      this.currentUser = currentUser;\n    } else {\n      this.currentUser = JSON.parse(currentUser);\n    }\n  }\n\n  const { handleClick } = options;\n\n  $els = $(els);\n\n  if (!els) {\n    $els = $('.js-user-search');\n  }\n\n  $els.each((function(_this) {\n    return function(i, dropdown) {\n      var options = {};\n      var $block, $collapsedSidebar, $dropdown, $loading, $selectbox, $value, abilityName, assignTo, assigneeTemplate, collapsedAssigneeTemplate, defaultLabel, defaultNullUser, firstUser, issueURL, selectedId, selectedIdDefault, showAnyUser, showNullUser, showMenuAbove;\n      $dropdown = $(dropdown);\n      options.projectId = $dropdown.data('projectId');\n      options.groupId = $dropdown.data('groupId');\n      options.showCurrentUser = $dropdown.data('currentUser');\n      options.todoFilter = $dropdown.data('todoFilter');\n      options.todoStateFilter = $dropdown.data('todoStateFilter');\n      showNullUser = $dropdown.data('nullUser');\n      defaultNullUser = $dropdown.data('nullUserDefault');\n      showMenuAbove = $dropdown.data('showMenuAbove');\n      showAnyUser = $dropdown.data('anyUser');\n      firstUser = $dropdown.data('firstUser');\n      options.authorId = $dropdown.data('authorId');\n      defaultLabel = $dropdown.data('defaultLabel');\n      issueURL = $dropdown.data('issueUpdate');\n      $selectbox = $dropdown.closest('.selectbox');\n      $block = $selectbox.closest('.block');\n      abilityName = $dropdown.data('abilityName');\n      $value = $block.find('.value');\n      $collapsedSidebar = $block.find('.sidebar-collapsed-user');\n      $loading = $block.find('.block-loading').fadeOut();\n      selectedIdDefault = (defaultNullUser && showNullUser) ? 0 : null;\n      selectedId = $dropdown.data('selected');\n\n      if (selectedId === undefined) {\n        selectedId = selectedIdDefault;\n      }\n\n      const assignYourself = function () {\n        const unassignedSelected = $dropdown.closest('.selectbox')\n          .find(`input[name='${$dropdown.data('fieldName')}'][value=0]`);\n\n        if (unassignedSelected) {\n          unassignedSelected.remove();\n        }\n\n        // Save current selected user to the DOM\n        const input = document.createElement('input');\n        input.type = 'hidden';\n        input.name = $dropdown.data('fieldName');\n\n        const currentUserInfo = $dropdown.data('currentUserInfo');\n\n        if (currentUserInfo) {\n          input.value = currentUserInfo.id;\n          input.dataset.meta = _.escape(currentUserInfo.name);\n        } else if (_this.currentUser) {\n          input.value = _this.currentUser.id;\n        }\n\n        if ($selectbox) {\n          $dropdown.parent().before(input);\n        } else {\n          $dropdown.after(input);\n        }\n      };\n\n      if ($block[0]) {\n        $block[0].addEventListener('assignYourself', assignYourself);\n      }\n\n      const getSelectedUserInputs = function() {\n        return $selectbox\n          .find(`input[name=\"${$dropdown.data('fieldName')}\"]`);\n      };\n\n      const getSelected = function() {\n        return getSelectedUserInputs()\n          .map((index, input) => parseInt(input.value, 10))\n          .get();\n      };\n\n      const checkMaxSelect = function() {\n        const maxSelect = $dropdown.data('maxSelect');\n        if (maxSelect) {\n          const selected = getSelected();\n\n          if (selected.length > maxSelect) {\n            const firstSelectedId = selected[0];\n            const firstSelected = $dropdown.closest('.selectbox')\n              .find(`input[name='${$dropdown.data('fieldName')}'][value=${firstSelectedId}]`);\n\n            firstSelected.remove();\n            emitSidebarEvent('sidebar.removeAssignee', {\n              id: firstSelectedId,\n            });\n          }\n        }\n      };\n\n      const getMultiSelectDropdownTitle = function(selectedUser, isSelected) {\n        const selectedUsers = getSelected()\n          .filter(u => u !== 0);\n\n        const firstUser = getSelectedUserInputs()\n          .map((index, input) => ({\n            name: input.dataset.meta,\n            value: parseInt(input.value, 10),\n          }))\n          .filter(u => u.id !== 0)\n          .get(0);\n\n        if (selectedUsers.length === 0) {\n          return 'Unassigned';\n        } else if (selectedUsers.length === 1) {\n          return firstUser.name;\n        } else if (isSelected) {\n          const otherSelected = selectedUsers.filter(s => s !== selectedUser.id);\n          return `${selectedUser.name} + ${otherSelected.length} more`;\n        } else {\n          return `${firstUser.name} + ${selectedUsers.length - 1} more`;\n        }\n      };\n\n      $('.assign-to-me-link').on('click', (e) => {\n        e.preventDefault();\n        $(e.currentTarget).hide();\n\n        if ($dropdown.data('multiSelect')) {\n          assignYourself();\n          checkMaxSelect();\n\n          const currentUserInfo = $dropdown.data('currentUserInfo');\n          $dropdown.find('.dropdown-toggle-text').text(getMultiSelectDropdownTitle(currentUserInfo)).removeClass('is-default');\n        } else {\n          const $input = $(`input[name=\"${$dropdown.data('fieldName')}\"]`);\n          $input.val(gon.current_user_id);\n          selectedId = $input.val();\n          $dropdown.find('.dropdown-toggle-text').text(gon.current_user_fullname).removeClass('is-default');\n        }\n      });\n\n      $block.on('click', '.js-assign-yourself', (e) => {\n        e.preventDefault();\n        return assignTo(_this.currentUser.id);\n      });\n\n      assignTo = function(selected) {\n        var data;\n        data = {};\n        data[abilityName] = {};\n        data[abilityName].assignee_id = selected != null ? selected : null;\n        $loading.removeClass('hidden').fadeIn();\n        $dropdown.trigger('loading.gl.dropdown');\n\n        return axios.put(issueURL, data)\n          .then(({ data }) => {\n            var user, tooltipTitle;\n            $dropdown.trigger('loaded.gl.dropdown');\n            $loading.fadeOut();\n            if (data.assignee) {\n              user = {\n                name: data.assignee.name,\n                username: data.assignee.username,\n                avatar: data.assignee.avatar_url\n              };\n              tooltipTitle = _.escape(user.name);\n            } else {\n              user = {\n                name: 'Unassigned',\n                username: '',\n                avatar: ''\n              };\n              tooltipTitle = __('Assignee');\n            }\n            $value.html(assigneeTemplate(user));\n            $collapsedSidebar.attr('title', tooltipTitle).tooltip('_fixTitle');\n            return $collapsedSidebar.html(collapsedAssigneeTemplate(user));\n          });\n      };\n      collapsedAssigneeTemplate = _.template('<% if( avatar ) { %> <a class=\"author-link\" href=\"/<%- username %>\"> <img width=\"24\" class=\"avatar avatar-inline s24\" alt=\"\" src=\"<%- avatar %>\"> </a> <% } else { %> <i class=\"fa fa-user\"></i> <% } %>');\n      assigneeTemplate = _.template('<% if (username) { %> <a class=\"author-link bold\" href=\"/<%- username %>\"> <% if( avatar ) { %> <img width=\"32\" class=\"avatar avatar-inline s32\" alt=\"\" src=\"<%- avatar %>\"> <% } %> <span class=\"author\"><%- name %></span> <span class=\"username\"> @<%- username %> </span> </a> <% } else { %> <span class=\"no-value assign-yourself\"> No assignee - <a href=\"#\" class=\"js-assign-yourself\"> assign yourself </a> </span> <% } %>');\n      return $dropdown.glDropdown({\n        showMenuAbove: showMenuAbove,\n        data: function(term, callback) {\n          return _this.users(term, options, function(users) {\n            // GitLabDropdownFilter returns this.instance\n            // GitLabDropdownRemote returns this.options.instance\n            const glDropdown = this.instance || this.options.instance;\n            glDropdown.options.processData(term, users, callback);\n          }.bind(this));\n        },\n        processData: function(term, data, callback) {\n          let users = data;\n\n          // Only show assigned user list when there is no search term\n          if ($dropdown.hasClass('js-multiselect') && term.length === 0) {\n            const selectedInputs = getSelectedUserInputs();\n\n            // Potential duplicate entries when dealing with issue board\n            // because issue board is also managed by vue\n            const selectedUsers = _.uniq(selectedInputs, false, a => a.value)\n              .filter((input) => {\n                const userId = parseInt(input.value, 10);\n                const inUsersArray = users.find(u => u.id === userId);\n\n                return !inUsersArray && userId !== 0;\n              })\n              .map((input) => {\n                const userId = parseInt(input.value, 10);\n                const { avatarUrl, avatar_url, name, username } = input.dataset;\n                return {\n                  avatar_url: avatarUrl || avatar_url,\n                  id: userId,\n                  name,\n                  username,\n                };\n              });\n\n            users = data.concat(selectedUsers);\n          }\n\n          let anyUser;\n          let index;\n          let len;\n          let name;\n          let obj;\n          let showDivider;\n          if (term.length === 0) {\n            showDivider = 0;\n            if (firstUser) {\n              // Move current user to the front of the list\n              for (index = 0, len = users.length; index < len; index += 1) {\n                obj = users[index];\n                if (obj.username === firstUser) {\n                  users.splice(index, 1);\n                  users.unshift(obj);\n                  break;\n                }\n              }\n            }\n            if (showNullUser) {\n              showDivider += 1;\n              users.unshift({\n                beforeDivider: true,\n                name: 'Unassigned',\n                id: 0\n              });\n            }\n            if (showAnyUser) {\n              showDivider += 1;\n              name = showAnyUser;\n              if (name === true) {\n                name = 'Any User';\n              }\n              anyUser = {\n                beforeDivider: true,\n                name: name,\n                id: null\n              };\n              users.unshift(anyUser);\n            }\n\n            if (showDivider) {\n              users.splice(showDivider, 0, 'divider');\n            }\n\n            if ($dropdown.hasClass('js-multiselect')) {\n              const selected = getSelected().filter(i => i !== 0);\n\n              if (selected.length > 0) {\n                if ($dropdown.data('dropdownHeader')) {\n                  showDivider += 1;\n                  users.splice(showDivider, 0, {\n                    header: $dropdown.data('dropdownHeader'),\n                  });\n                }\n\n                const selectedUsers = users\n                  .filter(u => selected.indexOf(u.id) !== -1)\n                  .sort((a, b) => a.name > b.name);\n\n                users = users.filter(u => selected.indexOf(u.id) === -1);\n\n                selectedUsers.forEach((selectedUser) => {\n                  showDivider += 1;\n                  users.splice(showDivider, 0, selectedUser);\n                });\n\n                users.splice(showDivider + 1, 0, 'divider');\n              }\n            }\n          }\n\n          callback(users);\n          if (showMenuAbove) {\n            $dropdown.data('glDropdown').positionMenuAbove();\n          }\n        },\n        filterable: true,\n        filterRemote: true,\n        search: {\n          fields: ['name', 'username']\n        },\n        selectable: true,\n        fieldName: $dropdown.data('fieldName'),\n        toggleLabel: function(selected, el, glDropdown) {\n          const inputValue = glDropdown.filterInput.val();\n\n          if (this.multiSelect && inputValue === '') {\n            // Remove non-users from the fullData array\n            const users = glDropdown.filteredFullData();\n            const callback = glDropdown.parseData.bind(glDropdown);\n\n            // Update the data model\n            this.processData(inputValue, users, callback);\n          }\n\n          if (this.multiSelect) {\n            return getMultiSelectDropdownTitle(selected, $(el).hasClass('is-active'));\n          }\n\n          if (selected && 'id' in selected && $(el).hasClass('is-active')) {\n            $dropdown.find('.dropdown-toggle-text').removeClass('is-default');\n            if (selected.text) {\n              return selected.text;\n            } else {\n              return selected.name;\n            }\n          } else {\n            $dropdown.find('.dropdown-toggle-text').addClass('is-default');\n            return defaultLabel;\n          }\n        },\n        defaultLabel: defaultLabel,\n        hidden: function(e) {\n          if ($dropdown.hasClass('js-multiselect')) {\n            emitSidebarEvent('sidebar.saveAssignees');\n          }\n\n          if (!$dropdown.data('alwaysShowSelectbox')) {\n            $selectbox.hide();\n\n            // Recalculate where .value is because vue might have changed it\n            $block = $selectbox.closest('.block');\n            $value = $block.find('.value');\n            // display:block overrides the hide-collapse rule\n            $value.css('display', '');\n          }\n        },\n        multiSelect: $dropdown.hasClass('js-multiselect'),\n        inputMeta: $dropdown.data('inputMeta'),\n        clicked: function(options) {\n          const { $el, e, isMarking } = options;\n          const user = options.selectedObj;\n\n          if ($dropdown.hasClass('js-multiselect')) {\n            const isActive = $el.hasClass('is-active');\n            const previouslySelected = $dropdown.closest('.selectbox')\n                .find(\"input[name='\" + ($dropdown.data('fieldName')) + \"'][value!=0]\");\n\n            // Enables support for limiting the number of users selected\n            // Automatically removes the first on the list if more users are selected\n            checkMaxSelect();\n\n            if (user.beforeDivider && user.name.toLowerCase() === 'unassigned') {\n              // Unassigned selected\n              previouslySelected.each((index, element) => {\n                const id = parseInt(element.value, 10);\n                element.remove();\n              });\n              emitSidebarEvent('sidebar.removeAllAssignees');\n            } else if (isActive) {\n              // user selected\n              emitSidebarEvent('sidebar.addAssignee', user);\n\n              // Remove unassigned selection (if it was previously selected)\n              const unassignedSelected = $dropdown.closest('.selectbox')\n                .find(\"input[name='\" + ($dropdown.data('fieldName')) + \"'][value=0]\");\n\n              if (unassignedSelected) {\n                unassignedSelected.remove();\n              }\n            } else {\n              if (previouslySelected.length === 0) {\n              // Select unassigned because there is no more selected users\n                this.addInput($dropdown.data('fieldName'), 0, {});\n              }\n\n              // User unselected\n              emitSidebarEvent('sidebar.removeAssignee', user);\n            }\n\n            if (getSelected().find(u => u === gon.current_user_id)) {\n              $('.assign-to-me-link').hide();\n            } else {\n              $('.assign-to-me-link').show();\n            }\n          }\n\n          var isIssueIndex, isMRIndex, page, selected;\n          page = $('body').attr('data-page');\n          isIssueIndex = page === 'projects:issues:index';\n          isMRIndex = (page === page && page === 'projects:merge_requests:index');\n          if ($dropdown.hasClass('js-filter-bulk-update') || $dropdown.hasClass('js-issuable-form-dropdown')) {\n            e.preventDefault();\n\n            const isSelecting = (user.id !== selectedId);\n            selectedId = isSelecting ? user.id : selectedIdDefault;\n\n            if (selectedId === gon.current_user_id) {\n              $('.assign-to-me-link').hide();\n            } else {\n              $('.assign-to-me-link').show();\n            }\n            return;\n          }\n          if ($el.closest('.add-issues-modal').length) {\n            ModalStore.store.filter[$dropdown.data('fieldName')] = user.id;\n          } else if (handleClick) {\n            e.preventDefault();\n            handleClick(user, isMarking);\n          } else if ($dropdown.hasClass('js-filter-submit') && (isIssueIndex || isMRIndex)) {\n            return Issuable.filterResults($dropdown.closest('form'));\n          } else if ($dropdown.hasClass('js-filter-submit')) {\n            return $dropdown.closest('form').submit();\n          } else if (!$dropdown.hasClass('js-multiselect')) {\n            selected = $dropdown.closest('.selectbox').find(\"input[name='\" + ($dropdown.data('fieldName')) + \"']\").val();\n            return assignTo(selected);\n          }\n\n          // Automatically close dropdown after assignee is selected\n          // since CE has no multiple assignees\n          // EE does not have a max-select\n          if ($dropdown.data('maxSelect') &&\n              getSelected().length === $dropdown.data('maxSelect')) {\n            // Close the dropdown\n            $dropdown.dropdown('toggle');\n          }\n        },\n        id: function (user) {\n          return user.id;\n        },\n        opened: function(e) {\n          const $el = $(e.currentTarget);\n          const selected = getSelected();\n          if ($dropdown.hasClass('js-issue-board-sidebar') && selected.length === 0) {\n            this.addInput($dropdown.data('fieldName'), 0, {});\n          }\n          $el.find('.is-active').removeClass('is-active');\n\n          function highlightSelected(id) {\n            $el.find(`li[data-user-id=\"${id}\"] .dropdown-menu-user-link`).addClass('is-active');\n          }\n\n          if (selected.length > 0) {\n            getSelected().forEach(selectedId => highlightSelected(selectedId));\n          } else if ($dropdown.hasClass('js-issue-board-sidebar')) {\n            highlightSelected(0);\n          } else {\n            highlightSelected(selectedId);\n          }\n        },\n        updateLabel: $dropdown.data('dropdownTitle'),\n        renderRow: function(user) {\n          var avatar, img, listClosingTags, listWithName, listWithUserName, username;\n          username = user.username ? \"@\" + user.username : \"\";\n          avatar = user.avatar_url ? user.avatar_url : gon.default_avatar_url;\n\n          let selected = false;\n\n          if (this.multiSelect) {\n            selected = getSelected().find(u => user.id === u);\n\n            const { fieldName } = this;\n            const field = $dropdown.closest('.selectbox').find(\"input[name='\" + fieldName + \"'][value='\" + user.id + \"']\");\n\n            if (field.length) {\n              selected = true;\n            }\n          } else {\n            selected = user.id === selectedId;\n          }\n\n          img = \"\";\n          if (user.beforeDivider != null) {\n            `<li><a href='#' class='${selected === true ? 'is-active' : ''}'>${_.escape(user.name)}</a></li>`;\n          } else {\n            img = \"<img src='\" + avatar + \"' class='avatar avatar-inline' width='32' />\";\n          }\n\n          return `\n            <li data-user-id=${user.id}>\n              <a href='#' class='dropdown-menu-user-link ${selected === true ? 'is-active' : ''}'>\n                ${img}\n                <strong class='dropdown-menu-user-full-name'>\n                  ${_.escape(user.name)}\n                </strong>\n                ${username ? `<span class='dropdown-menu-user-username'>${username}</span>` : ''}\n              </a>\n            </li>\n          `;\n        }\n      });\n    };\n  })(this));\n  $('.ajax-users-select').each((function(_this) {\n    return function(i, select) {\n      var firstUser, showAnyUser, showEmailUser, showNullUser;\n      var options = {};\n      options.skipLdap = $(select).hasClass('skip_ldap');\n      options.projectId = $(select).data('projectId');\n      options.groupId = $(select).data('groupId');\n      options.showCurrentUser = $(select).data('currentUser');\n      options.authorId = $(select).data('authorId');\n      options.skipUsers = $(select).data('skipUsers');\n      showNullUser = $(select).data('nullUser');\n      showAnyUser = $(select).data('anyUser');\n      showEmailUser = $(select).data('emailUser');\n      firstUser = $(select).data('firstUser');\n      return $(select).select2({\n        placeholder: \"Search for a user\",\n        multiple: $(select).hasClass('multiselect'),\n        minimumInputLength: 0,\n        query: function(query) {\n          return _this.users(query.term, options, function(users) {\n            var anyUser, data, emailUser, index, len, name, nullUser, obj, ref;\n            data = {\n              results: users\n            };\n            if (query.term.length === 0) {\n              if (firstUser) {\n                // Move current user to the front of the list\n                ref = data.results;\n\n                for (index = 0, len = ref.length; index < len; index += 1) {\n                  obj = ref[index];\n                  if (obj.username === firstUser) {\n                    data.results.splice(index, 1);\n                    data.results.unshift(obj);\n                    break;\n                  }\n                }\n              }\n              if (showNullUser) {\n                nullUser = {\n                  name: 'Unassigned',\n                  id: 0\n                };\n                data.results.unshift(nullUser);\n              }\n              if (showAnyUser) {\n                name = showAnyUser;\n                if (name === true) {\n                  name = 'Any User';\n                }\n                anyUser = {\n                  name: name,\n                  id: null\n                };\n                data.results.unshift(anyUser);\n              }\n            }\n            if (showEmailUser && data.results.length === 0 && query.term.match(/^[^@]+@[^@]+$/)) {\n              var trimmed = query.term.trim();\n              emailUser = {\n                name: \"Invite \\\"\" + query.term + \"\\\" by email\",\n                username: trimmed,\n                id: trimmed,\n                invite: true\n              };\n              data.results.unshift(emailUser);\n            }\n            return query.callback(data);\n          });\n        },\n        initSelection: function() {\n          var args;\n          args = 1 <= arguments.length ? [].slice.call(arguments, 0) : [];\n          return _this.initSelection.apply(_this, args);\n        },\n        formatResult: function() {\n          var args;\n          args = 1 <= arguments.length ? [].slice.call(arguments, 0) : [];\n          return _this.formatResult.apply(_this, args);\n        },\n        formatSelection: function() {\n          var args;\n          args = 1 <= arguments.length ? [].slice.call(arguments, 0) : [];\n          return _this.formatSelection.apply(_this, args);\n        },\n        dropdownCssClass: \"ajax-users-dropdown\",\n        // we do not want to escape markup since we are displaying html in results\n        escapeMarkup: function(m) {\n          return m;\n        }\n      });\n    };\n  })(this));\n}\n\nUsersSelect.prototype.initSelection = function(element, callback) {\n  var id, nullUser;\n  id = $(element).val();\n  if (id === \"0\") {\n    nullUser = {\n      name: 'Unassigned'\n    };\n    return callback(nullUser);\n  } else if (id !== \"\") {\n    return this.user(id, callback);\n  }\n};\n\nUsersSelect.prototype.formatResult = function(user) {\n  var avatar;\n  if (user.avatar_url) {\n    avatar = user.avatar_url;\n  } else {\n    avatar = gon.default_avatar_url;\n  }\n  return \"<div class='user-result \" + (!user.username ? 'no-username' : void 0) + \"'> <div class='user-image'><img class='avatar avatar-inline s32' src='\" + avatar + \"'></div> <div class='user-name dropdown-menu-user-full-name'>\" + _.escape(user.name) + \"</div> <div class='user-username dropdown-menu-user-username'>\" + (!user.invite ? \"@\" + _.escape(user.username) : \"\") + \"</div> </div>\";\n};\n\nUsersSelect.prototype.formatSelection = function(user) {\n  return _.escape(user.name);\n};\n\nUsersSelect.prototype.user = function(user_id, callback) {\n  if (!/^\\d+$/.test(user_id)) {\n    return false;\n  }\n\n  var url;\n  url = this.buildUrl(this.userPath);\n  url = url.replace(':id', user_id);\n  return axios.get(url)\n    .then(({ data }) => {\n      callback(data);\n    });\n};\n\n// Return users list. Filtered by query\n// Only active users retrieved\nUsersSelect.prototype.users = function(query, options, callback) {\n  const url = this.buildUrl(this.usersPath);\n  const params = {\n    search: query,\n    active: true,\n    project_id: options.projectId || null,\n    group_id: options.groupId || null,\n    skip_ldap: options.skipLdap || null,\n    todo_filter: options.todoFilter || null,\n    todo_state_filter: options.todoStateFilter || null,\n    current_user: options.showCurrentUser || null,\n    author_id: options.authorId || null,\n    skip_users: options.skipUsers || null\n  };\n  return axios.get(url, { params })\n    .then(({ data }) => {\n      callback(data);\n    });\n};\n\nUsersSelect.prototype.buildUrl = function(url) {\n  if (gon.relative_url_root != null) {\n    url = gon.relative_url_root.replace(/\\/$/, '') + url;\n  }\n  return url;\n};\n\nexport default UsersSelect;\n"],"sourceRoot":""}