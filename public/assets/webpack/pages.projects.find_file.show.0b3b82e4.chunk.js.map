{"version":3,"sources":["webpack:///./project_find_file.js","webpack:///./shortcuts_find_file.js","webpack:///./pages/projects/find_file/show/index.js"],"names":["ProjectFindFile","element1","options","_classCallCheck","this","element","goToBlob","bind","goToTree","selectRowDown","selectRowUp","filePaths","inputElement","find","initEvent","focus","load","url","_this","off","on","event","ref","target","value","jquery_default","val","data","findFile","eq","addClass","result","searchText","length","fuzzaldrin_default","a","filter","renderList","_this2","axios_utils","get","then","_ref","hide","catch","Object","flash","locale","blobItemUrl","filePath","html","i","len","matches","results","empty","match","blobUrlTemplate","makeHtml","push","append","type","next","rows","selectedRow","prev","removeClass","selectRow","window","location","href","treeUrl","$link","click","$tr","replaceWith","text","j","lastIndex","matchIndex","matchedChars","unmatched","substring","join","bold","document","createTextNode","highlighter","attr","ShortcutsFindFile","projectFindFile","shortcuts_find_file_classCallCheck","_possibleConstructorReturn","__proto__","getPrototypeOf","call","oldStopCallback","mousetrap_default","stopCallback","e","combo","preventDefault","shortcuts_navigation","addEventListener","findElement","querySelector","project_find_file","dataset","fileFindUrl","findTreeUrl","shortcuts_find_file"],"mappings":"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","file":"pages.projects.find_file.show.0b3b82e4.chunk.js","sourcesContent":["/* eslint-disable func-names, no-var, wrap-iife, quotes, consistent-return, one-var, one-var-declaration-per-line, no-cond-assign, max-len, prefer-template, no-unused-vars, no-return-assign */\n\nimport $ from 'jquery';\nimport fuzzaldrinPlus from 'fuzzaldrin-plus';\nimport axios from '~/lib/utils/axios_utils';\nimport flash from '~/flash';\nimport { __ } from '~/locale';\n\n// highlight text(awefwbwgtc -> <b>a</b>wefw<b>b</b>wgt<b>c</b> )\nconst highlighter = function(element, text, matches) {\n  var highlightText, j, lastIndex, len, matchIndex, matchedChars, unmatched;\n  lastIndex = 0;\n  highlightText = \"\";\n  matchedChars = [];\n  for (j = 0, len = matches.length; j < len; j += 1) {\n    matchIndex = matches[j];\n    unmatched = text.substring(lastIndex, matchIndex);\n    if (unmatched) {\n      if (matchedChars.length) {\n        element.append(matchedChars.join(\"\").bold());\n      }\n      matchedChars = [];\n      element.append(document.createTextNode(unmatched));\n    }\n    matchedChars.push(text[matchIndex]);\n    lastIndex = matchIndex + 1;\n  }\n  if (matchedChars.length) {\n    element.append(matchedChars.join(\"\").bold());\n  }\n  return element.append(document.createTextNode(text.substring(lastIndex)));\n};\n\nexport default class ProjectFindFile {\n  constructor(element1, options) {\n    this.element = element1;\n    this.options = options;\n    this.goToBlob = this.goToBlob.bind(this);\n    this.goToTree = this.goToTree.bind(this);\n    this.selectRowDown = this.selectRowDown.bind(this);\n    this.selectRowUp = this.selectRowUp.bind(this);\n    this.filePaths = {};\n    this.inputElement = this.element.find(\".file-finder-input\");\n    // init event\n    this.initEvent();\n    // focus text input box\n    this.inputElement.focus();\n    // load file list\n    this.load(this.options.url);\n  }\n\n  initEvent() {\n    this.inputElement.off(\"keyup\");\n    this.inputElement.on(\"keyup\", (function(_this) {\n      return function(event) {\n        var oldValue, ref, target, value;\n        target = $(event.target);\n        value = target.val();\n        oldValue = (ref = target.data(\"oldValue\")) != null ? ref : \"\";\n        if (value !== oldValue) {\n          target.data(\"oldValue\", value);\n          _this.findFile();\n          return _this.element.find(\"tr.tree-item\").eq(0).addClass(\"selected\").focus();\n        }\n      };\n    })(this));\n  }\n\n  findFile() {\n    var result, searchText;\n    searchText = this.inputElement.val();\n    result = searchText.length > 0 ? fuzzaldrinPlus.filter(this.filePaths, searchText) : this.filePaths;\n    return this.renderList(result, searchText);\n  // find file\n  }\n\n  // files pathes load\n  load(url) {\n    axios.get(url)\n      .then(({ data }) => {\n        this.element.find('.loading').hide();\n        this.filePaths = data;\n        this.findFile();\n        this.element.find('.files-slider tr.tree-item').eq(0).addClass('selected').focus();\n      })\n      .catch(() => flash(__('An error occurred while loading filenames')));\n  }\n\n  // render result\n  renderList(filePaths, searchText) {\n    var blobItemUrl, filePath, html, i, len, matches, results;\n    this.element.find(\".tree-table > tbody\").empty();\n    results = [];\n\n    for (i = 0, len = filePaths.length; i < len; i += 1) {\n      filePath = filePaths[i];\n      if (i === 20) {\n        break;\n      }\n      if (searchText) {\n        matches = fuzzaldrinPlus.match(filePath, searchText);\n      }\n      blobItemUrl = this.options.blobUrlTemplate + \"/\" + filePath;\n      html = ProjectFindFile.makeHtml(filePath, matches, blobItemUrl);\n      results.push(this.element.find(\".tree-table > tbody\").append(html));\n    }\n    return results;\n  }\n\n  // make tbody row html\n  static makeHtml(filePath, matches, blobItemUrl) {\n    var $tr;\n    $tr = $(\"<tr class='tree-item'><td class='tree-item-file-name link-container'><a><i class='fa fa-file-text-o fa-fw'></i><span class='str-truncated'></span></a></td></tr>\");\n    if (matches) {\n      $tr.find(\"a\").replaceWith(highlighter($tr.find(\"a\"), filePath, matches).attr(\"href\", blobItemUrl));\n    } else {\n      $tr.find(\"a\").attr(\"href\", blobItemUrl);\n      $tr.find(\".str-truncated\").text(filePath);\n    }\n    return $tr;\n  }\n\n  selectRow(type) {\n    var next, rows, selectedRow;\n    rows = this.element.find(\".files-slider tr.tree-item\");\n    selectedRow = this.element.find(\".files-slider tr.tree-item.selected\");\n    if (rows && rows.length > 0) {\n      if (selectedRow && selectedRow.length > 0) {\n        if (type === \"UP\") {\n          next = selectedRow.prev();\n        } else if (type === \"DOWN\") {\n          next = selectedRow.next();\n        }\n        if (next.length > 0) {\n          selectedRow.removeClass(\"selected\");\n          selectedRow = next;\n        }\n      } else {\n        selectedRow = rows.eq(0);\n      }\n      return selectedRow.addClass(\"selected\").focus();\n    }\n  }\n\n  selectRowUp() {\n    return this.selectRow(\"UP\");\n  }\n\n  selectRowDown() {\n    return this.selectRow(\"DOWN\");\n  }\n\n  goToTree() {\n    return window.location.href = this.options.treeUrl;\n  }\n\n  goToBlob() {\n    var $link = this.element.find(\".tree-item.selected .tree-item-file-name a\");\n\n    if ($link.length) {\n      $link.get(0).click();\n    }\n  }\n}\n","import Mousetrap from 'mousetrap';\nimport ShortcutsNavigation from './shortcuts_navigation';\n\nexport default class ShortcutsFindFile extends ShortcutsNavigation {\n  constructor(projectFindFile) {\n    super();\n\n    const oldStopCallback = Mousetrap.stopCallback;\n    this.projectFindFile = projectFindFile;\n\n    Mousetrap.stopCallback = (e, element, combo) => {\n      if (\n        element === this.projectFindFile.inputElement[0] &&\n        (combo === 'up' || combo === 'down' || combo === 'esc' || combo === 'enter')\n      ) {\n        // when press up/down key in textbox, cursor prevent to move to home/end\n        e.preventDefault();\n        return false;\n      }\n\n      return oldStopCallback(e, element, combo);\n    };\n\n    Mousetrap.bind('up', this.projectFindFile.selectRowUp);\n    Mousetrap.bind('down', this.projectFindFile.selectRowDown);\n    Mousetrap.bind('esc', this.projectFindFile.goToTree);\n    Mousetrap.bind('enter', this.projectFindFile.goToBlob);\n  }\n}\n","import $ from 'jquery';\nimport ProjectFindFile from '~/project_find_file';\nimport ShortcutsFindFile from '~/shortcuts_find_file';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const findElement = document.querySelector('.js-file-finder');\n  const projectFindFile = new ProjectFindFile($('.file-finder-holder'), {\n    url: findElement.dataset.fileFindUrl,\n    treeUrl: findElement.dataset.findTreeUrl,\n    blobUrlTemplate: findElement.dataset.blobUrlTemplate,\n  });\n  new ShortcutsFindFile(projectFindFile); // eslint-disable-line no-new\n});\n"],"sourceRoot":""}