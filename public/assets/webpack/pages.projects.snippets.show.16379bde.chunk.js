(this.webpackJsonp=this.webpackJsonp||[]).push([[98,16],{118:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=(i(243),i(5)),a=i(7),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector,this.dataType=t.dataType,this.fieldName=t.fieldName,this.onSuccess=t.onSuccess||function(){},this.onError=function(e){var t="";return e.response.data&&"object"===r(e.response.data)&&(t=e.response.data.errors.join(" ")),new a.a(t||"Update failed","alert")},this.init()}return l(e,[{key:"init",value:function(){this.disable(),o()(this.selector+" .js-task-list-container").taskList("enable"),o()(document).on("tasklist:changed",this.selector+" .js-task-list-container",this.update.bind(this))}},{key:"disable",value:function(){o()(this.selector+" .js-task-list-container").taskList("disable"),o()(document).off("tasklist:changed",this.selector+" .js-task-list-container")}},{key:"update",value:function(e){var t,i,n,a=this,r=o()(e.target),l={};return l[this.dataType]=(t={},i=this.fieldName,n=r.val(),i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t),s.a.patch(r.data("updateUrl")||o()("form.js-issuable-update").attr("action"),l).then(function(e){var t=e.data;return a.onSuccess(t)}).catch(function(e){return a.onError(e)})}}]),e}();t.a=c},119:function(e,t,i){"use strict";var n={props:{small:{type:Boolean,required:!1,default:!1},lines:{type:Number,required:!1,default:3}},computed:{lineClasses:function(){return new Array(this.lines).fill().map(function(e,t){return"skeleton-line-"+(t+1)})}}},o=i(2),s=Object(o.a)(n,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"animation-container",class:{"animation-container-small":this.small}},this._l(this.lineClasses,function(e,i){return t("div",{key:i,class:e})}))},[],!1,null,null,null);t.a=s.exports},143:function(e,t,i){"use strict";var n={init:function(e){this.hook=e,this.destroyed=!1,this.config=e.config.InputSetter||(this.hook.config.InputSetter={}),this.eventWrapper={},this.addEvents()},addEvents:function(){this.eventWrapper.setInputs=this.setInputs.bind(this),this.hook.list.list.addEventListener("click.dl",this.eventWrapper.setInputs)},removeEvents:function(){this.hook.list.list.removeEventListener("click.dl",this.eventWrapper.setInputs)},setInputs:function(e){var t=this;if(!this.destroyed){var i=e.detail.selected;Array.isArray(this.config)||(this.config=[this.config]),this.config.forEach(function(e){return t.setInput(e,i)})}},setInput:function(e,t){var i=e.input||this.hook.trigger,n=t.getAttribute(e.valueAttribute),o=e.inputAttribute;return i.hasAttribute(o)?i.setAttribute(o,n):"INPUT"===i.tagName?i.value=n:i.textContent=n},destroy:function(){this.destroyed=!0,this.removeEvents()}};t.a=n},198:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=i(7),a=i(11),r=i(5),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.initAuxiliaryViewer(),e.initRichViewer(),this.initMainViewers()}return l(e,[{key:"initMainViewers",value:function(){this.$fileHolder=o()(".file-holder"),this.$fileHolder.length&&(this.switcher=document.querySelector(".js-blob-viewer-switcher"),this.switcherBtns=document.querySelectorAll(".js-blob-viewer-switch-btn"),this.copySourceBtn=document.querySelector(".js-copy-blob-source-btn"),this.simpleViewer=this.$fileHolder[0].querySelector('.blob-viewer[data-type="simple"]'),this.richViewer=this.$fileHolder[0].querySelector('.blob-viewer[data-type="rich"]'),this.initBindings(),this.switchToInitialViewer())}},{key:"switchToInitialViewer",value:function(){var e=this.$fileHolder[0].querySelector(".blob-viewer:not(.hidden)").getAttribute("data-type");this.switcher&&0===window.location.hash.indexOf("#L")&&(e="simple"),this.switchToViewer(e)}},{key:"initBindings",value:function(){var e=this;this.switcherBtns.length&&Array.from(this.switcherBtns).forEach(function(t){t.addEventListener("click",e.switchViewHandler.bind(e))}),this.copySourceBtn&&this.copySourceBtn.addEventListener("click",function(){return e.copySourceBtn.classList.contains("disabled")?e.copySourceBtn.blur():e.switchToViewer("simple")})}},{key:"switchViewHandler",value:function(e){var t=e.currentTarget;e.preventDefault(),this.switchToViewer(t.getAttribute("data-viewer"))}},{key:"toggleCopyButtonState",value:function(){this.copySourceBtn&&(this.simpleViewer.getAttribute("data-loaded")?(this.copySourceBtn.setAttribute("title","Copy source to clipboard"),this.copySourceBtn.classList.remove("disabled")):this.activeViewer===this.simpleViewer?(this.copySourceBtn.setAttribute("title","Wait for the source to load to copy it to the clipboard"),this.copySourceBtn.classList.add("disabled")):(this.copySourceBtn.setAttribute("title","Switch to the source to copy it to the clipboard"),this.copySourceBtn.classList.add("disabled")),o()(this.copySourceBtn).tooltip("_fixTitle"))}},{key:"switchToViewer",value:function(t){var i=this,n=this.$fileHolder[0].querySelector(".blob-viewer[data-type='"+t+"']");if(this.activeViewer!==n){var r=document.querySelector(".js-blob-viewer-switch-btn.active"),l=document.querySelector(".js-blob-viewer-switch-btn[data-viewer='"+t+"']"),c=this.$fileHolder[0].querySelector(".blob-viewer:not([data-type='"+t+"'])");r&&r.classList.remove("active"),l&&(l.classList.add("active"),l.blur()),c&&c.classList.add("hidden"),n.classList.remove("hidden"),this.activeViewer=n,this.toggleCopyButtonState(),e.loadViewer(n).then(function(e){o()(e).renderGFM(),i.$fileHolder.trigger("highlight:line"),Object(a.n)(),i.toggleCopyButtonState()}).catch(function(){return new s.a("Error loading viewer")})}}}],[{key:"initAuxiliaryViewer",value:function(){var t=document.querySelector('.blob-viewer[data-type="auxiliary"]');t&&e.loadViewer(t)}},{key:"initRichViewer",value:function(){var e=document.querySelector('.blob-viewer[data-type="rich"]');if(e&&e.dataset.richType){var t=function(t){return t.then(function(t){return t.default(e)}).catch(function(e){throw Object(s.a)("Error loading file viewer."),e})};switch(e.dataset.richType){case"balsamiq":t(Promise.all([i.e(14),i.e(36),i.e(43)]).then(i.bind(null,418)));break;case"notebook":t(Promise.all([i.e(14),i.e(35),i.e(42)]).then(i.bind(null,422)));break;case"pdf":t(Promise.all([i.e(32),i.e(41)]).then(i.bind(null,421)));break;case"sketch":t(Promise.all([i.e(14),i.e(34),i.e(40)]).then(i.bind(null,419)));break;case"stl":t(Promise.all([i.e(29),i.e(39)]).then(i.bind(null,420)))}}}},{key:"loadViewer",value:function(e){var t=e,i=t.getAttribute("data-url");return!i||t.getAttribute("data-loaded")||t.getAttribute("data-loading")?Promise.resolve(t):(t.setAttribute("data-loading","true"),r.a.get(i).then(function(e){var i=e.data;return t.innerHTML=i.html,t.setAttribute("data-loaded","true"),t}))}}]),e}();t.a=c},205:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=i(3),a=i.n(s),r=i(39),l=i.n(r),c=i(50),d=i.n(c),u=(i(391),i(390),i(149)),h=i(8),f=i(129),m=i(119),p=i(5),v=i(21),g=i(7),y=i(53),b=i(159),w=i(143),k=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var C=Object.assign({},w.a),j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dropdownTrigger=t.dropdownTrigger,this.dropdownList=t.dropdownList,this.noteTypeInput=t.noteTypeInput,this.submitButton=t.submitButton,this.closeButton=t.closeButton,this.reopenButton=t.reopenButton}return k(e,[{key:"initDroplab",value:function(){this.droplab=new b.a;var e=this.setConfig();this.droplab.init(this.dropdownTrigger,this.dropdownList,[C],e)}},{key:"setConfig",value:function(){var e={InputSetter:[{input:this.noteTypeInput,valueAttribute:"data-value"},{input:this.submitButton,valueAttribute:"data-submit-text"}]};return this.closeButton&&e.InputSetter.push({input:this.closeButton,valueAttribute:"data-close-text"},{input:this.closeButton,valueAttribute:"data-close-text",inputAttribute:"data-alternative-text"}),this.reopenButton&&e.InputSetter.push({input:this.reopenButton,valueAttribute:"data-reopen-text"},{input:this.reopenButton,valueAttribute:"data-reopen-text",inputAttribute:"data-alternative-text"}),e}}]),e}(),E=i(65),x=i(190),_=i(98),N=i(118),S=i(11),T=(i(93),i(38)),I=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function A(e){return e.replace(/\r\n/g,"\n")}window.autosize=d.a;var F=/^\/\w+.*$/gm,D=function(){function e(t,i,n,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateTargetButtons=this.updateTargetButtons.bind(this),this.updateComment=this.updateComment.bind(this),this.visibilityChange=this.visibilityChange.bind(this),this.cancelDiscussionForm=this.cancelDiscussionForm.bind(this),this.onAddDiffNote=this.onAddDiffNote.bind(this),this.onAddImageDiffNote=this.onAddImageDiffNote.bind(this),this.setupDiscussionNoteForm=this.setupDiscussionNoteForm.bind(this),this.onReplyToDiscussionNote=this.onReplyToDiscussionNote.bind(this),this.removeNote=this.removeNote.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.updateNote=this.updateNote.bind(this),this.addDiscussionNote=this.addDiscussionNote.bind(this),this.addNoteError=this.addNoteError.bind(this),this.addNote=this.addNote.bind(this),this.resetMainTargetForm=this.resetMainTargetForm.bind(this),this.refresh=this.refresh.bind(this),this.keydownNoteText=this.keydownNoteText.bind(this),this.toggleCommitList=this.toggleCommitList.bind(this),this.postComment=this.postComment.bind(this),this.clearFlashWrapper=this.clearFlash.bind(this),this.onHashChange=this.onHashChange.bind(this),this.notes_url=t,this.note_ids=i,this.enableGFM=a,this.updatedNotesTrackingMap={},this.last_fetched_at=n,this.noteable_url=document.URL,this.notesCountBadge||(this.notesCountBadge=o()(".issuable-details").find(".notes-tab .badge")),this.basePollingInterval=15e3,this.maxPollingSteps=4,this.$wrapperEl=Object(S.t)()?o()(document).find(".diffs"):o()(document),this.cleanBinding(),this.addBinding(),this.setPollingInterval(),this.setupMainTargetNoteForm(a),this.taskList=new N.a({dataType:"note",fieldName:"note",selector:".notes"}),this.collapseLongCommitList(),this.setViewType(s),"merge_requests"===Object(S.i)(1)&&o()(".note-edit-form").clone().addClass("mr-note-edit-form").insertAfter(".note-edit-form");var r=Object(v.a)(),l=r&&document.getElementById(r);l&&this.loadLazyDiff({currentTarget:l})}return I(e,null,[{key:"initialize",value:function(t,i,n,o,s){this.instance||(this.instance=new e(t,i,n,o,s))}},{key:"getInstance",value:function(){return this.instance}}]),I(e,[{key:"setViewType",value:function(e){this.view=l.a.get("diff_view")||e}},{key:"addBinding",value:function(){this.$wrapperEl.on("click",".js-note-edit",this.showEditForm.bind(this)),this.$wrapperEl.on("click",".note-edit-cancel",this.cancelEdit),this.$wrapperEl.on("click",".js-comment-submit-button",this.postComment),this.$wrapperEl.on("click",".js-comment-save-button",this.updateComment),this.$wrapperEl.on("keyup input",".js-note-text",this.updateTargetButtons),this.$wrapperEl.on("click",".js-comment-resolve-button",this.postComment),this.$wrapperEl.on("click",".js-note-delete",this.removeNote),this.$wrapperEl.on("click",".js-note-attachment-delete",this.removeAttachment),this.$wrapperEl.on("click",".js-note-discard",this.resetMainTargetForm),this.$wrapperEl.on("change",".js-note-attachment-input",this.updateFormAttachment),this.$wrapperEl.on("click",".js-discussion-reply-button",this.onReplyToDiscussionNote),this.$wrapperEl.on("click",".js-add-diff-note-button",this.onAddDiffNote),this.$wrapperEl.on("click",".js-add-image-diff-note-button",this.onAddImageDiffNote),this.$wrapperEl.on("click",".js-close-discussion-note-form",this.cancelDiscussionForm),this.$wrapperEl.on("click",".system-note-commit-list-toggler",this.toggleCommitList),this.$wrapperEl.on("click",".js-toggle-lazy-diff",this.loadLazyDiff),this.$wrapperEl.on("click",".js-toggle-lazy-diff-retry-button",this.onClickRetryLazyLoad.bind(this)),this.$wrapperEl.on("visibilitychange",this.visibilityChange),this.$wrapperEl.on("issuable:change",this.refresh),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.addNote),this.$wrapperEl.on("ajax:success",".js-discussion-note-form",this.addDiscussionNote),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.resetMainTargetForm),this.$wrapperEl.on("ajax:complete",".js-main-target-form",this.reenableTargetFormSubmitButton),this.$wrapperEl.on("keydown",".js-note-text",this.keydownNoteText),o()(window).on("hashchange",this.onHashChange)}},{key:"cleanBinding",value:function(){this.$wrapperEl.off("click",".js-note-edit"),this.$wrapperEl.off("click",".note-edit-cancel"),this.$wrapperEl.off("click",".js-note-delete"),this.$wrapperEl.off("click",".js-note-attachment-delete"),this.$wrapperEl.off("click",".js-discussion-reply-button"),this.$wrapperEl.off("click",".js-add-diff-note-button"),this.$wrapperEl.off("click",".js-add-image-diff-note-button"),this.$wrapperEl.off("visibilitychange"),this.$wrapperEl.off("keyup input",".js-note-text"),this.$wrapperEl.off("click",".js-note-target-reopen"),this.$wrapperEl.off("click",".js-note-target-close"),this.$wrapperEl.off("click",".js-note-discard"),this.$wrapperEl.off("keydown",".js-note-text"),this.$wrapperEl.off("click",".js-comment-resolve-button"),this.$wrapperEl.off("click",".system-note-commit-list-toggler"),this.$wrapperEl.off("click",".js-toggle-lazy-diff"),this.$wrapperEl.off("click",".js-toggle-lazy-diff-retry-button"),this.$wrapperEl.off("ajax:success",".js-main-target-form"),this.$wrapperEl.off("ajax:success",".js-discussion-note-form"),this.$wrapperEl.off("ajax:complete",".js-main-target-form"),o()(window).off("hashchange",this.onHashChange)}},{key:"keydownNoteText",value:function(e){var t,i,n,s;if(!Object(S.x)(e))switch(t=o()(e.target),e.which){case 38:if(""!==t.val())return;if((s=o()("li.note[data-author-id='"+gon.current_user_id+"'][data-editable]:last",t.closest(".note, .notes_holder, #notes"))).length)return s.find(".js-note-edit").trigger("click",[!0,s]);break;case 27:if((i=t.closest(".js-discussion-note-form")).length){if(""!==t.val()&&!window.confirm("Are you sure you want to cancel creating this comment?"))return;return void this.removeDiscussionNoteForm(i)}if((n=t.closest(".note")).length){if(t.closest("form").data("originalNote")!==t.val()&&!window.confirm("Are you sure you want to cancel editing this comment?"))return;return this.removeNoteEditForm(n)}}}},{key:"initRefresh",value:function(){return e.interval&&clearInterval(e.interval),e.interval=setInterval((t=this,function(){return t.refresh()}),this.pollingInterval);var t}},{key:"refresh",value:function(){if(!document.hidden)return this.getContent()}},{key:"getContent",value:function(){var e=this;this.refreshing||(this.refreshing=!0,p.a.get(this.notes_url+"?html=true",{headers:{"X-Last-Fetched-At":this.last_fetched_at}}).then(function(t){var i=t.data,n=i.notes;e.last_fetched_at=i.last_fetched_at,e.setPollingInterval(i.notes.length),o.a.each(n,function(t,i){return e.renderNote(i)}),e.refreshing=!1}).catch(function(){e.refreshing=!1}))}},{key:"setPollingInterval",value:function(e){var t;return null==e&&(e=!0),t=this.basePollingInterval*Math.pow(2,this.maxPollingSteps-1),e?this.pollingInterval=this.basePollingInterval:this.pollingInterval<t&&(this.pollingInterval*=2),this.initRefresh()}},{key:"handleQuickActions",value:function(t){var i;t.commands_changes&&("merge"in t.commands_changes&&e.checkMergeRequestStatus(),"emoji_award"in t.commands_changes&&(i=o()(".js-awards-block").eq(0),Object(x.b)().then(function(e){e.addAwardToEmojiBar(i,t.commands_changes.emoji_award),e.scrollToAwards()}).catch(function(){})))}},{key:"setupNewNote",value:function(t){Object(T.e)(t.find(".js-timeago"),!1),this.collapseLongCommitList(),this.taskList.init(),e.updateNoteTargetSelector(t),this.$noteToCleanHighlight=t}},{key:"onHashChange",value:function(){this.$noteToCleanHighlight&&e.updateNoteTargetSelector(this.$noteToCleanHighlight),this.$noteToCleanHighlight=null}},{key:"renderNote",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o()(".main-notes-list");if(t.discussion_html)return this.renderDiscussionNote(t,i);if(t.valid){var s=n.find("#note_"+t.id);if(e.isNewNote(t,this.note_ids)){if(Object(S.t)())return;this.note_ids.push(t.id),n.length&&n.find(".system-note.being-posted").remove();var a=e.animateAppendNote(t.html,n);return this.setupNewNote(a),this.refresh(),this.updateNotesCount(1)}if(e.isUpdatedNote(t,s)){var r=s.hasClass("is-editing"),l=A(s.find(".original-note-content").text().trim()),c=s.find(".js-note-text"),d=c.val(),u=A(t.note),h=d===l||d===u;if(r&&h)c.val(t.note),this.updatedNotesTrackingMap[t.id]=t;else if(r&&!h)this.putConflictEditWarningInPlace(t,s),this.updatedNotesTrackingMap[t.id]=t;else{var f=e.animateUpdateNote(t.html,s);this.setupNewNote(f)}}}else t.errors&&t.errors.commands_only&&(t.commands_changes&&Object.keys(t.commands_changes).length>0&&n.find(".system-note.being-posted").remove(),this.addFlash(t.errors.commands_only,"notice",this.parentTimeline.get(0)),this.refresh())}},{key:"isParallelView",value:function(){return"parallel"===l.a.get("diff_view")}},{key:"renderDiscussionNote",value:function(t,i){var n,s,a,r,l;if(e.isNewNote(t,this.note_ids)){if(this.note_ids.push(t.id),a=(s=i||o()('.js-discussion-note-form[data-discussion-id="'+t.discussion_id+'"]')).length||!t.discussion_line_code?s.closest("tr"):o()("#"+t.discussion_line_code),t.on_image&&(a=s),r=this.isParallelView()?s.find("#line_type").val():"old",l=a.prevAll(".line_holder").first().find(".js-avatar-container."+r+"_line"),(n=o()('.notes[data-discussion-id="'+t.discussion_id+'"]')).length||(n=s.closest(".discussion").find(".notes")),0===n.length)if(t.diff_discussion_html){var c=o()(t.diff_discussion_html).renderGFM();if(!this.isParallelView()||a.hasClass("js-temp-notes-holder")||t.on_image)a.after(c);else{var d=c.find('.notes[data-discussion-id="'+t.discussion_id+'"]'),u="."+d.closest(".notes_content").attr("class").split(" ").join(".");a.find(u+" .content").append(d.closest(".content").children())}}else e.animateAppendNote(t.discussion_html,o()(".main-notes-list"));else e.animateAppendNote(t.html,n);return void 0!==gl.diffNotesCompileComponents&&t.discussion_resolvable&&(gl.diffNotesCompileComponents(),this.renderDiscussionAvatar(l,t)),Object(T.e)(o()(".js-timeago"),!1),e.checkMergeRequestStatus(),this.updateNotesCount(1)}}},{key:"getLineHolder",value:function(e){return o()(e).closest(".notes_holder").prevAll(".line_holder").first().get(0)}},{key:"renderDiscussionAvatar",value:function(e,t){var i=e.find(".diff-comment-avatar-holders");i.length||((i=document.createElement("diff-note-avatars")).setAttribute("discussion-id",t.discussion_id),e.append(i),gl.diffNotesCompileComponents())}},{key:"resetMainTargetForm",value:function(e){var t;(t=o()(".js-main-target-form")).find(".js-errors").remove(),t.find(".js-md-write-button").click(),t.find(".js-note-text").val("").trigger("input"),t.find(".js-note-text").data("autosave").reset();var i=document.createEvent("Event");i.initEvent("autosize:update",!0,!1),t.find(".js-autosize")[0].dispatchEvent(i),this.updateTargetButtons(e)}},{key:"reenableTargetFormSubmitButton",value:function(){return o()(".js-main-target-form").find(".js-note-text").trigger("input")}},{key:"setupMainTargetNoteForm",value:function(t){var i;i=o()(".js-new-note-form"),this.formClone=i.clone(),this.setupNoteForm(i,t),i.removeClass("js-new-note-form"),i.addClass("js-main-target-form"),i.find("#note_line_code").remove(),i.find("#note_position").remove(),i.find("#note_type").val(""),i.find("#note_project_id").remove(),i.find("#in_reply_to_discussion_id").remove(),i.find(".js-comment-resolve-button").closest("comment-and-resolve-btn").remove(),this.parentTimeline=i.parents(".timeline"),i.length&&e.initCommentTypeToggle(i.get(0))}},{key:"setupNoteForm",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.b;return this.glForm=new E.a(e,n),t=e.find(".js-note-text"),i=["Note",e.find("#note_noteable_type").val(),e.find("#note_noteable_id").val(),e.find("#note_commit_id").val(),e.find("#note_type").val(),e.find("#note_project_id").val(),e.find("#in_reply_to_discussion_id").val(),e.find("#note_line_code").val(),e.find("#note_position").val()],new _.a(t,i)}},{key:"addNote",value:function(e,t){return this.renderNote(t)}},{key:"addNoteError",value:function(e){var t=void 0;return e.hasClass("js-main-target-form")?t=e.parents(".timeline"):e.hasClass("js-discussion-note-form")&&(t=e.closest(".discussion-notes").find(".notes")),this.addFlash("Your comment could not be submitted! Please check your network connection and try again.","alert",t.get(0))}},{key:"updateNoteError",value:function(e){new g.a("Your comment could not be updated! Please check your network connection and try again.")}},{key:"addDiscussionNote",value:function(e,t,i){if(null!=e.attr("data-resolve-all")){e.data("projectPath");var n=e.data("discussionId"),o=e.data("noteableIid");null!=ResolveService&&ResolveService.toggleResolveForDiscussion(o,n)}this.renderNote(t,e),i&&this.removeDiscussionNoteForm(e)}},{key:"updateNote",value:function(e,t){var i;i=o()(e.html),this.revertNoteEditForm(t),i.renderGFM(),o()(".note-row-"+e.id).replaceWith(i),this.setupNewNote(i),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"checkContentToAllowEditing",value:function(e){var t=e.find(".original-note-content").text().trim(),i=!0;if(e.find(".js-note-text").val()===t)this.removeNoteEditForm(e);else{e.find(".note-form-actions");Object(S.v)(e.get(0))||Object(S.F)(e),e.find(".js-finish-edit-warning").show(),i=!1}return i}},{key:"showEditForm",value:function(e,t,i){e.preventDefault();var n=o()(e.target),s=o()(this.getEditFormSelector(n)),a=n.closest(".note"),r=o()(".note.is-editing:visible");if(r.length&&!this.checkContentToAllowEditing(r))return;a.find(".js-note-attachment-delete").show(),s.addClass("current-note-edit-form"),a.addClass("is-editing"),this.putEditFormInPlace(n)}},{key:"cancelEdit",value:function(e){e.preventDefault();var t=o()(e.target),i=t.closest(".note"),n=i.attr("data-note-id");if(this.revertNoteEditForm(t),this.updatedNotesTrackingMap[n]){var s=o()(this.updatedNotesTrackingMap[n].html);i.replaceWith(s),this.setupNewNote(s),delete this.updatedNotesTrackingMap[n]}else i.find(".js-finish-edit-warning").hide(),this.removeNoteEditForm(i)}},{key:"revertNoteEditForm",value:function(e){e=e||o()(".note.is-editing:visible");var t=this.getEditFormSelector(e),i=o()(t);i.insertBefore(".diffs"),i.find(".js-comment-save-button").enable(),i.find(".js-finish-edit-warning").hide()}},{key:"getEditFormSelector",value:function(e){var t=".note-edit-form:not(.mr-note-edit-form)";return e.parents("#diffs").length&&(t=".note-edit-form.mr-note-edit-form"),t}},{key:"removeNoteEditForm",value:function(e){var t=e.find(".diffs .current-note-edit-form");return e.removeClass("is-editing"),t.removeClass("current-note-edit-form"),t.find(".js-finish-edit-warning").hide(),t.find(".js-note-text").val(t.find("form.edit-note").data("originalNote"))}},{key:"removeNote",value:function(t){var i,n;return n=o()(t.currentTarget).closest(".note"),i=n.attr("id"),n.attr("data-note-id"),o()(t.currentTarget).closest(".notes[data-discussion-id]").closest(".notes_holder").prev(".line_holder"),o()('.note[id="'+i+'"]').each(function(e,t){var n,s;s=(n=o()(t)).closest(".discussion-notes");var a=o()(".notes",s).data("discussionId");if(void 0!==gl.diffNotesCompileComponents&&gl.diffNoteApps[i]&&gl.diffNoteApps[i].$destroy(),n.remove(),0===s.find(".note").length){var r=s.closest("tr");if(s.closest(".timeline-entry").remove(),o()(".js-diff-avatars-"+a).trigger("remove.vue"),r.find(".discussion-notes").length>1||0===r.length){var l=s.closest(".diff-file");if(l.length>0){var c=new CustomEvent("removeBadge.imageDiff",{detail:{badgeNumber:s.index()+1}});l[0].dispatchEvent(c)}s.remove()}else r.length>0&&r.remove()}}),e.checkMergeRequestStatus(),this.updateNotesCount(-1)}},{key:"removeAttachment",value:function(){var e=o()(this).closest(".note");return e.find(".note-attachment").remove(),e.find(".note-body > .note-text").show(),e.find(".note-header").show(),e.find(".diffs .current-note-edit-form").remove()}},{key:"onReplyToDiscussionNote",value:function(e){this.replyToDiscussionNote(e.target)}},{key:"replyToDiscussionNote",value:function(e){var t,i;return t=this.cleanForm(this.formClone.clone()),(i=o()(e).closest(".js-discussion-reply-button")).closest(".discussion-reply-holder").hide().after(t),this.setupDiscussionNoteForm(i,t)}},{key:"setupDiscussionNoteForm",value:function(e,t){var i=e.closest(".text-file");0===i.length&&(i=e.closest(".image"));var n=e.data("discussionId");(n&&(t.attr("data-discussion-id",n),t.find("#in_reply_to_discussion_id").val(n)),t.find("#note_project_id").val(e.data("discussionProjectId")),t.attr("data-line-code",e.data("lineCode")),t.find("#line_type").val(e.data("lineType")),t.find("#note_noteable_type").val(i.data("noteableType")),t.find("#note_noteable_id").val(i.data("noteableId")),t.find("#note_commit_id").val(i.data("commitId")),t.find("#note_type").val(e.data("noteType")),t.find("#note_line_code").val(e.data("lineCode")),t.find("#note_position").val(e.attr("data-position")),t.find(".js-note-discard").show().removeClass("js-note-discard").addClass("js-close-discussion-note-form").text(t.find(".js-close-discussion-note-form").data("cancelText")),t.find(".js-note-target-close").remove(),t.find(".js-note-new-discussion").remove(),this.setupNoteForm(t),t.removeClass("js-main-target-form").addClass("discussion-form js-discussion-note-form"),void 0!==gl.diffNotesCompileComponents)&&(t.find("comment-and-resolve-btn").attr(":discussion-id","'"+n+"'"),gl.diffNotesCompileComponents());t.find(".js-note-text").focus(),t.find(".js-comment-resolve-button").attr("data-discussion-id",n)}},{key:"onAddDiffNote",value:function(e){e.preventDefault();var t=e.currentTarget||e.target,i=o()(t),n=!i.hasClass("js-diff-comment-avatar");this.toggleDiffNote({target:i,lineType:t.dataset.lineType,showReplyInput:n})}},{key:"onAddImageDiffNote",value:function(e){var t=o()(e.currentTarget||e.target),i=t.closest(".diff-file"),n=new CustomEvent("click.imageDiff",{detail:e});i[0].dispatchEvent(n);var s=void 0,a=t.closest(".diff-viewer").find(".note-container"),r=a.find("> .discussion-form");0===r.length?(s=this.cleanForm(this.formClone.clone())).appendTo(a):s=r,this.setupDiscussionNoteForm(t,s)}},{key:"toggleDiffNote",value:function(e){var t,i,n,s,a,r,l,c=e.target,d=e.lineType,u=e.forceShow,h=e.showReplyInput,f=void 0!==h&&h,m=(r=(t=o()(c)).closest("tr")).next(),p=r;m.is(".notes_holder")&&(p=m),n=m.is(".notes_holder"),i=!1;var v="";l='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line" colspan="2"></td><td class="notes_content"><div class="content"></div></td></tr>',this.isParallelView()&&(v="."+d,l='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line old"></td><td class="notes_content parallel old"><div class="content"></div></td><td class="notes_line new"></td><td class="notes_content parallel new"><div class="content"></div></td></tr>');var g=".notes_content"+v+" .content",y=p.find(g);if(n&&f)p.show(),(y=p.find(g)).length&&(y.show(),(a=y.find(".js-discussion-reply-button:visible")).length?this.replyToDiscussionNote(a[0]):0===y.find(".js-discussion-note-form").length&&(i=!0));else if(f)r.after(l),y=(p=r.next()).find(g),i=!0;else{var b=p.find(".content:not(:empty)").is(":visible"),w=!0===u||!b&&!(!0===u||!1===u);p.toggleClass("hide",!w),y.toggleClass("hide",!w)}if(i)return(s=this.cleanForm(this.formClone.clone())).appendTo(y),this.setupDiscussionNoteForm(t,s)}},{key:"removeDiscussionNoteForm",value:function(e){var t;return t=e.closest("tr"),e.data("glForm").destroy(),e.find(".js-note-text").data("autosave").reset(),e.prev(".discussion-reply-holder").show(),t.is(".js-temp-notes-holder")?t.remove():e.remove()}},{key:"cancelDiscussionForm",value:function(e){e.preventDefault();var t=o()(e.target).closest(".js-discussion-note-form");if(0===o()(e.target).closest(".discussion-notes").length){var i=t.closest(".diff-file");if(i.length>0){var n=new CustomEvent("blur.imageDiff",{detail:e});i[0].dispatchEvent(n)}}return this.removeDiscussionNoteForm(t)}},{key:"updateFormAttachment",value:function(){var e,t;return t=o()(this).closest("form"),e=o()(this).val().replace(/^.*[\\\/]/,""),t.find(".js-attachment-filename").text(e)}},{key:"visibilityChange",value:function(){return this.refresh()}},{key:"updateTargetButtons",value:function(e){var t,i,n,s,a,r,l;if(a=(s=(l=o()(e.target)).parents("form")).find(".js-note-target-reopen"),t=s.find(".js-note-target-close"),n=s.find(".js-note-discard"),l.val().trim().length>0){if(r=a.attr("data-alternative-text"),i=t.attr("data-alternative-text"),a.text()!==r&&a.text(r),t.text()!==i&&t.text(i),a.is(":not(.btn-comment-and-reopen)")&&a.addClass("btn-comment-and-reopen"),t.is(":not(.btn-comment-and-close)")&&t.addClass("btn-comment-and-close"),n.is(":hidden"))return n.show()}else if(r=a.data("originalText"),i=t.data("originalText"),a.text()!==r&&a.text(r),t.text()!==i&&t.text(i),a.is(".btn-comment-and-reopen")&&a.removeClass("btn-comment-and-reopen"),t.is(".btn-comment-and-close")&&t.removeClass("btn-comment-and-close"),n.is(":visible"))return n.hide()}},{key:"putEditFormInPlace",value:function(e){var t=o()(this.getEditFormSelector(e)),i=e.closest(".note");t.insertAfter(i.find(".note-text"));var n=i.find(".original-note-content"),s=n.text().trim(),a=n.data("postUrl"),r=n.data("targetId"),l=n.data("targetType"),c=n.data("markdownVersion");this.glForm=new E.a(t.find("form"),this.enableGFM),t.find("form").attr("action",a+"?html=true").attr("data-remote","true").attr("data-markdown-version",c),t.find(".js-form-target-id").val(r),t.find(".js-form-target-type").val(l),t.find(".js-note-text").focus().val(s),t.find(".js-md-write-button").trigger("click"),t.find(".referenced-users").hide()}},{key:"putConflictEditWarningInPlace",value:function(e,t){0===t.find(".js-conflict-edit-warning").length&&o()('<div class="js-conflict-edit-warning alert alert-danger">\n        This comment has changed since you started editing, please review the\n        <a href="#note_'+e.id+'" target="_blank" rel="noopener noreferrer">\n          updated comment\n        </a>\n        to ensure information is not lost\n      </div>').insertAfter(t.find(".note-text"))}},{key:"updateNotesCount",value:function(e){return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(),10)+e)}},{key:"onClickRetryLazyLoad",value:function(e){var t=o()(e.currentTarget);return t.prop("disabled",!0),this.loadLazyDiff(e).then(function(){t.prop("disabled",!1)})}},{key:"loadLazyDiff",value:function(t){var i=o()(t.currentTarget).closest(".js-toggle-container");if(e.renderPlaceholderComponent(i),i.find(".js-toggle-lazy-diff").removeClass("js-toggle-lazy-diff"),0!==i.find("tbody").length){var n=i.find(".file-holder").data("linesPath"),s=i.find(".js-error-lazy-load-diff"),a=i.find(".js-success-lazy-load");return n?p.a.get(n).then(function(t){var n=t.data;a.removeClass("hidden"),s.addClass("hidden"),e.renderDiffContent(i,n)}).catch(function(){a.addClass("hidden"),s.removeClass("hidden")}):Promise.resolve()}}},{key:"toggleCommitList",value:function(e){var t=o()(e.currentTarget),i=t.siblings(".system-note-commit-list");t.find(".fa").toggleClass("fa-angle-down").toggleClass("fa-angle-up"),i.toggleClass("hide-shade")}},{key:"collapseLongCommitList",value:function(){var e=o()("#notes-list").find("li.system-note").has("ul");o.a.each(e,function(e,t){var i=o()(t),n=i.find(".note-text").find("p:first").text().replace(":","");i.find(".note-header .system-note-message").html(n),i.find("li").length>3?(i.find(".note-text").addClass("system-note-commit-list"),i.find(".system-note-commit-list-toggler").show()):i.find(".note-text").addClass("system-note-commit-list hide-shade")})}},{key:"addFlash",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.flashContainer=new(Function.prototype.bind.apply(g.a,[null].concat(t)))}},{key:"clearFlash",value:function(){this.flashContainer&&(this.flashContainer.style.display="none",this.flashContainer=null)}},{key:"cleanForm",value:function(e){return e.find(".js-comment-type-dropdown").removeClass("btn-group"),e.find(".dropdown-menu").remove(),e}},{key:"getFormData",value:function(e){var t=e.find(".js-note-text").val();return{formData:e.serialize(),formContent:a.a.escape(t),formAction:e.attr("action"),formContentOriginal:t}}},{key:"hasQuickActions",value:function(e){return F.test(e)}},{key:"stripQuickActions",value:function(e){return e.replace(F,"").trim()}},{key:"getQuickActionDescription",value:function(e){var t=void 0,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).filter(function(t,i){return new RegExp("/"+t.name).test(e)});i&&i.length?t=i.length>1?"Applying multiple commands":"Applying command to "+i[0].description.toLowerCase():t="Applying command";return t}},{key:"createPlaceholderNote",value:function(e){var t=e.formContent,i=e.uniqueId,n=e.isDiscussionNote,s=e.currentUsername,r=e.currentUserFullname,l=e.currentUserAvatar,c=n?"discussion":"",d=o()('<li id="'+i+'" class="note being-posted fade-in-half timeline-entry">\n         <div class="timeline-entry-inner">\n            <div class="timeline-icon">\n               <a href="/'+a.a.escape(s)+'">\n                 <img class="avatar s40" src="'+l+'" />\n               </a>\n            </div>\n            <div class="timeline-content '+c+'">\n               <div class="note-header">\n                  <div class="note-header-info">\n                     <a href="/'+a.a.escape(s)+'">\n                       <span class="d-none d-sm-inline-block">'+a.a.escape(s)+'</span>\n                       <span class="note-headline-light">'+a.a.escape(s)+'</span>\n                     </a>\n                  </div>\n               </div>\n               <div class="note-body">\n                 <div class="note-text">\n                   <p>'+t+"</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>");return d.find(".d-none.d-sm-inline-block").text(a.a.escape(r)),d.find(".note-headline-light").text("@"+a.a.escape(s)),d}},{key:"createPlaceholderSystemNote",value:function(e){var t=e.formContent,i=e.uniqueId;return o()('<li id="'+i+'" class="note system-note timeline-entry being-posted fade-in-half">\n         <div class="timeline-entry-inner">\n           <div class="timeline-content">\n             <i>'+t+"</i>\n           </div>\n         </div>\n       </li>")}},{key:"postComment",value:function(e){var t=this;e.preventDefault();var i=o()(e.target);i.prop("disabled",!0);var n=i.parents("form"),s=n.find(".js-note-target-close"),r="discussion"===i.parent().find("li.droplab-item-selected").attr("id"),l=n.hasClass("js-main-target-form"),c=n.hasClass("js-discussion-note-form"),d=i.hasClass("js-comment-resolve-button"),h=this.getFormData(n),f=h.formData,m=h.formContent,v=h.formAction,g=h.formContentOriginal,y=void 0,b=void 0,w=!1,k=void 0,C=void 0;return c?k=n.parent(".discussion-notes").find(".notes"):l&&(k=o()("ul.main-notes-list")),d&&n.find(".js-comment-submit-button").disable(),C=m,this.hasQuickActions(m)&&(C=this.stripQuickActions(m),w=!0),C&&(y=a.a.uniqueId("tempNote_"),k.append(this.createPlaceholderNote({formContent:C,uniqueId:y,isDiscussionNote:r,currentUsername:gon.current_username,currentUserFullname:gon.current_user_fullname,currentUserAvatar:gon.current_user_avatar_url}))),w&&(b=a.a.uniqueId("tempSystemNote_"),k.append(this.createPlaceholderSystemNote({formContent:this.getQuickActionDescription(m,u.a.get(gl.GfmAutoComplete.dataSources.commands)),uniqueId:b}))),k.length&&(l?this.resetMainTargetForm(e):c&&this.removeDiscussionNoteForm(n)),s.text(s.data("originalText")),p.a.post(v+"?html=true",f).then(function(o){var s=o.data;i.prop("disabled",!1),k.find("#"+y).remove();var a=n.closest(".diff-file");if(a.length>0){var r=new CustomEvent("blur.imageDiff",{detail:e});a[0].dispatchEvent(r)}if(w&&n.find("textarea.js-note-text").trigger("clear-commands-cache.atwho"),t.clearFlashWrapper(),c){k.find(".flash-container").remove(),d&&n.attr("data-discussion-id",i.data("discussionId")).attr("data-resolve-all","true").attr("data-project-path",i.data("projectPath"));var u=0===k.length;if(t.addDiscussionNote(n,s,u),u){var h=n.find("#note_position").val();if(a.length>0&&h.length>0){var f=JSON.parse(h),m=f.x,p=f.y,v=f.width,g=f.height,b=new CustomEvent("addBadge.imageDiff",{detail:{x:m,y:p,width:v,height:g,noteId:"note_"+s.id,discussionId:s.discussion_id}});a[0].dispatchEvent(b)}}k.length&&k.append('<div class="flash-container" style="display: none;"></div>')}else l&&(t.addNote(n,s),t.reenableTargetFormSubmitButton(e));s.commands_changes&&t.handleQuickActions(s),n.trigger("ajax:success",[s])}).catch(function(){k.find("#"+y).remove(),i.prop("disabled",!1);var o=new CustomEvent("blur.imageDiff",{detail:e}),s=n.closest(".diff-file");if(s.length&&s[0].dispatchEvent(o),w&&k.find("#"+b).remove(),c&&k.length){var a=k.parent().find(".js-discussion-reply-button");t.replyToDiscussionNote(a[0]),n=k.parent().find("form")}n.find(".js-note-text").val(g),t.reenableTargetFormSubmitButton(e),t.addNoteError(n)})}},{key:"updateComment",value:function(e){var t=this;e.preventDefault();var i=o()(e.target).parents("form"),n=i.find(".js-note-target-close"),s=i.parents(".note.is-editing"),r=s.find(".js-task-list-container").find(".note-text"),l=this.getFormData(i),c=l.formData,d=l.formContent,u=l.formAction,h=(i.closest(".diff-file"),i.closest(".notes"),r.html());return r.html(d),s.removeClass("is-editing fade-in-full").addClass("being-posted fade-in-half"),s.find(".note-headline-meta a").html('<i class="fa fa-spinner fa-spin" aria-label="Comment is being updated" aria-hidden="true"></i>'),p.a.post(u+"?html=true",c).then(function(e){var i=e.data;t.updateNote(i,s)}).catch(function(){r.html(a.a.escape(h)),s.removeClass("being-posted fade-in"),s.find(".fa.fa-spinner").remove(),t.updateNoteError()}),n.text(n.data("originalText"))}}],[{key:"initCommentTypeToggle",value:function(e){var t=e.querySelector(".js-comment-type-dropdown .dropdown-toggle"),i=e.querySelector(".js-comment-type-dropdown .dropdown-menu"),n=e.querySelector("#note_type"),o=e.querySelector(".js-comment-type-dropdown .js-comment-submit-button"),s=e.querySelector(".js-note-target-close"),a=e.querySelector(".js-note-target-reopen");new j({dropdownTrigger:t,dropdownList:i,noteTypeInput:n,submitButton:o,closeButton:s,reopenButton:a}).initDroplab()}},{key:"updateNoteTargetSelector",value:function(e){var t=Object(v.a)(),i=Boolean(t&&e.filter("#"+t).length>0);e.toggleClass("target",i)}},{key:"renderPlaceholderComponent",value:function(e){var t=e.find(".js-code-placeholder").get(0);new h.default({el:t,components:{SkeletonLoadingContainer:m.a},render:function(e){return e("skeleton-loading-container")}})}},{key:"renderDiffContent",value:function(e,t){var i=t.discussion_html,n=o()(i).find(".line_holder");n.addClass("fade-in"),e.find(".diff-content > table > tbody").prepend(n);var s=e.find(".file-holder");e.find(".line-holder-placeholder").remove(),Object(f.a)(s)}},{key:"isNewNote",value:function(e,t){return-1===o.a.inArray(e.id,t)}},{key:"isUpdatedNote",value:function(e,t){return A(e.note.trim())!==A(t.find(".original-note-content").first().text().trim())}},{key:"checkMergeRequestStatus",value:function(){"merge_requests"===Object(S.i)(1)&&gl.mrWidget&&gl.mrWidget.checkStatus()}},{key:"animateAppendNote",value:function(e,t){var i=o()(e);return i.addClass("fade-in-full").renderGFM(),t.append(i),i}},{key:"animateUpdateNote",value:function(e,t){var i=o()(e);return i.addClass("fade-in").renderGFM(),t.replaceWith(i),i}}]),e}();t.a=D;window.Notes=D},243:function(e,t,i){(function(t){var i;i=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,i){var n,o,s,a,r=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};n=function(e){return Array.prototype.slice.apply(e)},s=function(e,t){for(;e&&!e.classList.contains(t);)e=e.parentNode;return e},a=function(e,t){var i;return"function"==typeof Event?(i=new Event(e,{bubbles:!0,cancelable:!0})).detail=t:(i=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),i},o=function(){function e(e){var t;this.el=e,this.container=s(this.el,"js-task-list-container"),this.field=this.container.querySelector(".js-task-list-field"),this.container.addEventListener("change",(t=this,function(e){if(e.target.classList.contains("task-list-item-checkbox"))return t.updateTaskList(e.target)})),this.enable()}return e.prototype.enable=function(){var e;if(this.container.querySelectorAll(".js-task-list-field").length>0)return n(this.container.querySelectorAll(".task-list-item")).forEach(function(e){return e.classList.add("enabled")}),n(this.container.querySelectorAll(".task-list-item-checkbox")).forEach(function(e){return e.disabled=!1}),this.container.classList.add("is-task-list-enabled"),e=a("tasklist:enabled"),this.container.dispatchEvent(e)},e.prototype.disable=function(){var e;return n(this.container.querySelectorAll(".task-list-item")).forEach(function(e){return e.classList.remove("enabled")}),n(this.container.querySelectorAll(".task-list-item-checkbox")).forEach(function(e){return e.disabled=!0}),this.container.classList.remove("is-task-list-enabled"),e=a("tasklist:disabled"),this.container.dispatchEvent(e)},e.prototype.updateTaskList=function(t){var i,o,s,r;if(s=this.container.querySelectorAll(".task-list-item-checkbox"),r=1+n(s).indexOf(t),i=a("tasklist:change",{index:r,checked:t.checked}),this.field.dispatchEvent(i),!i.defaultPrevented)return this.field.value=e.updateSource(this.field.value,r,t.checked),i=a("change"),this.field.dispatchEvent(i),o=a("tasklist:changed",{index:r,checked:t.checked}),this.field.dispatchEvent(o)},e.incomplete="[ ]",e.complete="[x]",e.escapePattern=function(e){return e.replace(/([\[\]])/g,"\\$1").replace(/\s/,"\\s").replace("x","[xX]")},e.incompletePattern=RegExp(""+e.escapePattern(e.incomplete)),e.completePattern=RegExp(""+e.escapePattern(e.complete)),e.itemPattern=RegExp("^(?:\\s*(?:>\\s*)*(?:[-+*]|(?:\\d+\\.)))\\s*("+e.escapePattern(e.complete)+"|"+e.escapePattern(e.incomplete)+")\\s+(?!\\(.*?\\))(?=(?:\\[.*?\\]\\s*(?:\\[.*?\\]|\\(.*?\\))\\s*)*(?:[^\\[]|$))"),e.startFencesPattern=/^`{3}.*$/,e.endFencesPattern=/^`{3}$/,e.itemsInParasPattern=RegExp("^("+e.escapePattern(e.complete)+"|"+e.escapePattern(e.incomplete)+").+$","g"),e.updateSource=function(e,t,i){var n,o,s,a;return n=e.replace(/\r/g,"").replace(this.itemsInParasPattern,"").split("\n"),s=0,o=!1,function(){var l,c,d,u;for(u=[],l=0,c=(d=e.split("\n")).length;l<c;l++)a=d[l],o?a.match(this.endFencesPattern)&&(o=!1):a.match(this.startFencesPattern)?o=!0:r.call(n,a)>=0&&a.match(this.itemPattern)&&(s+=1)===t&&(a=i?a.replace(this.incompletePattern,this.complete):a.replace(this.completePattern,this.incomplete)),u.push(a);return u}.call(this).join("\n")},e}(),void 0!==t&&(t.fn.taskList=function(e){return this.each(function(i,n){var s;if((s=t(n).data("task-list"))||(s=new o(n),t(n).data("task-list",s),e&&"enable"!==e))return s[e||"enable"]()})}),e.exports=o}])},e.exports=i()}).call(this,i(0))},281:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.highlightLineClass=e.highlightLineClass||"hll",e.fileHolderSelector=e.fileHolderSelector||".file-holder",e.scrollFileHolder=e.scrollFileHolder||!1,e.hash=e.hash||window.location.hash,this.options=e,this._hash=e.hash,this.highlightLineClass=e.highlightLineClass,this.setHash=this.setHash.bind(this),this.highlightLine=this.highlightLine.bind(this),this.clickHandler=this.clickHandler.bind(this),this.highlightHash=this.highlightHash.bind(this),this.bindEvents(),this.highlightHash()};s.prototype.bindEvents=function(){var e=o()(this.options.fileHolderSelector);e.on("click","a[data-line-number]",this.clickHandler),e.on("highlight:line",this.highlightHash)},s.prototype.highlightHash=function(e){var t=void 0;if(e&&"string"==typeof e&&(this._hash=e),this.clearHighlight(),""!==this._hash&&(t=this.hashToRange(this._hash))[0]){this.highlightRange(t);var i="#L"+t[0],n={offset:-150};this.options.scrollFileHolder?o()(this.options.fileHolderSelector).scrollTo(i,n):o.a.scrollTo(i,n)}},s.prototype.clickHandler=function(e){var t,i,n;return e.preventDefault(),this.clearHighlight(),i=o()(e.target).closest("a").data("lineNumber"),(t=this.hashToRange(this._hash))[0]&&e.shiftKey?e.shiftKey?(n=i<t[0]?[i,t[0]]:[t[0],i],this.setHash(n[0],n[1]),this.highlightRange(n)):void 0:(this.setHash(i),this.highlightLine(i))},s.prototype.clearHighlight=function(){return o()("."+this.highlightLineClass).removeClass(this.highlightLineClass)},s.prototype.hashToRange=function(e){var t;return(t=e.match(/^#?L(\d+)(?:-(\d+))?$/))&&t.length?[parseInt(t[1],10),t[2]?parseInt(t[2],10):null]:[null,null]},s.prototype.highlightLine=function(e){return o()("#LC"+e).addClass(this.highlightLineClass)},s.prototype.highlightRange=function(e){if(e[1]){for(var t=[],i=e[0]<=e[1]?e:e.reverse(),n=e[0];n<=i[1];n+=1)t.push(this.highlightLine(n));return t}return this.highlightLine(e[0])},s.prototype.setHash=function(e,t){var i;return i=t?"#L"+e+"-"+t:"#L"+e,this._hash=i,this.__setLocationHash__(i)},s.prototype.__setLocationHash__=function(e){return window.history.pushState({url:e},document.title,e)},t.a=s},346:function(e,t,i){"use strict";var n=i(205);t.a=function(){var e=document.querySelector(".js-notes-data"),t=JSON.parse(e.innerHTML),i=t.notesUrl,o=t.notesIds,s=t.now,a=t.diffView,r=t.enableGFM;n.a.initialize(i,o,s,a,r)}},448:function(e,t,i){"use strict";t.a=function(){var e=window.location,t=e.protocol,i=e.host,n=e.pathname,o=document.querySelector(".js-share-btn"),s=document.querySelector(".js-embed-btn"),a=document.querySelector(".js-snippet-url-area"),r=document.querySelector(".js-embed-action"),l=t+"//"+(i+n);o.addEventListener("click",function(){o.classList.add("is-active"),s.classList.remove("is-active"),a.value=l,r.innerText="Share"}),s.addEventListener("click",function(){s.classList.add("is-active"),o.classList.remove("is-active");var e='<script src="'+l+'.js"><\/script>';a.value=e,r.innerText="Embed"})}},65:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=i(50),a=i.n(s),r=i(53),l=i(24),c=i.n(l),d=i(3),u=i.n(d),h=(i(157),i(66)),f=i(5);function m(e){var t=e.find(".button-attach-file"),i=e.find(".attaching-file-message"),n=e.find(".button-cancel-uploading-files"),s=e.find(".retry-uploading-link"),a=e.find(".uploading-progress"),r=e.find(".uploading-error-container"),l=e.find(".uploading-error-message"),d=e.find(".uploading-progress-container"),m=window.uploads_path||null,p=gon.max_file_size||10,v=e.find(".js-gfm-input"),g=void 0,y=void 0,b=void 0,w=void 0,k=void 0,C=void 0,j=void 0;v.wrap('<div class="div-dropzone"></div>'),v.on("paste",function(e){return g(e)});var E=v.closest(".md-area");e.setupMarkdownPreview();var x=e.find(".div-dropzone");if(x.parent().addClass("div-dropzone-wrapper"),x.append('<div class="div-dropzone-hover"></div>'),x.find(".div-dropzone-hover").append('<i class="fa fa-paperclip div-dropzone-icon"></i>'),m){var _=x.dropzone({url:m,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:p,uploadMultiple:!1,headers:h.a.headers,previewContainer:!1,processing:function(){return o()(".div-dropzone-alert").alert("close")},dragover:function(){E.addClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){E.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0)},drop:function(){E.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0),v.focus()},success:function(e,i){var n=this.getQueuedFiles().length+this.getUploadingFiles().length,o=n>=1;y(i.link.markdown,o),n||t.removeClass("hide"),b(i.link.url)},error:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Attaching the file failed.",o=arguments[2],s=o?o.responseText:i;r.removeClass("hide"),l.html(s),t.addClass("hide"),n.addClass("hide")},totaluploadprogress:function(e){w(this.files,i),a.text(Math.round(e)+"%")},sending:function(){t.addClass("hide"),r.addClass("hide"),d.removeClass("hide"),n.removeClass("hide")},removedfile:function(){t.removeClass("hide"),n.addClass("hide"),d.addClass("hide"),r.addClass("hide")},queuecomplete:function(){o()(".dz-preview").remove(),o()(".markdown-area").trigger("input"),d.addClass("hide"),n.addClass("hide")}}),N=o()(_[0]).children("textarea");n.on("click",function(e){e.preventDefault(),e.stopPropagation(),c.a.forElement(x.get(0)).removeAllFiles(!0)}),s.on("click",function(e){var t=c.a.forElement(e.target.closest(".js-main-target-form").querySelector(".div-dropzone")),i=t.files;e.preventDefault(),t.removeAllFiles(!0),i.map(function(e){var i=e;return i.status===c.a.ERROR&&(i.status=void 0,i.accepted=void 0),t.addFile(i)})}),g=function(e){var t=e.originalEvent;if(t.clipboardData&&t.clipboardData.items){var i=k(t);if(i){e.preventDefault();var n=C(t)||"image.png";return y("{{"+n+"}}"),j(i.getAsFile(),n)}}},k=function(e){for(var t=0;t<e.clipboardData.items.length;){var i=e.clipboardData.items[t];if(-1!==i.type.indexOf("image"))return i;t+=1}return!1},y=function(e,t){var i=e;t&&(i+="\n\n");var n=N.get(0),s=n.selectionStart,a=n.selectionEnd,r=o()(N).val().length,l=o()(N).val().substring(0,s),c=o()(N).val().substring(a,r);return o()(N).val(l+i+c),n.setSelectionRange(s+i.length,a+i.length),n.style.height=n.scrollHeight+"px",v.get(0).dispatchEvent(new Event("input")),v.trigger("input")},b=function(t){o()(e).append('<input type="hidden" name="files[]" value="'+u.a.escape(t)+'">')},C=function(e){var t=void 0;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),(t=t.split("\r"))[0]};var S=function(){return d.addClass("hide")};j=function(t,i){var n=new FormData;n.append("file",t,i),d.removeClass("hide"),e.find(".div-dropzone-alert").alert("close"),f.a.post(m,n).then(function(e){var t=e.data.link.markdown;!function(e,t){var i=o()(N);i.val(function(i,n){return n.replace("{{"+e+"}}",t)}),i.trigger("change")}(i,t),S()}).catch(function(e){var t;t=e.response.data.message,r.removeClass("hide"),l.html(t),S()})},w=function(e,t){var i=void 0,n=e.filter(function(e){return"uploading"===e.status||"queued"===e.status}).length;i=n>1?"Attaching "+n+" files -":"Attaching a file -",t.text(i)},e.find(".markdown-selector").click(function(e){e.preventDefault(),o()(this).closest(".gfm-form").find(".div-dropzone").click(),v.focus()})}else x.addClass("js-invalid-dropzone")}c.a.autoDiscover=!1;var p=i(11);function v(e,t,i,n){var s,a,r;return e=(s=o()(e)).get(0),a=function(e,t){return e.substring(t.selectionStart,t.selectionEnd)}(r=s.val(),e),s.focus(),function(e,t,i,n,o,s){var a,r,l,c,d,u,h;return c=!1,d=!1,u=!1,0===o.indexOf("\n")&&(d=!0,o=o.replace(/\n+/,"")),e.selectionEnd-e.selectionStart>o.replace(/\n$/,"").length&&(c=!0,o=o.replace(/\n$/,"")),r=o.split("\n"),s||(h=e.value.substr(0,e.selectionStart).lastIndexOf("\n"),/^\s*$/.test(e.value.substring(h,e.selectionStart))&&(u=!0)),l=!s&&!u&&e.selectionStart>0?"\n":"",a=r.length>1&&(!s||null!=n&&""!==n)?null!=n&&""!==n?function(e,t,i,n){var o=function(e,t){var i;return(i=e.substring(0,t.selectionStart).trim().split("\n"))[i.length-1]}(e,t),s=function(e,t){return e.substring(t.selectionEnd).trim().split("\n")[0]}(e,t);return o===i&&s===i?(null!=i&&(t.selectionStart=t.selectionStart-(i.length+1),t.selectionEnd=t.selectionEnd+(i.length+1)),n):i+"\n"+n+"\n"+i}(t,e,n,o):r.map(function(e){return 0===e.indexOf(i)?""+e.replace(i,""):""+i+e}).join("\n"):""+l+i+o+(s?i:" "),d&&(a="\n"+a),c&&(a+="\n"),Object(p.p)(e,a),function(e,t,i,n){var o;if(e.setSelectionRange)return e.selectionStart===e.selectionEnd?(o=i?e.selectionStart-t.length:e.selectionStart,n&&(o-=1),e.setSelectionRange(o,o)):void 0}(e,i,s,c)}(e,r,t,i,a,n)}var g=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var y=function(){function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM=Object.assign({},r.b,n);var o=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach(function(e){"emojis"!==e&&(i.enableGFM[e]=!!o[e])}),this.destroy(),this.setupForm(),this.form.data("glForm",this)}return g(e,[{key:"destroy",value:function(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.form.data("glForm",null)}},{key:"setupForm",value:function(){var e,t=this.form.is(":not(.gfm-form)");this.form.removeClass("js-new-note-form"),t&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),gl.utils.disableButtonIfEmptyField(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new r.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),m(this.form),a()(this.textarea)),this.addEventListeners(),e=this.form,o()(".js-md",e).off("click").on("click",function(){var e=o()(this);return v(e.closest(".md-area").find("textarea"),e.data("mdTag"),e.data("mdBlock"),!e.data("mdPrepend"))}),this.form.find(".js-note-discard").hide(),this.form.show(),this.isAutosizeable&&this.setupAutosize()}},{key:"setupAutosize",value:function(){var e=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout(function(){a()(e.textarea),e.textarea.css("resize","vertical")},0)}},{key:"setHeightData",value:function(){this.textarea.data("height",this.textarea.outerHeight())}},{key:"destroyAutosize",value:function(){var e=this.textarea.outerHeight();this.textarea.data("height")!==e&&(a.a.destroy(this.textarea),this.textarea.data("height",e),this.textarea.outerHeight(e),this.textarea.css("max-height",window.outerHeight))}},{key:"clearEventListeners",value:function(){var e;this.textarea.off("focus"),this.textarea.off("blur"),e=this.form,o()(".js-md",e).off("click")}},{key:"addEventListeners",value:function(){this.textarea.on("focus",function(){o()(this).closest(".md-area").addClass("is-focused")}),this.textarea.on("blur",function(){o()(this).closest(".md-area").removeClass("is-focused")})}}]),e}();t.a=y},71:function(e,t,i){"use strict";var n=i(0),o=i.n(n),s=(i(158),i(24)),a=i.n(s),r=i(29),l=i.n(r),c=(i(99),function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}());a.a.autoDiscover=!1;var d=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_backdrop=null,this.active_textarea=null,o()(document).on("click",".js-zen-enter",function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:enter")}),o()(document).on("click",".js-zen-leave",function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:leave")}),o()(document).on("zen_mode:enter",(t=this,function(e){return t.enter(o()(e.target).closest(".md-area").find(".zen-backdrop"))})),o()(document).on("zen_mode:leave",function(e){return function(t){return e.exit()}}(this)),o()(document).on("keydown",function(e){if(27===e.keyCode)return e.preventDefault(),o()(document).trigger("zen_mode:leave")})}return c(e,[{key:"enter",value:function(e){l.a.pause(),this.active_backdrop=o()(e),this.active_backdrop.addClass("fullscreen"),this.active_textarea=this.active_backdrop.find("textarea"),this.active_textarea.removeAttr("style"),this.active_textarea.focus()}},{key:"exit",value:function(){if(this.active_textarea){l.a.unpause(),this.active_textarea.closest(".zen-backdrop").removeClass("fullscreen"),this.scrollTo(this.active_textarea),this.active_textarea=null,this.active_backdrop=null;var e=o()(".div-dropzone");e&&!e.hasClass("js-invalid-dropzone")&&a.a.forElement(".div-dropzone").enable()}}},{key:"scrollTo",value:function(e){return o.a.scrollTo(e,0,{offset:-150})}}]),e}();t.a=d},903:function(e,t,i){"use strict";i.r(t);var n=i(346),o=i(71),s=i(281),a=i(198),r=i(448);document.addEventListener("DOMContentLoaded",function(){new s.a,new a.a,Object(n.a)(),new o.a,Object(r.a)()})},904:function(e,t,i){i(31),i(57),e.exports=i(903)},93:function(e,t,i){"use strict";function n(e,t){var i=t.x,n=t.y,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=document.createElement("button");return o.concat(["js-image-badge"]).forEach(function(e){return s.classList.add(e)}),s.setAttribute("type","button"),s.setAttribute("disabled",!0),s.dataset.noteId=e,s.style.left=i+"px",s.style.top=n+"px",s}function o(e,t){var i=t.x,n=t.y,o=document.createElement("button");o.classList.add("btn-transparent"),o.classList.add("comment-indicator"),o.setAttribute("type","button"),o.style.left=i+"px",o.style.top=n+"px",o.innerHTML=gl.utils.spriteIcon("image-comment-dark"),e.appendChild(o)}var s={x:0,y:0,width:0,height:0},a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=t.noteId,n=t.discussionId;this.actual=t.actual||s,this.browser=t.browser||s,this.noteId=i,this.discussionId=n,t.imageEl&&!t.browser&&(this.browser=w.resizeCoordinatesToImageElement(t.imageEl,this.actual))},r=i(0),l=i.n(r);var c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var d=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.canCreateNote=!(!i||!i.canCreateNote),this.renderCommentBadge=!(!i||!i.renderCommentBadge),this.$noteContainer=l()(".note-container",this.el),this.imageBadges=[]}return c(e,[{key:"init",value:function(){this.imageFrameEl=this.el.querySelector(".diff-file .js-image-frame"),this.imageEl=this.imageFrameEl.querySelector("img"),this.bindEvents()}},{key:"bindEvents",value:function(){var e;this.imageClickedWrapper=this.imageClicked.bind(this),this.imageBlurredWrapper=w.removeCommentIndicator.bind(null,this.imageFrameEl),this.addBadgeWrapper=this.addBadge.bind(this),this.removeBadgeWrapper=this.removeBadge.bind(this),this.renderBadgesWrapper=this.renderBadges.bind(this),(e=this.imageEl).complete&&0!==e.naturalHeight?this.renderBadges():this.imageEl.addEventListener("load",this.renderBadgesWrapper),this.$noteContainer.on("click",".js-diff-notes-toggle",w.toggleCollapsed),l()(this.el).on("click",".comment-indicator",w.commentIndicatorOnClick),this.canCreateNote&&(this.el.addEventListener("click.imageDiff",this.imageClickedWrapper),this.el.addEventListener("blur.imageDiff",this.imageBlurredWrapper),this.el.addEventListener("addBadge.imageDiff",this.addBadgeWrapper),this.el.addEventListener("removeBadge.imageDiff",this.removeBadgeWrapper))}},{key:"imageClicked",value:function(e){var t=e.detail,i=w.getTargetSelection(t),n=t.currentTarget;w.setPositionDataAttribute(n,i.actual),w.showCommentIndicator(this.imageFrameEl,i.browser)}},{key:"renderBadges",value:function(){var e=this.el.querySelectorAll(".note-container .discussion-notes .notes");[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e)).forEach(this.renderBadge.bind(this))}},{key:"renderBadge",value:function(e,t){var i=w.generateBadgeFromDiscussionDOM(this.imageFrameEl,e);this.imageBadges.push(i);var n={coordinate:i.browser,noteId:i.noteId};if(this.renderCommentBadge)w.addImageCommentBadge(this.imageFrameEl,n);else{var o=Object.assign({},n,{badgeText:t+1});w.addImageBadge(this.imageFrameEl,o)}}},{key:"addBadge",value:function(e){var t=e.detail,i=t.x,n=t.y,o=t.width,s=t.height,r=t.noteId,l=t.discussionId,c=this.imageBadges.length+1,d=new a({actual:{x:i,y:n,width:o,height:s},imageEl:this.imageFrameEl.querySelector("img"),noteId:r,discussionId:l});this.imageBadges.push(d),w.addImageBadge(this.imageFrameEl,{coordinate:d.browser,badgeText:c,noteId:r}),w.addAvatarBadge(this.el,{detail:{noteId:r,badgeNumber:c}});var u=this.el.querySelector("#discussion_"+l);w.updateDiscussionBadgeNumber(u,c)}},{key:"removeBadge",value:function(e){var t=this,i=e.detail.badgeNumber,n=i-1,o=this.imageFrameEl.querySelectorAll(".badge");this.imageBadges.length!==i&&this.imageBadges.forEach(function(e,i){if(i>n){var s=e.discussionId,a=i,r=t.el.querySelector("#discussion_"+s);o[i].innerText=a,w.updateDiscussionBadgeNumber(r,a),w.updateDiscussionAvatarBadgeNumber(r,a)}}),this.imageBadges.splice(n,1),o[n].remove()}}]),e}(),u={TWO_UP:"TWO_UP",SWIPE:"SWIPE",ONION_SKIN:"ONION_SKIN"};var h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d),h(t,[{key:"init",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.TWO_UP;this.imageFrameEls=(f(e={},u.TWO_UP,this.el.querySelector(".two-up .js-image-frame")),f(e,u.SWIPE,this.el.querySelector(".swipe .js-image-frame")),f(e,u.ONION_SKIN,this.el.querySelector(".onion-skin .js-image-frame")),e);var n=this.el.querySelector(".view-modes-menu");this.viewModesEls=(f(t={},u.TWO_UP,n.querySelector(".two-up")),f(t,u.SWIPE,n.querySelector(".swipe")),f(t,u.ONION_SKIN,n.querySelector(".onion-skin")),t),this.currentView=i,this.generateImageEls(),this.bindEvents()}},{key:"generateImageEls",value:function(){var e=this;this.imageEls={},Object.getOwnPropertyNames(u).forEach(function(t){e.imageEls[t]=e.imageFrameEls[t].querySelector("img")})}},{key:"bindEvents",value:function(){(function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bindEvents",this).call(this),this.changeToViewTwoUp=this.changeView.bind(this,u.TWO_UP),this.changeToViewSwipe=this.changeView.bind(this,u.SWIPE),this.changeToViewOnionSkin=this.changeView.bind(this,u.ONION_SKIN),this.viewModesEls[u.TWO_UP].addEventListener("click",this.changeToViewTwoUp),this.viewModesEls[u.SWIPE].addEventListener("click",this.changeToViewSwipe),this.viewModesEls[u.ONION_SKIN].addEventListener("click",this.changeToViewOnionSkin)}},{key:"changeView",value:function(e){if(t=e,Object.getOwnPropertyNames(u).find(function(e){return e===t})){var t,i=w.removeCommentIndicator(this.imageFrameEl);this.currentView=e;var n=this.imageFrameEl.querySelectorAll(".badge");[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n)).map(function(e){return e.remove()}),this.imageBadges=[],setTimeout(this.renderNewView.bind(this,i),250)}}},{key:"renderNewView",value:function(e){if(this.renderBadges(),e.removed){var t=w.resizeCoordinatesToImageElement(this.imageEl,{x:e.x,y:e.y,width:e.image.width,height:e.image.height});w.showCommentIndicator(this.imageFrameEl,t)}}},{key:"imageEl",get:function(){return this.imageEls[this.currentView]}},{key:"imageFrameEl",get:function(){return this.imageFrameEls[this.currentView]}}]),t}(),p=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){o=!0,s=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var g=900,y=["two-up","swipe"],b=function(){function e(t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.views={"two-up":function(){return l()(".two-up.view .wrap",this.file).each((e=this,function(t,i){return l()("img",i).each(function(){if(l()(this).width()>g/2)return l()(this).width(g/2)}),e.requestImageInfo(l()("img",i),function(e,t){return l()(".image-info .meta-width",i).text(e+"px"),l()(".image-info .meta-height",i).text(t+"px"),l()(".image-info",i).removeClass("hide")})}));var e},swipe:function(){var e,t,i;return t=0,e=0,l()(".swipe.view",this.file).each((i=this,function(n,o){var s,a,r,c,d,u;u=i.prepareFrames(o),s=p(u,2),t=s[0],e=s[1],c=l()(".swipe-frame",o),a=l()(".swipe-wrap",o),r=l()(".swipe-bar",o),c.css({width:t+16,height:e+28}),a.css({width:t+1,height:e+2}),r.css({left:1}),d=parseInt(a.css("right").replace("px",""),10),i.initDraggable(r,d,function(e,i){i>0&&i<c.width()-2*d&&(a.width(t+1-i),r.css("left",i))})}))},"onion-skin":function(){var e,t,i,n;return i=0,t=0,e=l()(".drag-track",this.file).width()-l()(".dragger",this.file).width(),l()(".onion-skin.view",this.file).each((n=this,function(o,s){var a,r,c,d,u,h,f;f=n.prepareFrames(s),a=p(f,2),i=a[0],t=a[1],r=l()(".onion-skin-frame",s),u=l()(".frame.added",s),c=l()(".drag-track",s),d=l()(".dragger",c),r.css({width:i+16,height:t+28}),l()(".swipe-wrap",s).css({width:i+1,height:t+2}),d.css({left:e}),u.css("opacity",1),h=parseInt(u.css("right").replace("px",""),10),n.initDraggable(d,h,function(t,i){var n=i/e;n>=0&&n<=1&&(d.css("left",i),u.css("opacity",n))})}))}},this.file=t,this.requestImageInfo(l()(".two-up.view .frame.deleted img",this.file),(i=this,function(e,t){return i.requestImageInfo(l()(".two-up.view .frame.added img",i.file),function(e,t){i.initViewModes(),l()(".two-up.view img",i.file).waitForImages(function(){i.initView("two-up")})})}))}return v(e,[{key:"initViewModes",value:function(){var e,t=y[0];return l()(".view-modes",this.file).removeClass("hide"),l()(".view-modes-menu",this.file).on("click","li",(e=this,function(t){if(!l()(t.currentTarget).hasClass("active"))return e.activateViewMode(t.currentTarget.className)})),this.activateViewMode(t)}},{key:"activateViewMode",value:function(e){return l()(".view-modes-menu li",this.file).removeClass("active").filter("."+e).addClass("active"),l()(".view:visible:not(."+e+")",this.file).fadeOut(200,(t=this,function(){return l()(".view."+e,t.file).fadeIn(200),t.initView(e)}));var t}},{key:"initView",value:function(e){return this.views[e].call(this)}},{key:"initDraggable",value:function(e,t,i){var n=!1,o=l()("body"),s=e.parent();e.off("mousedown").on("mousedown",function(){n=!0,o.css("user-select","none")}),o.off("mouseup").off("mousemove").on("mouseup",function(){n=!1,o.css("user-select","")}).on("mousemove",function(e){var o;n&&(o=e.pageX-(s.offset().left+t),i(e,o))})}},{key:"prepareFrames",value:function(e){var t,i;return i=0,t=0,l()(".frame",e).each(function(e,n){var o,s;return s=l()(n).width(),o=l()(n).height(),i=s>i?s:i,t=o>t?o:t}).css({width:i,height:t}),[i,t]}},{key:"requestImageInfo",value:function(e,t){var i,n=e.get(0);if(n)return n.complete?t.call(this,n.naturalWidth,n.naturalHeight):e.on("load",(i=this,function(){return t.call(i,n.naturalWidth,n.naturalHeight)}))}}]),e}();var w=t.a={addCommentIndicator:o,removeCommentIndicator:function(e){var t=e.querySelector(".comment-indicator"),i=e.querySelector("img"),n=!!t,o={};return n&&(o={x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),image:{width:i.width,height:i.height}},t.remove()),Object.assign({},o,{removed:n})},showCommentIndicator:function(e,t){var i=t.x,n=t.y,s=e.querySelector(".comment-indicator");s?(s.style.left=i+"px",s.style.top=n+"px"):o(e,t)},commentIndicatorOnClick:function(e){e.stopPropagation(),e.currentTarget.closest(".diff-viewer").querySelector(".note-container .note-textarea").focus()},addImageBadge:function(e,t){var i=t.coordinate,o=t.badgeText,s=n(t.noteId,i,["badge"]);s.innerText=o,e.appendChild(s)},addImageCommentBadge:function(e,t){var i=t.coordinate,o=n(t.noteId,i,["image-comment-badge"]);o.innerHTML=gl.utils.spriteIcon("image-comment-dark"),e.appendChild(o)},addAvatarBadge:function(e,t){var i=t.detail,n=i.noteId,o=i.badgeNumber,s=e.querySelector("#"+n+" .badge");s.innerText=o,s.classList.remove("hidden")},setPositionDataAttribute:function(e,t){var i=t.x,n=t.y,o=t.width,s=t.height,a=e.dataset.position,r=Object.assign({},JSON.parse(a),{x:i,y:n,width:o,height:s});e.setAttribute("data-position",JSON.stringify(r))},updateDiscussionAvatarBadgeNumber:function(e,t){e.querySelector(".image-diff-avatar-link .badge").innerText=t},updateDiscussionBadgeNumber:function(e,t){e.querySelector(".badge").innerText=t},toggleCollapsed:function(e){var t=e.currentTarget.closest(".discussion-notes"),i=t.querySelector(".discussion-form"),n=t.classList.contains("collapsed");n?t.classList.remove("collapsed"):t.classList.add("collapsed"),i&&!n?i.style.display="none":i&&n&&(i.style.display="block")},resizeCoordinatesToImageElement:function(e,t){var i=t.x,n=t.y,o=t.width,s=t.height,a=e.width,r=e.height,l=a/o,c=r/s;return{x:Math.round(i*l),y:Math.round(n*c),width:a,height:r}},generateBadgeFromDiscussionDOM:function(e,t){var i=JSON.parse(t.dataset.position),n=t.querySelector(".note");return new a({actual:i,imageEl:e.querySelector("img"),noteId:n.id,discussionId:t.dataset.discussionId})},getTargetSelection:function(e){var t=e.currentTarget.querySelector("img"),i=e.offsetX,n=e.offsetY,o=t.width,s=t.height,a=t.naturalWidth,r=t.naturalHeight,l=a/o,c=r/s,d=Math.max(0,i)&&Math.min(i,o),u=Math.max(0,n)&&Math.min(n,s);return{browser:{x:d,y:u,width:o,height:s},actual:{x:Math.round(d*l),y:Math.round(u*c),width:a,height:r}}},initImageDiff:function(e,t,i){var n={canCreateNote:t,renderCommentBadge:i},o=void 0;return new b(e),e.querySelector(".diff-file .js-single-image")?(o=new d(e,n)).init():e.querySelector(".diff-file .js-replaced-image")&&(o=new m(e,n)).init(),o}}},98:function(e,t,i){"use strict";var n=i(76),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var s=function(){function e(t,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.field=t,this.isLocalStorageAvailable=n.a.isLocalStorageAccessSafe(),null!=i.join&&(i=i.join("/")),this.key="autosave/"+i,this.field.data("autosave",this),this.restore(),this.field.on("input",function(){return o.save()})}return o(e,[{key:"restore",value:function(){if(this.isLocalStorageAvailable&&this.field.length){var e=window.localStorage.getItem(this.key);(null!=e?e.length:void 0)>0&&this.field.val(e),this.field.trigger("input");var t=new Event("change",{bubbles:!0,cancelable:!1}),i=this.field.get(0);i&&i.dispatchEvent(t)}}},{key:"save",value:function(){if(this.field.length){var e=this.field.val();return this.isLocalStorageAvailable&&(null!=e?e.length:void 0)>0?window.localStorage.setItem(this.key,e):this.reset()}}},{key:"reset",value:function(){if(this.isLocalStorageAvailable)return window.localStorage.removeItem(this.key)}},{key:"dispose",value:function(){this.field.off("input")}}]),e}();t.a=s},99:function(e,t){Mousetrap=function(e){var t=e,i=t.stopCallback,n=!0;return t.stopCallback=function(e,t,o){return!n||i(e,t,o)},t.pause=function(){n=!1},t.unpause=function(){n=!0},t}(Mousetrap)}},[[904,0,1,2,3]]]);
//# sourceMappingURL=pages.projects.snippets.show.16379bde.chunk.js.map