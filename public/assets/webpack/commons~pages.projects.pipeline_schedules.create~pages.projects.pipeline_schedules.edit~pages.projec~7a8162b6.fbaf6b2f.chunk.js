(this.webpackJsonp=this.webpackJsonp||[]).push([[9],{167:function(e,t,n){"use strict";var r=n(3),a=n.n(r),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultToggleLabel=t.defaultToggleLabel,this.fieldName=t.fieldName,this.onSelect=t.onSelect||function(){},this.getDataOption=t.getData,this.getDataRemote=!!t.filterRemote,this.createNewItemFromValueOption=t.createNewItemFromValue,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$createButton=this.$dropdownContainer.find(".js-dropdown-create-new-item"),this.buildDropdown(),this.bindEvents(),this.toggleFooter(!0)}return i(e,[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getData.bind(this),filterable:!0,filterRemote:this.getDataRemote,search:{fields:["text"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?a.a.escape(e.title):this.defaultToggleLabel},fieldName:this.fieldName,text:function(e){return a.a.escape(e.text)},id:function(e){return a.a.escape(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t){t.e.preventDefault(),e.onSelect()}})}},{key:"clearDropdown",value:function(){this.$dropdownContainer.find(".dropdown-content").html(""),this.$dropdownContainer.find(".dropdown-input-field").val("")}},{key:"bindEvents",value:function(){this.$createButton.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(e){e.preventDefault(),this.refreshData(),this.$dropdown.data("glDropdown").selectRowAtIndex()}},{key:"refreshData",value:function(){this.$dropdown.data("glDropdown").remote.execute()}},{key:"getData",value:function(e,t){var n=this;this.getDataOption(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=e;n.selectedItem&&e.some(function(e){return e.id===n.selectedItem.id})||(r=e.concat(n.selectedItem||[])),t(r)})}},{key:"createNewItemFromValue",value:function(e){return this.createNewItemFromValueOption?this.createNewItemFromValueOption(e):{title:e,id:e,text:e}}},{key:"toggleCreateNewButton",value:function(e){e&&(this.selectedItem=this.createNewItemFromValue(e),this.$dropdownContainer.find(".js-dropdown-create-new-item code").text(e)),this.toggleFooter(!e)}},{key:"toggleFooter",value:function(e){this.$dropdownFooter.toggleClass("hidden",e)}}]),e}();t.a=o},199:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(0),a=n.n(r),i=n(7),o=n(1),l=n(11);function s(e,t){e.classList.toggle("is-checked",t)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.querySelectorAll(".js-project-feature-toggle").forEach(function(e){var n=e.querySelector(".js-project-feature-toggle-input");s(e,Object(l.g)(n.value)),e.addEventListener("click",function(e,t,n){var r=Object(l.g)(t.value);s(e,!r),e.setAttribute("disabled",!0),e.classList.toggle("is-loading",!0),Promise.resolve(n(!r,e)).then(function(){t.setAttribute("value",!r)}).catch(function(){s(e,r)}).then(function(){e.removeAttribute("disabled"),e.classList.toggle("is-loading",!1),a()(t).trigger("trigger-change")}).catch(function(){Object(i.a)(Object(o.a)("Something went wrong when toggling the button"))})}.bind(null,e,n,t))})}},246:function(e,t,n){"use strict";var r=n(1),a=n(11),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=t.container,r=t.valueSelector,a=void 0===r?".js-secret-value":r,i=t.placeholderSelector,o=void 0===i?".js-secret-value-placeholder":i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.valueSelector=a,this.placeholderSelector=o}return i(e,[{key:"init",value:function(){if(this.revealButton=this.container.querySelector(".js-secret-value-reveal-button"),this.revealButton){var e=Object(a.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(e),this.revealButton.addEventListener("click",this.onRevealButtonClicked.bind(this))}}},{key:"onRevealButtonClicked",value:function(){var e=Object(a.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(!e)}},{key:"updateDom",value:function(e){var t=this.container.querySelectorAll(this.valueSelector);t.forEach(function(t){t.classList.toggle("hide",!e)}),this.container.querySelectorAll(this.placeholderSelector).forEach(function(t){t.classList.toggle("hide",e)}),this.revealButton.textContent=e?Object(r.d)("Hide value","Hide values",t.length):Object(r.d)("Reveal value","Reveal values",t.length),this.revealButton.dataset.secretRevealStatus=e}}]),e}();t.a=o},284:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(11),o=n(1),l=n(199),s=n(167),c=n(246),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var v=Object(o.e)("CiVariable|All environments");function f(e){return{title:"*"===e?v:e,id:e,text:"*"===e?Object(o.e)("CiVariable|* (All environments)"):e}}var p=function(){function e(t){var n=t.container,r=t.formField;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=a()(n),this.formField=r,this.environmentDropdownMap=new WeakMap,this.inputMap={id:{selector:".js-ci-variable-input-id",default:""},key:{selector:".js-ci-variable-input-key",default:""},secret_value:{selector:".js-ci-variable-input-value",default:""},protected:{selector:".js-ci-variable-input-protected",default:"false"},environment_scope:{selector:'input[name="'+this.formField+'[variables_attributes][][environment_scope]"]',default:"*"},_destroy:{selector:".js-ci-variable-input-destroy",default:""}},this.secretValues=new c.a({container:this.$container[0],valueSelector:".js-row:not(:last-child) .js-secret-value",placeholderSelector:".js-row:not(:last-child) .js-secret-value-placeholder"})}return d(e,[{key:"init",value:function(){this.bindEvents(),this.secretValues.init()}},{key:"bindEvents",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){e.initRow(n)}),this.$container.on("click",".js-row-remove-button",function(t){t.preventDefault(),e.removeRow(a()(t.currentTarget).closest(".js-row"))});var t=Object.keys(this.inputMap).map(function(t){return e.inputMap[t].selector}).join(",");this.$container.on("blur",t,function(t){var n=a()(t.currentTarget).closest(".js-row");n.is(":not(:last-child)")&&!e.checkIfRowTouched(n)&&e.removeRow(n)}),this.$container.on("input trigger-change",t,function(){var t=e.$container.find(".js-row").last();e.checkIfRowTouched(t)&&e.insertRow(t)})}},{key:"initRow",value:function(e){var t=this,n=a()(e);Object(l.a)(n[0]),n.find(this.inputMap.secret_value.selector).css("height","");var r=n.find(".js-variable-environment-toggle");if(r.length){var i=new s.a({$dropdown:r,defaultToggleLabel:v,fieldName:this.formField+"[variables_attributes][][environment_scope]",getData:function(e,n){return n(t.getEnvironmentValues())},createNewItemFromValue:f,onSelect:function(){t.refreshDropdownData(),n.find(t.inputMap.environment_scope.selector).trigger("trigger-change")}});i.clearDropdown(),this.environmentDropdownMap.set(n[0],i)}}},{key:"insertRow",value:function(e){var t=this,n=e.clone();n.removeAttr("data-is-persisted"),Object.keys(this.inputMap).forEach(function(e){var r=t.inputMap[e];n.find(r.selector).val(r.default)}),n.find(".dropdown-menu.show").each(function(e,t){t.classList.remove("show")}),this.initRow(n),e.after(n)}},{key:"removeRow",value:function(e){var t=a()(e);Object(i.g)(t.attr("data-is-persisted"))?(t.hide(),t.find(this.inputMap._destroy.selector).val(!0)):t.remove(),this.refreshDropdownData()}},{key:"checkIfRowTouched",value:function(e){var t=this;return Object.keys(this.inputMap).some(function(n){var r=t.inputMap[n],a=e.find(r.selector);return a.length&&a.val()!==r.default})}},{key:"toggleEnableRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$container.find(this.inputMap.key.selector).attr("disabled",!e),this.$container.find(".js-row-remove-button").attr("disabled",!e)}},{key:"hideValues",value:function(){this.secretValues.updateDom(!1)}},{key:"getAllData",value:function(){var e=this;return this.$container.find(".js-row").toArray().slice(0,-1).map(function(t){var n={};return Object.keys(e.inputMap).forEach(function(r){var i=e.inputMap[r],o=a()(t).find(i.selector);o.length&&(n[r]=o.val())}),n})}},{key:"getEnvironmentValues",value:function(){var e=this.$container.find(this.inputMap.environment_scope.selector).toArray().reduce(function(e,t){return u({},e,(n={},r=t.value,a=t.value,r in n?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,n));var n,r,a},{});return Object.keys(e).map(f)}},{key:"refreshDropdownData",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){var r=e.environmentDropdownMap.get(n);r&&r.refreshData()})}}]),e}();t.a=p},352:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(8),o=n(72),l=n(503),s=n(3),c=n.n(s),u={props:{initialCronInterval:{type:String,required:!1,default:""}},data:function(){return{inputNameAttribute:"schedule[cron]",cronInterval:this.initialCronInterval,cronIntervalPresets:{everyDay:"0 4 * * *",everyWeek:"0 4 * * 0",everyMonth:"0 4 1 * *"},cronSyntaxUrl:"https://en.wikipedia.org/wiki/Cron",customInputEnabled:!1}},computed:{intervalIsPreset:function(){return c.a.contains(this.cronIntervalPresets,this.cronInterval)},isEditable:function(){return!(!this.customInputEnabled&&this.intervalIsPreset)}},watch:{cronInterval:function(){this.$nextTick(function(){gl.pipelineScheduleFieldErrors.updateFormValidityState()})}},created:function(){this.intervalIsPreset&&(this.enableCustomInput=!1)},methods:{toggleCustomInput:function(e){this.customInputEnabled=e,e&&(this.cronInterval=this.cronInterval+" ")}}},d=n(2),v=Object(d.a)(u,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"interval-pattern-form-group"},[n("div",{staticClass:"cron-preset-radio-input"},[n("input",{staticClass:"label-bold",attrs:{id:"custom",name:e.inputNameAttribute,type:"radio"},domProps:{value:e.cronInterval,checked:e.isEditable},on:{click:function(t){e.toggleCustomInput(!0)}}}),e._v(" "),n("label",{attrs:{for:"custom"}},[e._v("\n      "+e._s(e.s__("PipelineSheduleIntervalPattern|Custom"))+"\n    ")]),e._v(" "),n("span",{staticClass:"cron-syntax-link-wrap"},[e._v("\n      ("),n("a",{attrs:{href:e.cronSyntaxUrl,target:"_blank"}},[e._v("\n        "+e._s(e.__("Cron syntax"))+"\n      ")]),e._v(")\n    ")])]),e._v(" "),n("div",{staticClass:"cron-preset-radio-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cronInterval,expression:"cronInterval"}],staticClass:"label-bold",attrs:{id:"every-day",name:e.inputNameAttribute,type:"radio"},domProps:{value:e.cronIntervalPresets.everyDay,checked:e._q(e.cronInterval,e.cronIntervalPresets.everyDay)},on:{click:function(t){e.toggleCustomInput(!1)},change:function(t){e.cronInterval=e.cronIntervalPresets.everyDay}}}),e._v(" "),n("label",{staticClass:"label-bold",attrs:{for:"every-day"}},[e._v("\n      "+e._s(e.__("Every day (at 4:00am)"))+"\n    ")])]),e._v(" "),n("div",{staticClass:"cron-preset-radio-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cronInterval,expression:"cronInterval"}],staticClass:"label-bold",attrs:{id:"every-week",name:e.inputNameAttribute,type:"radio"},domProps:{value:e.cronIntervalPresets.everyWeek,checked:e._q(e.cronInterval,e.cronIntervalPresets.everyWeek)},on:{click:function(t){e.toggleCustomInput(!1)},change:function(t){e.cronInterval=e.cronIntervalPresets.everyWeek}}}),e._v(" "),n("label",{staticClass:"label-bold",attrs:{for:"every-week"}},[e._v("\n      "+e._s(e.__("Every week (Sundays at 4:00am)"))+"\n    ")])]),e._v(" "),n("div",{staticClass:"cron-preset-radio-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cronInterval,expression:"cronInterval"}],staticClass:"label-bold",attrs:{id:"every-month",name:e.inputNameAttribute,type:"radio"},domProps:{value:e.cronIntervalPresets.everyMonth,checked:e._q(e.cronInterval,e.cronIntervalPresets.everyMonth)},on:{click:function(t){e.toggleCustomInput(!1)},change:function(t){e.cronInterval=e.cronIntervalPresets.everyMonth}}}),e._v(" "),n("label",{staticClass:"label-bold",attrs:{for:"every-month"}},[e._v("\n      "+e._s(e.__("Every month (on the 1st at 4:00am)"))+"\n    ")])]),e._v(" "),n("div",{staticClass:"cron-interval-input-wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cronInterval,expression:"cronInterval"}],staticClass:"form-control inline cron-interval-input",attrs:{id:"schedule_cron",placeholder:e.__("Define a custom pattern with cron syntax"),name:e.inputNameAttribute,disabled:!e.isEditable,type:"text",required:"true"},domProps:{value:e.cronInterval},on:{input:function(t){t.target.composing||(e.cronInterval=t.target.value)}}})])])},[],!1,null,null,null).exports,f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$dropdown=a()(".js-timezone-dropdown"),this.$dropdownToggle=this.$dropdown.find(".dropdown-toggle-text"),this.$input=a()("#schedule_cron_timezone"),this.timezoneData=this.$dropdown.data("data"),this.initDefaultTimezone(),this.initDropdown()}return f(e,[{key:"initDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.timezoneData,filterable:!0,selectable:!0,toggleLabel:function(e){return e.name},search:{fields:["name"]},clicked:function(t){return e.updateInputValue(t)},text:function(t){return e.formatTimezone(t)}}),this.setDropdownToggle()}},{key:"formatUtcOffset",value:function(e){var t="";return e>0?t="+":e<0&&(t="-"),t+" "+Math.abs(e/3600)}},{key:"formatTimezone",value:function(e){return"[UTC "+this.formatUtcOffset(e.offset)+"] "+e.name}},{key:"initDefaultTimezone",value:function(){this.$input.val()||this.$input.val("UTC")}},{key:"setDropdownToggle",value:function(){var e=this.$input.val();this.$dropdownToggle.text(e)}},{key:"updateInputValue",value:function(e){var t=e.selectedObj;e.e.preventDefault(),this.$input.val(t.identifier),gl.pipelineScheduleFieldErrors.updateFormValidityState()}}]),e}(),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$dropdown=a()(".js-target-branch-dropdown"),this.$dropdownToggle=this.$dropdown.find(".dropdown-toggle-text"),this.$input=a()("#schedule_ref"),this.initDefaultBranch(),this.initDropdown()}return h(e,[{key:"initDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.formatBranchesList(),filterable:!0,selectable:!0,toggleLabel:function(e){return e.name},search:{fields:["name"]},clicked:function(t){return e.updateInputValue(t)},text:function(e){return e.name}}),this.setDropdownToggle()}},{key:"formatBranchesList",value:function(){return this.$dropdown.data("data").map(function(e){return{name:e}})}},{key:"setDropdownToggle",value:function(){var e=this.$input.val();this.$dropdownToggle.text(e)}},{key:"initDefaultBranch",value:function(){var e=this.$input.val(),t=this.$dropdown.data("defaultBranch");e||this.$input.val(t)}},{key:"updateInputValue",value:function(e){var t=e.selectedObj;e.e.preventDefault(),this.$input.val(t.name),gl.pipelineScheduleFieldErrors.updateFormValidityState()}}]),e}(),g=n(450);i.default.use(o.a);t.a=function(){var e,t;e=document.getElementById("interval-pattern-input"),t=e?e.dataset.initialInterval:"",new i.default({el:e,components:{intervalPatternInput:v},render:function(e){return e("interval-pattern-input",{props:{initialCronInterval:t}})}});var n=document.getElementById("new-pipeline-schedule-form");gl.timezoneDropdown=new p,gl.targetBranchDropdown=new m,gl.pipelineScheduleFieldErrors=new l.a(n),Object(g.a)({container:a()(".js-ci-variable-list-section"),formField:"schedule"})}},450:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),a=n.n(r),i=n(284);function o(e){var t=e.container,n=e.formField,r=void 0===n?"variables":n,o=a()(t),l=new i.a({container:o,formField:r});l.init(),o.closest("form").on("submit trigger-submit",function(){var e=o.find(".js-row").last();l.checkIfRowTouched(e)||e.find("input, textarea").attr("name","")})}}}]);
//# sourceMappingURL=commons~pages.projects.pipeline_schedules.create~pages.projects.pipeline_schedules.edit~pages.projec~7a8162b6.fbaf6b2f.chunk.js.map