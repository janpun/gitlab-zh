{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./vue_shared/components/content_viewer/lib/viewer_utils.js","webpack:///./ide/stores/utils.js","webpack:///./ide/stores/workers/files_decorator_worker.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","viewers","image","id","markdown","previewTitle","fileNameViewers","fileExtensionViewers","jpg","jpeg","gif","png","bmp","ico","md","decorateData","entity","projectId","branchId","type","url","path","renderError","_entity$content","content","undefined","_entity$tempFile","tempFile","_entity$active","active","_entity$opened","opened","_entity$changed","changed","_entity$parentTreeUrl","parentTreeUrl","_entity$base","base64","previewMode","file_lock","html","_entity$parentPath","parentPath","_extends","tree","loading","staged","lastCommitPath","lastCommitSha","lastCommit","message","updatedAt","author","blamePath","commitsPath","permalink","rawPath","binary","raw","editorRow","editorColumn","fileLanguage","eol","viewMode","size","lastOpenedAt","mrChange","deleted","prevPath","movedPath","moved","sortTreesByTypeAndName","a","b","self","addEventListener","e","_e$data","data","_e$data$tempFile","_e$data$content","_e$data$base","treeList","file","entries","reduce","acc","pathSplit","split","blobName","pop","trim","length","pathAcc","folderName","parentFolder","folderPath","foundEntry","push","assign","_defineProperty","fileFolder","join","viewerName","viewerInformationForPath","postMessage","sortTree","sortedTree","map","sort"],"mappings":"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","file":"files_decorator_worker.a89c3763.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/webpack/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const viewers = {\n  image: {\n    id: 'image',\n  },\n  markdown: {\n    id: 'markdown',\n    previewTitle: 'Preview Markdown',\n  },\n};\n\nconst fileNameViewers = {};\nconst fileExtensionViewers = {\n  jpg: 'image',\n  jpeg: 'image',\n  gif: 'image',\n  png: 'image',\n  bmp: 'image',\n  ico: 'image',\n  md: 'markdown',\n  markdown: 'markdown',\n};\n\nexport function viewerInformationForPath(path) {\n  if (!path) return null;\n  const name = path.split('/').pop();\n  const viewerName =\n    fileNameViewers[name] || fileExtensionViewers[name ? name.split('.').pop() : ''] || '';\n\n  return viewers[viewerName];\n}\n\nexport default viewers;\n","export const dataStructure = () => ({\n  id: '',\n  // Key will contain a mixture of ID and path\n  // it can also contain a prefix `pending-` for files opened in review mode\n  key: '',\n  type: '',\n  projectId: '',\n  branchId: '',\n  name: '',\n  url: '',\n  path: '',\n  tempFile: false,\n  tree: [],\n  loading: false,\n  opened: false,\n  active: false,\n  changed: false,\n  staged: false,\n  lastCommitPath: '',\n  lastCommitSha: '',\n  lastCommit: {\n    id: '',\n    url: '',\n    message: '',\n    updatedAt: '',\n    author: '',\n  },\n  blamePath: '',\n  commitsPath: '',\n  permalink: '',\n  rawPath: '',\n  binary: false,\n  html: '',\n  raw: '',\n  content: '',\n  parentTreeUrl: '',\n  renderError: false,\n  base64: false,\n  editorRow: 1,\n  editorColumn: 1,\n  fileLanguage: '',\n  eol: '',\n  viewMode: 'editor',\n  previewMode: null,\n  size: 0,\n  parentPath: null,\n  lastOpenedAt: 0,\n  mrChange: null,\n  deleted: false,\n  prevPath: '',\n  movedPath: '',\n  moved: false,\n});\n\nexport const decorateData = entity => {\n  const {\n    id,\n    projectId,\n    branchId,\n    type,\n    url,\n    name,\n    path,\n    renderError,\n    content = '',\n    tempFile = false,\n    active = false,\n    opened = false,\n    changed = false,\n    parentTreeUrl = '',\n    base64 = false,\n    previewMode,\n    file_lock,\n    html,\n    parentPath = '',\n  } = entity;\n\n  return {\n    ...dataStructure(),\n    id,\n    projectId,\n    branchId,\n    key: `${name}-${type}-${id}`,\n    type,\n    name,\n    url,\n    path,\n    tempFile,\n    opened,\n    active,\n    parentTreeUrl,\n    changed,\n    renderError,\n    content,\n    base64,\n    previewMode,\n    file_lock,\n    html,\n    parentPath,\n  };\n};\n\nexport const findEntry = (tree, type, name, prop = 'name') =>\n  tree.find(f => f.type === type && f[prop] === name);\n\nexport const findIndexOfFile = (state, file) => state.findIndex(f => f.path === file.path);\n\nexport const setPageTitle = title => {\n  document.title = title;\n};\n\nexport const commitActionForFile = file => {\n  if (file.prevPath) {\n    return 'move';\n  } else if (file.deleted) {\n    return 'delete';\n  } else if (file.tempFile) {\n    return 'create';\n  }\n\n  return 'update';\n};\n\nexport const getCommitFiles = stagedFiles =>\n  stagedFiles.reduce((acc, file) => {\n    if (file.moved) return acc;\n\n    return acc.concat({\n      ...file,\n    });\n  }, []);\n\nexport const createCommitPayload = ({ branch, getters, newBranch, state, rootState }) => ({\n  branch,\n  commit_message: state.commitMessage || getters.preBuiltCommitMessage,\n  actions: getCommitFiles(rootState.stagedFiles).map(f => ({\n    action: commitActionForFile(f),\n    file_path: f.path,\n    previous_path: f.prevPath === '' ? undefined : f.prevPath,\n    content: f.content || undefined,\n    encoding: f.base64 ? 'base64' : 'text',\n    last_commit_id: newBranch || f.deleted || f.prevPath ? undefined : f.lastCommitSha,\n  })),\n  start_branch: newBranch ? rootState.currentBranchId : undefined,\n});\n\nexport const createNewMergeRequestUrl = (projectUrl, source, target) =>\n  `${projectUrl}/merge_requests/new?merge_request[source_branch]=${source}&merge_request[target_branch]=${target}`;\n\nconst sortTreesByTypeAndName = (a, b) => {\n  if (a.type === 'tree' && b.type === 'blob') {\n    return -1;\n  } else if (a.type === 'blob' && b.type === 'tree') {\n    return 1;\n  }\n  if (a.name < b.name) return -1;\n  if (a.name > b.name) return 1;\n  return 0;\n};\n\nexport const sortTree = sortedTree =>\n  sortedTree\n    .map(entity =>\n      Object.assign(entity, {\n        tree: entity.tree.length ? sortTree(entity.tree) : [],\n      }),\n    )\n    .sort(sortTreesByTypeAndName);\n\nexport const filePathMatches = (filePath, path) => filePath.indexOf(`${path}/`) === 0;\n\nexport const getChangesCountForFiles = (files, path) =>\n  files.filter(f => filePathMatches(f.path, path)).length;\n","import { viewerInformationForPath } from '~/vue_shared/components/content_viewer/lib/viewer_utils';\nimport { decorateData, sortTree } from '../utils';\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('message', e => {\n  const { data, projectId, branchId, tempFile = false, content = '', base64 = false } = e.data;\n\n  const treeList = [];\n  let file;\n  let parentPath;\n  const entries = data.reduce((acc, path) => {\n    const pathSplit = path.split('/');\n    const blobName = pathSplit.pop().trim();\n\n    if (pathSplit.length > 0) {\n      pathSplit.reduce((pathAcc, folderName) => {\n        const parentFolder = acc[pathAcc[pathAcc.length - 1]];\n        const folderPath = `${parentFolder ? `${parentFolder.path}/` : ''}${folderName}`;\n        const foundEntry = acc[folderPath];\n\n        if (!foundEntry) {\n          parentPath = parentFolder ? parentFolder.path : null;\n\n          const tree = decorateData({\n            projectId,\n            branchId,\n            id: folderPath,\n            name: folderName,\n            path: folderPath,\n            url: `/${projectId}/tree/${branchId}/-/${folderPath}/`,\n            type: 'tree',\n            parentTreeUrl: parentFolder ? parentFolder.url : `/${projectId}/tree/${branchId}/`,\n            tempFile,\n            changed: tempFile,\n            opened: tempFile,\n            parentPath,\n          });\n\n          Object.assign(acc, {\n            [folderPath]: tree,\n          });\n\n          if (parentFolder) {\n            parentFolder.tree.push(tree);\n          } else {\n            treeList.push(tree);\n          }\n\n          pathAcc.push(tree.path);\n        } else {\n          pathAcc.push(foundEntry.path);\n        }\n\n        return pathAcc;\n      }, []);\n    }\n\n    if (blobName !== '') {\n      const fileFolder = acc[pathSplit.join('/')];\n      parentPath = fileFolder ? fileFolder.path : null;\n\n      file = decorateData({\n        projectId,\n        branchId,\n        id: path,\n        name: blobName,\n        path,\n        url: `/${projectId}/blob/${branchId}/-/${path}`,\n        type: 'blob',\n        parentTreeUrl: fileFolder ? fileFolder.url : `/${projectId}/blob/${branchId}`,\n        tempFile,\n        changed: tempFile,\n        content,\n        base64,\n        previewMode: viewerInformationForPath(blobName),\n        parentPath,\n      });\n\n      Object.assign(acc, {\n        [path]: file,\n      });\n\n      if (fileFolder) {\n        fileFolder.tree.push(file);\n      } else {\n        treeList.push(file);\n      }\n    }\n\n    return acc;\n  }, {});\n\n  // eslint-disable-next-line no-restricted-globals\n  self.postMessage({\n    entries,\n    treeList: sortTree(treeList),\n    file,\n    parentPath,\n  });\n});\n"],"sourceRoot":""}