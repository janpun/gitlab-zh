(this.webpackJsonp=this.webpackJsonp||[]).push([[197],{1223:function(e,t,n){"use strict";n.r(t);var i=n(150),a=n(463);document.addEventListener("DOMContentLoaded",function(){Object(i.a)();var e=document.querySelector(".js-ci-variable-list-section");new a.a({container:e,saveButton:e.querySelector(".js-secret-variables-save-button"),errorBox:e.querySelector(".js-ci-variable-error-box"),saveEndpoint:e.dataset.saveEndpoint})})},1224:function(e,t,n){n(31),e.exports=n(1223)},150:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(0),a=n.n(i);function o(e){e.find(".js-settings-toggle").text("Collapse"),e.find(".settings-content").off("scroll.expandSection").scrollTop(0),e.addClass("expanded"),e.hasClass("no-animate")||e.addClass("animating").one("animationend.animateSection",function(){return e.removeClass("animating")})}function r(e){e.removeClass("no-animate"),e.hasClass("expanded")?function(e){e.find(".js-settings-toggle").text("Expand"),e.find(".settings-content").on("scroll.expandSection",function(){return o(e)}),e.removeClass("expanded"),e.hasClass("no-animate")||e.addClass("animating").one("animationend.animateSection",function(){return e.removeClass("animating")})}(e):o(e)}function s(){if(a()(".settings").each(function(e,t){var n=a()(t);n.on("click.toggleSection",".js-settings-toggle",function(){return r(n)}),n.hasClass("expanded")||n.find(".settings-content").on("scroll.expandSection",function(){n.removeClass("no-animate"),o(n)})}),window.location.hash){var e=a()(window.location.hash);e.length&&e.hasClass("settings")&&o(e)}}},167:function(e,t,n){"use strict";var i=n(3),a=n.n(i),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultToggleLabel=t.defaultToggleLabel,this.fieldName=t.fieldName,this.onSelect=t.onSelect||function(){},this.getDataOption=t.getData,this.getDataRemote=!!t.filterRemote,this.createNewItemFromValueOption=t.createNewItemFromValue,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$createButton=this.$dropdownContainer.find(".js-dropdown-create-new-item"),this.buildDropdown(),this.bindEvents(),this.toggleFooter(!0)}return o(e,[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getData.bind(this),filterable:!0,filterRemote:this.getDataRemote,search:{fields:["text"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?a.a.escape(e.title):this.defaultToggleLabel},fieldName:this.fieldName,text:function(e){return a.a.escape(e.text)},id:function(e){return a.a.escape(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t){t.e.preventDefault(),e.onSelect()}})}},{key:"clearDropdown",value:function(){this.$dropdownContainer.find(".dropdown-content").html(""),this.$dropdownContainer.find(".dropdown-input-field").val("")}},{key:"bindEvents",value:function(){this.$createButton.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(e){e.preventDefault(),this.refreshData(),this.$dropdown.data("glDropdown").selectRowAtIndex()}},{key:"refreshData",value:function(){this.$dropdown.data("glDropdown").remote.execute()}},{key:"getData",value:function(e,t){var n=this;this.getDataOption(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=e;n.selectedItem&&e.some(function(e){return e.id===n.selectedItem.id})||(i=e.concat(n.selectedItem||[])),t(i)})}},{key:"createNewItemFromValue",value:function(e){return this.createNewItemFromValueOption?this.createNewItemFromValueOption(e):{title:e,id:e,text:e}}},{key:"toggleCreateNewButton",value:function(e){e&&(this.selectedItem=this.createNewItemFromValue(e),this.$dropdownContainer.find(".js-dropdown-create-new-item code").text(e)),this.toggleFooter(!e)}},{key:"toggleFooter",value:function(e){this.$dropdownFooter.toggleClass("hidden",e)}}]),e}();t.a=r},199:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(0),a=n.n(i),o=n(7),r=n(1),s=n(11);function l(e,t){e.classList.toggle("is-checked",t)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.querySelectorAll(".js-project-feature-toggle").forEach(function(e){var n=e.querySelector(".js-project-feature-toggle-input");l(e,Object(s.g)(n.value)),e.addEventListener("click",function(e,t,n){var i=Object(s.g)(t.value);l(e,!i),e.setAttribute("disabled",!0),e.classList.toggle("is-loading",!0),Promise.resolve(n(!i,e)).then(function(){t.setAttribute("value",!i)}).catch(function(){l(e,i)}).then(function(){e.removeAttribute("disabled"),e.classList.toggle("is-loading",!1),a()(t).trigger("trigger-change")}).catch(function(){Object(o.a)(Object(r.a)("Something went wrong when toggling the button"))})}.bind(null,e,n,t))})}},246:function(e,t,n){"use strict";var i=n(1),a=n(11),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(t){var n=t.container,i=t.valueSelector,a=void 0===i?".js-secret-value":i,o=t.placeholderSelector,r=void 0===o?".js-secret-value-placeholder":o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.valueSelector=a,this.placeholderSelector=r}return o(e,[{key:"init",value:function(){if(this.revealButton=this.container.querySelector(".js-secret-value-reveal-button"),this.revealButton){var e=Object(a.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(e),this.revealButton.addEventListener("click",this.onRevealButtonClicked.bind(this))}}},{key:"onRevealButtonClicked",value:function(){var e=Object(a.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(!e)}},{key:"updateDom",value:function(e){var t=this.container.querySelectorAll(this.valueSelector);t.forEach(function(t){t.classList.toggle("hide",!e)}),this.container.querySelectorAll(this.placeholderSelector).forEach(function(t){t.classList.toggle("hide",e)}),this.revealButton.textContent=e?Object(i.d)("Hide value","Hide values",t.length):Object(i.d)("Reveal value","Reveal values",t.length),this.revealButton.dataset.secretRevealStatus=e}}]),e}();t.a=r},284:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(11),r=n(1),s=n(199),l=n(167),c=n(246),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var v=Object(r.e)("CiVariable|All environments");function f(e){return{title:"*"===e?v:e,id:e,text:"*"===e?Object(r.e)("CiVariable|* (All environments)"):e}}var h=function(){function e(t){var n=t.container,i=t.formField;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=a()(n),this.formField=i,this.environmentDropdownMap=new WeakMap,this.inputMap={id:{selector:".js-ci-variable-input-id",default:""},key:{selector:".js-ci-variable-input-key",default:""},secret_value:{selector:".js-ci-variable-input-value",default:""},protected:{selector:".js-ci-variable-input-protected",default:"false"},environment_scope:{selector:'input[name="'+this.formField+'[variables_attributes][][environment_scope]"]',default:"*"},_destroy:{selector:".js-ci-variable-input-destroy",default:""}},this.secretValues=new c.a({container:this.$container[0],valueSelector:".js-row:not(:last-child) .js-secret-value",placeholderSelector:".js-row:not(:last-child) .js-secret-value-placeholder"})}return d(e,[{key:"init",value:function(){this.bindEvents(),this.secretValues.init()}},{key:"bindEvents",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){e.initRow(n)}),this.$container.on("click",".js-row-remove-button",function(t){t.preventDefault(),e.removeRow(a()(t.currentTarget).closest(".js-row"))});var t=Object.keys(this.inputMap).map(function(t){return e.inputMap[t].selector}).join(",");this.$container.on("blur",t,function(t){var n=a()(t.currentTarget).closest(".js-row");n.is(":not(:last-child)")&&!e.checkIfRowTouched(n)&&e.removeRow(n)}),this.$container.on("input trigger-change",t,function(){var t=e.$container.find(".js-row").last();e.checkIfRowTouched(t)&&e.insertRow(t)})}},{key:"initRow",value:function(e){var t=this,n=a()(e);Object(s.a)(n[0]),n.find(this.inputMap.secret_value.selector).css("height","");var i=n.find(".js-variable-environment-toggle");if(i.length){var o=new l.a({$dropdown:i,defaultToggleLabel:v,fieldName:this.formField+"[variables_attributes][][environment_scope]",getData:function(e,n){return n(t.getEnvironmentValues())},createNewItemFromValue:f,onSelect:function(){t.refreshDropdownData(),n.find(t.inputMap.environment_scope.selector).trigger("trigger-change")}});o.clearDropdown(),this.environmentDropdownMap.set(n[0],o)}}},{key:"insertRow",value:function(e){var t=this,n=e.clone();n.removeAttr("data-is-persisted"),Object.keys(this.inputMap).forEach(function(e){var i=t.inputMap[e];n.find(i.selector).val(i.default)}),n.find(".dropdown-menu.show").each(function(e,t){t.classList.remove("show")}),this.initRow(n),e.after(n)}},{key:"removeRow",value:function(e){var t=a()(e);Object(o.g)(t.attr("data-is-persisted"))?(t.hide(),t.find(this.inputMap._destroy.selector).val(!0)):t.remove(),this.refreshDropdownData()}},{key:"checkIfRowTouched",value:function(e){var t=this;return Object.keys(this.inputMap).some(function(n){var i=t.inputMap[n],a=e.find(i.selector);return a.length&&a.val()!==i.default})}},{key:"toggleEnableRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$container.find(this.inputMap.key.selector).attr("disabled",!e),this.$container.find(".js-row-remove-button").attr("disabled",!e)}},{key:"hideValues",value:function(){this.secretValues.updateDom(!1)}},{key:"getAllData",value:function(){var e=this;return this.$container.find(".js-row").toArray().slice(0,-1).map(function(t){var n={};return Object.keys(e.inputMap).forEach(function(i){var o=e.inputMap[i],r=a()(t).find(o.selector);r.length&&(n[i]=r.val())}),n})}},{key:"getEnvironmentValues",value:function(){var e=this.$container.find(this.inputMap.environment_scope.selector).toArray().reduce(function(e,t){return u({},e,(n={},i=t.value,a=t.value,i in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a,n));var n,i,a},{});return Object.keys(e).map(f)}},{key:"refreshDropdownData",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){var i=e.environmentDropdownMap.get(n);i&&i.refreshData()})}}]),e}();t.a=h},463:function(e,t,n){"use strict";var i=n(3),a=n.n(i),o=n(5),r=n(1),s=n(7),l=n(11),c=n(78),u=n(284),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var f=function(){function e(t){var n=t.container,i=t.saveButton,a=t.errorBox,o=t.formField,r=void 0===o?"variables":o,s=t.saveEndpoint;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.saveButton=i,this.errorBox=a,this.saveEndpoint=s,this.variableList=new u.a({container:this.container,formField:r}),this.bindEvents(),this.variableList.init()}return v(e,[{key:"bindEvents",value:function(){this.saveButton.addEventListener("click",this.onSaveClicked.bind(this))}},{key:"onSaveClicked",value:function(){var e=this,t=this.saveButton.querySelector(".js-secret-variables-save-loading-icon");return t.classList.toggle("hide",!1),this.errorBox.classList.toggle("hide",!0),this.variableList.toggleEnableRow(!1),o.a.patch(this.saveEndpoint,{variables_attributes:this.variableList.getAllData()},{validateStatus:function(e){return e>=c.a.OK&&e<c.a.MULTIPLE_CHOICES||e===c.a.BAD_REQUEST}}).then(function(n){var i,o;t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),n.status===c.a.OK&&n.data?(e.updateRowsWithPersistedVariables(n.data.variables),e.variableList.hideValues()):n.status===c.a.BAD_REQUEST&&(e.errorBox.innerHTML=(i=n.data,o=[].concat(i).map(function(e){return"\n    <li>\n      "+a.a.escape(e)+"\n    </li>\n  "}),"\n    <p>\n      "+Object(r.e)("CiVariable|Validation failed")+"\n    </p>\n    <ul>\n      "+o.join("")+"\n    </ul>\n  "),e.errorBox.classList.toggle("hide",!1))}).catch(function(){t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),Object(s.a)(Object(r.e)("CiVariable|Error occured while saving variables"))})}},{key:"updateRowsWithPersistedVariables",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[].concat(e).reduce(function(e,t){return d({},e,(n={},i=t.key,a=t,i in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a,n));var n,i,a},{});this.container.querySelectorAll(".js-row").forEach(function(e){var n=e.querySelector(".js-ci-variable-input-destroy");if(Object(l.g)(n.value))e.remove();else{var i=e.querySelector(".js-ci-variable-input-key").value,a=t[i];a&&(e.querySelector(".js-ci-variable-input-id").value=a.id,e.setAttribute("data-is-persisted","true"))}})}}]),e}();t.a=f},78:function(e,t,n){"use strict";n.d(t,"b",function(){return a});var i={ABORTED:0,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTI_STATUS:207,ALREADY_REPORTED:208,IM_USED:226,MULTIPLE_CHOICES:300,BAD_REQUEST:400,NOT_FOUND:404},a=[i.OK,i.CREATED,i.ACCEPTED,i.NON_AUTHORITATIVE_INFORMATION,i.NO_CONTENT,i.RESET_CONTENT,i.PARTIAL_CONTENT,i.MULTI_STATUS,i.ALREADY_REPORTED,i.IM_USED];t.a=i}},[[1224,0,1]]]);
//# sourceMappingURL=pages.groups.settings.ci_cd.show.b488c367.chunk.js.map