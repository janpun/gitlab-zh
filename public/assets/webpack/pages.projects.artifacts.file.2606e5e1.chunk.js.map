{"version":3,"sources":["webpack:///./pages/projects/artifacts/file/index.js","webpack:///./blob/viewer/index.js"],"names":["document","addEventListener","_shortcuts_navigation__WEBPACK_IMPORTED_MODULE_1__","_blob_viewer_index__WEBPACK_IMPORTED_MODULE_0__","BlobViewer","_classCallCheck","this","initAuxiliaryViewer","initRichViewer","initMainViewers","$fileHolder","jquery__WEBPACK_IMPORTED_MODULE_0___default","length","switcher","querySelector","switcherBtns","querySelectorAll","copySourceBtn","simpleViewer","richViewer","initBindings","switchToInitialViewer","initialViewerName","getAttribute","window","location","hash","indexOf","switchToViewer","_this","Array","from","forEach","el","switchViewHandler","bind","classList","contains","blur","e","target","currentTarget","preventDefault","setAttribute","remove","activeViewer","add","tooltip","name","_this2","newViewer","oldButton","newButton","oldViewer","toggleCopyButtonState","loadViewer","then","viewer","renderGFM","trigger","Object","_lib_utils_common_utils__WEBPACK_IMPORTED_MODULE_2__","catch","_flash__WEBPACK_IMPORTED_MODULE_1__","auxiliaryViewer","dataset","richType","initViewer","promise","module","default","error","Promise","all","__webpack_require__","viewerParam","url","resolve","_lib_utils_axios_utils__WEBPACK_IMPORTED_MODULE_3__","get","_ref","data","innerHTML","html"],"mappings":"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","file":"pages.projects.artifacts.file.2606e5e1.chunk.js","sourcesContent":["import BlobViewer from '~/blob/viewer/index';\nimport ShortcutsNavigation from '~/shortcuts_navigation';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  new ShortcutsNavigation(); // eslint-disable-line no-new\n  new BlobViewer(); // eslint-disable-line no-new\n});\n","import $ from 'jquery';\nimport Flash from '../../flash';\nimport { handleLocationHash } from '../../lib/utils/common_utils';\nimport axios from '../../lib/utils/axios_utils';\n\nexport default class BlobViewer {\n  constructor() {\n    BlobViewer.initAuxiliaryViewer();\n    BlobViewer.initRichViewer();\n\n    this.initMainViewers();\n  }\n\n  static initAuxiliaryViewer() {\n    const auxiliaryViewer = document.querySelector('.blob-viewer[data-type=\"auxiliary\"]');\n    if (!auxiliaryViewer) return;\n\n    BlobViewer.loadViewer(auxiliaryViewer);\n  }\n\n  static initRichViewer() {\n    const viewer = document.querySelector('.blob-viewer[data-type=\"rich\"]');\n    if (!viewer || !viewer.dataset.richType) return;\n\n    const initViewer = promise => promise\n      .then(module => module.default(viewer))\n      .catch((error) => {\n        Flash('Error loading file viewer.');\n        throw error;\n      });\n\n    switch (viewer.dataset.richType) {\n      case 'balsamiq':\n        initViewer(import(/* webpackChunkName: 'balsamiq_viewer' */ '../balsamiq_viewer'));\n        break;\n      case 'notebook':\n        initViewer(import(/* webpackChunkName: 'notebook_viewer' */ '../notebook_viewer'));\n        break;\n      case 'pdf':\n        initViewer(import(/* webpackChunkName: 'pdf_viewer' */ '../pdf_viewer'));\n        break;\n      case 'sketch':\n        initViewer(import(/* webpackChunkName: 'sketch_viewer' */ '../sketch_viewer'));\n        break;\n      case 'stl':\n        initViewer(import(/* webpackChunkName: 'stl_viewer' */ '../stl_viewer'));\n        break;\n      default:\n        break;\n    }\n  }\n\n  initMainViewers() {\n    this.$fileHolder = $('.file-holder');\n    if (!this.$fileHolder.length) return;\n\n    this.switcher = document.querySelector('.js-blob-viewer-switcher');\n    this.switcherBtns = document.querySelectorAll('.js-blob-viewer-switch-btn');\n    this.copySourceBtn = document.querySelector('.js-copy-blob-source-btn');\n\n    this.simpleViewer = this.$fileHolder[0].querySelector('.blob-viewer[data-type=\"simple\"]');\n    this.richViewer = this.$fileHolder[0].querySelector('.blob-viewer[data-type=\"rich\"]');\n\n    this.initBindings();\n\n    this.switchToInitialViewer();\n  }\n\n  switchToInitialViewer() {\n    const initialViewer = this.$fileHolder[0].querySelector('.blob-viewer:not(.hidden)');\n    let initialViewerName = initialViewer.getAttribute('data-type');\n\n    if (this.switcher && window.location.hash.indexOf('#L') === 0) {\n      initialViewerName = 'simple';\n    }\n\n    this.switchToViewer(initialViewerName);\n  }\n\n  initBindings() {\n    if (this.switcherBtns.length) {\n      Array.from(this.switcherBtns)\n        .forEach((el) => {\n          el.addEventListener('click', this.switchViewHandler.bind(this));\n        });\n    }\n\n    if (this.copySourceBtn) {\n      this.copySourceBtn.addEventListener('click', () => {\n        if (this.copySourceBtn.classList.contains('disabled')) return this.copySourceBtn.blur();\n\n        return this.switchToViewer('simple');\n      });\n    }\n  }\n\n  switchViewHandler(e) {\n    const target = e.currentTarget;\n\n    e.preventDefault();\n\n    this.switchToViewer(target.getAttribute('data-viewer'));\n  }\n\n  toggleCopyButtonState() {\n    if (!this.copySourceBtn) return;\n\n    if (this.simpleViewer.getAttribute('data-loaded')) {\n      this.copySourceBtn.setAttribute('title', 'Copy source to clipboard');\n      this.copySourceBtn.classList.remove('disabled');\n    } else if (this.activeViewer === this.simpleViewer) {\n      this.copySourceBtn.setAttribute('title', 'Wait for the source to load to copy it to the clipboard');\n      this.copySourceBtn.classList.add('disabled');\n    } else {\n      this.copySourceBtn.setAttribute('title', 'Switch to the source to copy it to the clipboard');\n      this.copySourceBtn.classList.add('disabled');\n    }\n\n    $(this.copySourceBtn).tooltip('_fixTitle');\n  }\n\n  switchToViewer(name) {\n    const newViewer = this.$fileHolder[0].querySelector(`.blob-viewer[data-type='${name}']`);\n    if (this.activeViewer === newViewer) return;\n\n    const oldButton = document.querySelector('.js-blob-viewer-switch-btn.active');\n    const newButton = document.querySelector(`.js-blob-viewer-switch-btn[data-viewer='${name}']`);\n    const oldViewer = this.$fileHolder[0].querySelector(`.blob-viewer:not([data-type='${name}'])`);\n\n    if (oldButton) {\n      oldButton.classList.remove('active');\n    }\n\n    if (newButton) {\n      newButton.classList.add('active');\n      newButton.blur();\n    }\n\n    if (oldViewer) {\n      oldViewer.classList.add('hidden');\n    }\n\n    newViewer.classList.remove('hidden');\n\n    this.activeViewer = newViewer;\n\n    this.toggleCopyButtonState();\n\n    BlobViewer.loadViewer(newViewer)\n    .then((viewer) => {\n      $(viewer).renderGFM();\n\n      this.$fileHolder.trigger('highlight:line');\n      handleLocationHash();\n\n      this.toggleCopyButtonState();\n    })\n    .catch(() => new Flash('Error loading viewer'));\n  }\n\n  static loadViewer(viewerParam) {\n    const viewer = viewerParam;\n    const url = viewer.getAttribute('data-url');\n\n    if (!url || viewer.getAttribute('data-loaded') || viewer.getAttribute('data-loading')) {\n      return Promise.resolve(viewer);\n    }\n\n    viewer.setAttribute('data-loading', 'true');\n\n    return axios.get(url)\n      .then(({ data }) => {\n        viewer.innerHTML = data.html;\n        viewer.setAttribute('data-loaded', 'true');\n\n        return viewer;\n      });\n  }\n}\n"],"sourceRoot":""}