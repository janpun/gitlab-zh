(this.webpackJsonp=this.webpackJsonp||[]).push([[107],{861:function(t,e,i){"use strict";i.r(e);var n=i(0),s=i.n(n),r=i(5),a=i(7),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$form=s()(e),this.canTestService=this.$form.data("canTest"),this.testEndPoint=this.$form.data("testUrl"),this.$serviceToggle=this.$form.find("#service_active"),this.$submitBtn=this.$form.find('button[type="submit"]'),this.$submitBtnLoader=this.$submitBtn.find(".js-btn-spinner"),this.$submitBtnLabel=this.$submitBtn.find(".js-btn-label")}return o(t,[{key:"init",value:function(){var t=this;this.toggleServiceState(this.$serviceToggle.is(":checked")),this.$serviceToggle.on("change",function(e){return t.handleServiceToggle(e)}),this.$submitBtn.on("click",function(e){return t.handleSettingsSave(e)})}},{key:"handleSettingsSave",value:function(t){this.$serviceToggle.is(":checked")&&this.$form.get(0).checkValidity()&&this.canTestService&&(t.preventDefault(),this.testSettings(this.$form.serialize()))}},{key:"handleServiceToggle",value:function(t){this.toggleServiceState(s()(t.currentTarget).is(":checked"))}},{key:"toggleServiceState",value:function(t){this.toggleSubmitBtnLabel(t),t?this.$form.removeAttr("novalidate"):this.$form.attr("novalidate")||this.$form.attr("novalidate","novalidate")}},{key:"toggleSubmitBtnLabel",value:function(t){var e="Save changes";t&&this.canTestService&&(e="Test settings and save changes"),this.$submitBtnLabel.text(e)}},{key:"toggleSubmitBtnState",value:function(t){t?(this.$submitBtn.disable(),this.$submitBtnLoader.removeClass("hidden")):(this.$submitBtn.enable(),this.$submitBtnLoader.addClass("hidden"))}},{key:"testSettings",value:function(t){var e=this;return this.toggleSubmitBtnState(!0),r.a.put(this.testEndPoint,t).then(function(t){var i=t.data;if(i.error){var n=void 0;i.test_failed&&(n={title:"Save anyway",clickHandler:function(t){t.preventDefault(),e.$form.submit()}}),Object(a.a)(i.message+" "+i.service_response,"alert",document,n)}else e.$form.submit();e.toggleSubmitBtnState(!1)}).catch(function(){Object(a.a)("Something went wrong on our end."),e.toggleSubmitBtnState(!1)})}}]),t}(),d=i(3),h=i.n(d),l=i(1),u="empty",m="loading",f="list",g=i(11),v=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var p=function(){function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backOffRequestCounter=0,this.$wrapper=s()(e),this.$monitoredMetricsPanel=this.$wrapper.find(".js-panel-monitored-metrics"),this.$monitoredMetricsCount=this.$monitoredMetricsPanel.find(".js-monitored-count"),this.$monitoredMetricsLoading=this.$monitoredMetricsPanel.find(".js-loading-metrics"),this.$monitoredMetricsEmpty=this.$monitoredMetricsPanel.find(".js-empty-metrics"),this.$monitoredMetricsList=this.$monitoredMetricsPanel.find(".js-metrics-list"),this.$missingEnvVarPanel=this.$wrapper.find(".js-panel-missing-env-vars"),this.$panelToggle=this.$missingEnvVarPanel.find(".js-panel-toggle"),this.$missingEnvVarMetricCount=this.$missingEnvVarPanel.find(".js-env-var-count"),this.$missingEnvVarMetricsList=this.$missingEnvVarPanel.find(".js-missing-var-metrics-list"),this.activeMetricsEndpoint=this.$monitoredMetricsPanel.data("activeMetrics"),this.helpMetricsPath=this.$monitoredMetricsPanel.data("metrics-help-path"),this.$panelToggle.on("click",function(t){return i.handlePanelToggle(t)})}return v(t,[{key:"handlePanelToggle",value:function(t){var e=s()(t.currentTarget);e.closest(".card").find(".card-body").toggleClass("hidden"),e.hasClass("fa-caret-down")?e.removeClass("fa-caret-down").addClass("fa-caret-right"):e.removeClass("fa-caret-right").addClass("fa-caret-down")}},{key:"showMonitoringMetricsPanelState",value:function(t){switch(t){case m:this.$monitoredMetricsLoading.removeClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.addClass("hidden");break;case f:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.removeClass("hidden");break;default:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.removeClass("hidden"),this.$monitoredMetricsList.addClass("hidden")}}},{key:"populateActiveMetrics",value:function(t){var e=this,i=0,n=0,s=0;if(t.forEach(function(t){t.active_metrics>0&&(s+=1,e.$monitoredMetricsList.append("<li>"+h.a.escape(t.group)+'<span class="badge">'+h.a.escape(t.active_metrics)+"</span></li>"),i+=t.active_metrics,t.metrics_missing_requirements>0&&(e.$missingEnvVarMetricsList.append("<li>"+h.a.escape(t.group)+"</li>"),n+=1))}),0===i){var r=Object(l.f)(Object(l.e)('PrometheusService|<p class="text-tertiary">No <a href="%{docsUrl}">common metrics</a> were found</p>'),{docsUrl:this.helpMetricsPath},!1);this.$monitoredMetricsEmpty.empty(),this.$monitoredMetricsEmpty.append(r),this.showMonitoringMetricsPanelState(u)}else{var a=Object(l.f)(Object(l.e)("PrometheusService|%{exporters} with %{metrics} were found"),{exporters:Object(l.d)("%d exporter","%d exporters",s),metrics:Object(l.d)("%d metric","%d metrics",i)});this.$monitoredMetricsCount.text(a),this.showMonitoringMetricsPanelState(f),n>0&&(this.$missingEnvVarPanel.removeClass("hidden"),this.$missingEnvVarMetricCount.text(n))}}},{key:"loadActiveMetrics",value:function(){var t=this;this.showMonitoringMetricsPanelState(m),Object(g.c)(function(e,i){r.a.get(t.activeMetricsEndpoint).then(function(n){var s=n.data;s&&s.success?i(s):(t.backOffRequestCounter+=1,t.backOffRequestCounter<3?e():i(s))}).catch(i)}).then(function(e){e&&e.data&&e.data.length?t.populateActiveMetrics(e.data):t.showMonitoringMetricsPanelState(u)}).catch(function(){t.showMonitoringMetricsPanelState(u)})}}]),t}();document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".js-prometheus-metrics-monitoring");(new c(".js-integration-settings-form").init(),t)&&new p(".js-prometheus-metrics-monitoring").loadActiveMetrics()})},919:function(t,e,i){i(31),i(57),t.exports=i(861)}},[[919,0,1,2]]]);
//# sourceMappingURL=pages.projects.services.edit.35aeb2e1.chunk.js.map