{"version":3,"sources":["webpack:///./pager.js","webpack:///./gpg_badges.js","webpack:///./commits.js","webpack:///./pages/projects/commits/show/index.js"],"names":["__webpack_exports__","init","limit","arguments","length","undefined","preload","disable","prepareData","jquery__WEBPACK_IMPORTED_MODULE_0___default","a","noop","callback","this","url","data","Object","_lib_utils_url_utility__WEBPACK_IMPORTED_MODULE_3__","offset","parseInt","_lib_utils_common_utils__WEBPACK_IMPORTED_MODULE_1__","loading","first","getOld","initLoadMore","_this","show","_lib_utils_axios_utils__WEBPACK_IMPORTED_MODULE_2__","get","params","then","_ref","append","count","html","isScrollable","hide","catch","$w","window","document","height","scrollTop","_this2","off","endlessScroll","bottomPixels","fireDelay","fireOnce","ceaseFire","is","GpgBadges","tag","Promise","resolve","badges","displayError","_flash__WEBPACK_IMPORTED_MODULE_3__","_locale__WEBPACK_IMPORTED_MODULE_4__","endpoint","reject","Error","serialize","signatures","forEach","signature","filter","commit_sha","replaceWith","CommitsList","_classCallCheck","timer","$contentList","jquery_default","pager","processCommits","bind","content","searchField","lastSearch","val","initSearch","on","clearTimeout","setTimeout","filterResults","form","search","commitsUrl","attr","fadeTo","serializeArray","reduce","acc","obj","assign","_defineProperty","name","value","axios_utils","history","replaceState","page","title","processedData","$processedData","$commitsHeadersLast","find","last","lastShownDay","loadedShownDayFirst","commitsCount","nextUntil","not","Number","text","text_utility","datetime_utility","addEventListener","commits","querySelector","dataset","commitsLimit","shortcuts_navigation","gpg_badges","fetch"],"mappings":"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","file":"pages.projects.commits.show.9e1279f6.chunk.js","sourcesContent":["import $ from 'jquery';\nimport { getParameterByName } from '~/lib/utils/common_utils';\nimport axios from './lib/utils/axios_utils';\nimport { removeParams } from './lib/utils/url_utility';\n\nconst ENDLESS_SCROLL_BOTTOM_PX = 400;\nconst ENDLESS_SCROLL_FIRE_DELAY_MS = 1000;\n\nexport default {\n  init(limit = 0, preload = false, disable = false, prepareData = $.noop, callback = $.noop) {\n    this.url = $('.content_list').data('href') || removeParams(['limit', 'offset']);\n    this.limit = limit;\n    this.offset = parseInt(getParameterByName('offset'), 10) || this.limit;\n    this.disable = disable;\n    this.prepareData = prepareData;\n    this.callback = callback;\n    this.loading = $('.loading').first();\n    if (preload) {\n      this.offset = 0;\n      this.getOld();\n    }\n    this.initLoadMore();\n  },\n\n  getOld() {\n    this.loading.show();\n    axios.get(this.url, {\n      params: {\n        limit: this.limit,\n        offset: this.offset,\n      },\n    }).then(({ data }) => {\n      this.append(data.count, this.prepareData(data.html));\n      this.callback();\n\n      // keep loading until we've filled the viewport height\n      if (!this.disable && !this.isScrollable()) {\n        this.getOld();\n      } else {\n        this.loading.hide();\n      }\n    }).catch(() => this.loading.hide());\n  },\n\n  append(count, html) {\n    $('.content_list').append(html);\n    if (count > 0) {\n      this.offset += count;\n    } else {\n      this.disable = true;\n    }\n  },\n\n  isScrollable() {\n    const $w = $(window);\n    return $(document).height() > $w.height() + $w.scrollTop() + ENDLESS_SCROLL_BOTTOM_PX;\n  },\n\n  initLoadMore() {\n    $(document).off('scroll');\n    $(document).endlessScroll({\n      bottomPixels: ENDLESS_SCROLL_BOTTOM_PX,\n      fireDelay: ENDLESS_SCROLL_FIRE_DELAY_MS,\n      fireOnce: true,\n      ceaseFire: () => this.disable === true,\n      callback: () => {\n        if (!this.loading.is(':visible')) {\n          this.loading.show();\n          this.getOld();\n        }\n      },\n    });\n  },\n};\n","import $ from 'jquery';\nimport { parseQueryStringIntoObject } from '~/lib/utils/common_utils';\nimport axios from '~/lib/utils/axios_utils';\nimport createFlash from '~/flash';\nimport { __ } from '~/locale';\n\nexport default class GpgBadges {\n  static fetch() {\n    const tag = $('.js-signature-container');\n    if (tag.length === 0) {\n      return Promise.resolve();\n    }\n\n    const badges = $('.js-loading-gpg-badge');\n\n    badges.html('<i class=\"fa fa-spinner fa-spin\"></i>');\n\n    const displayError = () => createFlash(__('An error occurred while loading commit signatures'));\n\n    const endpoint = tag.data('signaturesPath');\n    if (!endpoint) {\n      displayError();\n      return Promise.reject(new Error('Missing commit signatures endpoint!'));\n    }\n\n    const params = parseQueryStringIntoObject(tag.serialize());\n    return axios\n      .get(endpoint, { params })\n      .then(({ data }) => {\n        data.signatures.forEach(signature => {\n          badges.filter(`[data-commit-sha=\"${signature.commit_sha}\"]`).replaceWith(signature.html);\n        });\n      })\n      .catch(displayError);\n  }\n}\n","import $ from 'jquery';\nimport { pluralize } from './lib/utils/text_utility';\nimport { localTimeAgo } from './lib/utils/datetime_utility';\nimport Pager from './pager';\nimport axios from './lib/utils/axios_utils';\n\nexport default class CommitsList {\n  constructor(limit = 0) {\n    this.timer = null;\n\n    this.$contentList = $('.content_list');\n\n    Pager.init(parseInt(limit, 10), false, false, this.processCommits.bind(this));\n\n    this.content = $('#commits-list');\n    this.searchField = $('#commits-search');\n    this.lastSearch = this.searchField.val();\n    this.initSearch();\n  }\n\n  initSearch() {\n    this.timer = null;\n    this.searchField.on('keyup', () => {\n      clearTimeout(this.timer);\n      this.timer = setTimeout(this.filterResults.bind(this), 500);\n    });\n  }\n\n  filterResults() {\n    const form = $('.commits-search-form');\n    const search = this.searchField.val();\n    if (search === this.lastSearch) return Promise.resolve();\n    const commitsUrl = `${form.attr('action')}?${form.serialize()}`;\n    this.content.fadeTo('fast', 0.5);\n    const params = form.serializeArray().reduce((acc, obj) => Object.assign(acc, {\n      [obj.name]: obj.value,\n    }), {});\n\n    return axios.get(form.attr('action'), {\n      params,\n    })\n      .then(({ data }) => {\n        this.lastSearch = search;\n        this.content.html(data.html);\n        this.content.fadeTo('fast', 1.0);\n\n        // Change url so if user reload a page - search results are saved\n        window.history.replaceState({\n          page: commitsUrl,\n        }, document.title, commitsUrl);\n      })\n      .catch(() => {\n        this.content.fadeTo('fast', 1.0);\n        this.lastSearch = null;\n      });\n  }\n\n  // Prepare loaded data.\n  processCommits(data) {\n    let processedData = data;\n    const $processedData = $(processedData);\n    const $commitsHeadersLast = this.$contentList.find('li.js-commit-header').last();\n    const lastShownDay = $commitsHeadersLast.data('day');\n    const $loadedCommitsHeadersFirst = $processedData.filter('li.js-commit-header').first();\n    const loadedShownDayFirst = $loadedCommitsHeadersFirst.data('day');\n    let commitsCount;\n\n    // If commits headers show the same date,\n    // remove the last header and change the previous one.\n    if (lastShownDay === loadedShownDayFirst) {\n      // Last shown commits count under the last commits header.\n      commitsCount = $commitsHeadersLast.nextUntil('li.js-commit-header').find('li.commit').length;\n\n      // Remove duplicate of commits header.\n      processedData = $processedData.not(`li.js-commit-header[data-day='${loadedShownDayFirst}']`);\n\n      // Update commits count in the previous commits header.\n      commitsCount += Number($(processedData).nextUntil('li.js-commit-header').first().find('li.commit').length);\n      $commitsHeadersLast.find('span.commits-count').text(`${commitsCount} ${pluralize('commit', commitsCount)}`);\n    }\n\n    localTimeAgo($processedData.find('.js-timeago'));\n\n    return processedData;\n  }\n}\n","import CommitsList from '~/commits';\nimport GpgBadges from '~/gpg_badges';\nimport ShortcutsNavigation from '~/shortcuts_navigation';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  new CommitsList(document.querySelector('.js-project-commits-show').dataset.commitsLimit); // eslint-disable-line no-new\n  new ShortcutsNavigation(); // eslint-disable-line no-new\n  GpgBadges.fetch();\n});\n"],"sourceRoot":""}