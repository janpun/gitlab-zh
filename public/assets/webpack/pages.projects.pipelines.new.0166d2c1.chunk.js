(this.webpackJsonp=this.webpackJsonp||[]).push([[112],{167:function(e,t,n){"use strict";var i=n(3),r=n.n(i),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultToggleLabel=t.defaultToggleLabel,this.fieldName=t.fieldName,this.onSelect=t.onSelect||function(){},this.getDataOption=t.getData,this.getDataRemote=!!t.filterRemote,this.createNewItemFromValueOption=t.createNewItemFromValue,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$createButton=this.$dropdownContainer.find(".js-dropdown-create-new-item"),this.buildDropdown(),this.bindEvents(),this.toggleFooter(!0)}return a(e,[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getData.bind(this),filterable:!0,filterRemote:this.getDataRemote,search:{fields:["text"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?r.a.escape(e.title):this.defaultToggleLabel},fieldName:this.fieldName,text:function(e){return r.a.escape(e.text)},id:function(e){return r.a.escape(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t){t.e.preventDefault(),e.onSelect()}})}},{key:"clearDropdown",value:function(){this.$dropdownContainer.find(".dropdown-content").html(""),this.$dropdownContainer.find(".dropdown-input-field").val("")}},{key:"bindEvents",value:function(){this.$createButton.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(e){e.preventDefault(),this.refreshData(),this.$dropdown.data("glDropdown").selectRowAtIndex()}},{key:"refreshData",value:function(){this.$dropdown.data("glDropdown").remote.execute()}},{key:"getData",value:function(e,t){var n=this;this.getDataOption(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=e;n.selectedItem&&e.some(function(e){return e.id===n.selectedItem.id})||(i=e.concat(n.selectedItem||[])),t(i)})}},{key:"createNewItemFromValue",value:function(e){return this.createNewItemFromValueOption?this.createNewItemFromValueOption(e):{title:e,id:e,text:e}}},{key:"toggleCreateNewButton",value:function(e){e&&(this.selectedItem=this.createNewItemFromValue(e),this.$dropdownContainer.find(".js-dropdown-create-new-item code").text(e)),this.toggleFooter(!e)}},{key:"toggleFooter",value:function(e){this.$dropdownFooter.toggleClass("hidden",e)}}]),e}();t.a=o},199:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),r=n.n(i),a=n(7),o=n(1),c=n(11);function s(e,t){e.classList.toggle("is-checked",t)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.querySelectorAll(".js-project-feature-toggle").forEach(function(e){var n=e.querySelector(".js-project-feature-toggle-input");s(e,Object(c.g)(n.value)),e.addEventListener("click",function(e,t,n){var i=Object(c.g)(t.value);s(e,!i),e.setAttribute("disabled",!0),e.classList.toggle("is-loading",!0),Promise.resolve(n(!i,e)).then(function(){t.setAttribute("value",!i)}).catch(function(){s(e,i)}).then(function(){e.removeAttribute("disabled"),e.classList.toggle("is-loading",!1),r()(t).trigger("trigger-change")}).catch(function(){Object(a.a)(Object(o.a)("Something went wrong when toggling the button"))})}.bind(null,e,n,t))})}},246:function(e,t,n){"use strict";var i=n(1),r=n(11),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t){var n=t.container,i=t.valueSelector,r=void 0===i?".js-secret-value":i,a=t.placeholderSelector,o=void 0===a?".js-secret-value-placeholder":a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.valueSelector=r,this.placeholderSelector=o}return a(e,[{key:"init",value:function(){if(this.revealButton=this.container.querySelector(".js-secret-value-reveal-button"),this.revealButton){var e=Object(r.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(e),this.revealButton.addEventListener("click",this.onRevealButtonClicked.bind(this))}}},{key:"onRevealButtonClicked",value:function(){var e=Object(r.g)(this.revealButton.dataset.secretRevealStatus);this.updateDom(!e)}},{key:"updateDom",value:function(e){var t=this.container.querySelectorAll(this.valueSelector);t.forEach(function(t){t.classList.toggle("hide",!e)}),this.container.querySelectorAll(this.placeholderSelector).forEach(function(t){t.classList.toggle("hide",e)}),this.revealButton.textContent=e?Object(i.d)("Hide value","Hide values",t.length):Object(i.d)("Reveal value","Reveal values",t.length),this.revealButton.dataset.secretRevealStatus=e}}]),e}();t.a=o},284:function(e,t,n){"use strict";var i=n(0),r=n.n(i),a=n(11),o=n(1),c=n(199),s=n(167),l=n(246),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var f=Object(o.e)("CiVariable|All environments");function h(e){return{title:"*"===e?f:e,id:e,text:"*"===e?Object(o.e)("CiVariable|* (All environments)"):e}}var v=function(){function e(t){var n=t.container,i=t.formField;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=r()(n),this.formField=i,this.environmentDropdownMap=new WeakMap,this.inputMap={id:{selector:".js-ci-variable-input-id",default:""},key:{selector:".js-ci-variable-input-key",default:""},secret_value:{selector:".js-ci-variable-input-value",default:""},protected:{selector:".js-ci-variable-input-protected",default:"false"},environment_scope:{selector:'input[name="'+this.formField+'[variables_attributes][][environment_scope]"]',default:"*"},_destroy:{selector:".js-ci-variable-input-destroy",default:""}},this.secretValues=new l.a({container:this.$container[0],valueSelector:".js-row:not(:last-child) .js-secret-value",placeholderSelector:".js-row:not(:last-child) .js-secret-value-placeholder"})}return d(e,[{key:"init",value:function(){this.bindEvents(),this.secretValues.init()}},{key:"bindEvents",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){e.initRow(n)}),this.$container.on("click",".js-row-remove-button",function(t){t.preventDefault(),e.removeRow(r()(t.currentTarget).closest(".js-row"))});var t=Object.keys(this.inputMap).map(function(t){return e.inputMap[t].selector}).join(",");this.$container.on("blur",t,function(t){var n=r()(t.currentTarget).closest(".js-row");n.is(":not(:last-child)")&&!e.checkIfRowTouched(n)&&e.removeRow(n)}),this.$container.on("input trigger-change",t,function(){var t=e.$container.find(".js-row").last();e.checkIfRowTouched(t)&&e.insertRow(t)})}},{key:"initRow",value:function(e){var t=this,n=r()(e);Object(c.a)(n[0]),n.find(this.inputMap.secret_value.selector).css("height","");var i=n.find(".js-variable-environment-toggle");if(i.length){var a=new s.a({$dropdown:i,defaultToggleLabel:f,fieldName:this.formField+"[variables_attributes][][environment_scope]",getData:function(e,n){return n(t.getEnvironmentValues())},createNewItemFromValue:h,onSelect:function(){t.refreshDropdownData(),n.find(t.inputMap.environment_scope.selector).trigger("trigger-change")}});a.clearDropdown(),this.environmentDropdownMap.set(n[0],a)}}},{key:"insertRow",value:function(e){var t=this,n=e.clone();n.removeAttr("data-is-persisted"),Object.keys(this.inputMap).forEach(function(e){var i=t.inputMap[e];n.find(i.selector).val(i.default)}),n.find(".dropdown-menu.show").each(function(e,t){t.classList.remove("show")}),this.initRow(n),e.after(n)}},{key:"removeRow",value:function(e){var t=r()(e);Object(a.g)(t.attr("data-is-persisted"))?(t.hide(),t.find(this.inputMap._destroy.selector).val(!0)):t.remove(),this.refreshDropdownData()}},{key:"checkIfRowTouched",value:function(e){var t=this;return Object.keys(this.inputMap).some(function(n){var i=t.inputMap[n],r=e.find(i.selector);return r.length&&r.val()!==i.default})}},{key:"toggleEnableRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$container.find(this.inputMap.key.selector).attr("disabled",!e),this.$container.find(".js-row-remove-button").attr("disabled",!e)}},{key:"hideValues",value:function(){this.secretValues.updateDom(!1)}},{key:"getAllData",value:function(){var e=this;return this.$container.find(".js-row").toArray().slice(0,-1).map(function(t){var n={};return Object.keys(e.inputMap).forEach(function(i){var a=e.inputMap[i],o=r()(t).find(a.selector);o.length&&(n[i]=o.val())}),n})}},{key:"getEnvironmentValues",value:function(){var e=this.$container.find(this.inputMap.environment_scope.selector).toArray().reduce(function(e,t){return u({},e,(n={},i=t.value,r=t.value,i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n));var n,i,r},{});return Object.keys(e).map(h)}},{key:"refreshDropdownData",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){var i=e.environmentDropdownMap.get(n);i&&i.refreshData()})}}]),e}();t.a=v},347:function(e,t,n){"use strict";var i=n(0),r=n.n(i);t.a=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=n||JSON.parse(document.getElementById("availableRefs").innerHTML);t.glDropdown({data:i,filterable:!0,filterByText:!0,remote:!1,fieldName:t.data("fieldName"),filterInput:'input[type="search"]',selectable:!0,isSelectable:function(e,t){return!t.hasClass("is-active")},text:function(e){return e},id:function(e){return e},toggleLabel:function(e){return e}});var a=t.closest(".dropdown"),o=r()('input[name="'+t.data("fieldName")+'"]',a),c=r()('input[type="search"]',a);c.on("keyup",function(e){if(13===(e.keyCode||e.which)){var n=c.val().trim();""!==n&&(o.val(n),r()(".dropdown-toggle-text",t).text(n),a.removeClass("open"))}})}},450:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(0),r=n.n(i),a=n(284);function o(e){var t=e.container,n=e.formField,i=void 0===n?"variables":n,o=r()(t),c=new a.a({container:o,formField:i});c.init(),o.closest("form").on("submit trigger-submit",function(){var e=o.find(".js-row").last();c.checkIfRowTouched(e)||e.find("input, textarea").attr("name","")})}},460:function(e,t,n){"use strict";var i=n(0),r=n.n(i),a=n(347),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.validate=this.validate.bind(this),this.branchNameError=t.find(".js-branch-name-error"),this.name=t.find(".js-branch-name"),this.ref=t.find("#ref"),new a.a(r()(".js-branch-select"),n),this.setupRestrictions(),this.addBinding(),this.init()}return o(e,[{key:"addBinding",value:function(){return this.name.on("blur",this.validate)}},{key:"init",value:function(){if(this.name.length&&this.name.val().length>0)return this.name.trigger("blur")}},{key:"setupRestrictions",value:function(){var e,t,n,i;return i={pattern:/^(\/|\.)/g,prefix:"can't start with",conjunction:"or"},e={pattern:/(\/|\.|\.lock)$/g,prefix:"can't end in",conjunction:"or"},t={pattern:/(\s|~|\^|:|\?|\*|\[|\\|\.\.|@\{|\/{2,}){1}/g,prefix:"can't contain",conjunction:", "},n={pattern:/^@+$/g,prefix:"can't be",conjunction:"or"},this.restrictions=[i,t,e,n]}},{key:"validate",value:function(){var e,t,n,i,a,o,c=[].indexOf;if(this.branchNameError.empty(),i=function(e,t){return-1===c.call(e,t)&&e.push(t),e},n=function(e,t){var n;return n=e.map(function(e){switch(!1){case!/\s/.test(e):return"spaces";case!/\/{2,}/g.test(e):return"consecutive slashes";default:return"'"+e+"'"}}),t.prefix+" "+n.join(t.conjunction)},o=this,a=function(e,t){var r;return(r=o.name.val().match(t.pattern))?e.concat(n(r.reduce(i,[]),t)):e},(t=this.restrictions.reduce(a,[])).length>0)return e=r()("<span/>").text(t.join(", ")),this.branchNameError.append(e)}}]),e}();t.a=c},925:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(460),o=n(450);document.addEventListener("DOMContentLoaded",function(){new a.a(r()(".js-new-pipeline-form")),Object(o.a)({container:r()(".js-ci-variable-list-section"),formField:"variables_attributes"})})},926:function(e,t,n){n(31),n(57),e.exports=n(925)}},[[926,0,1,2]]]);
//# sourceMappingURL=pages.projects.pipelines.new.0166d2c1.chunk.js.map